<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3D Model Viewer</title>
  <link rel="stylesheet" href="https://unpkg.com/tachyons@4.12.0/css/tachyons.min.css" />
  <!-- <link href="https://cesium.com/downloads/cesiumjs/releases/1.122/Build/Cesium/Widgets/widgets.css"rel="stylesheet"> -->
  <link href="./cesium/Widgets/widgets.css" rel="stylesheet">

  <style>
    :root {
      --accent:#2f80ff;
      --bg:#0b0f14;
      --panel:#11161c;
      --stroke:#222a33;
      --text:#e6edf3;
      --sub:#98a6b3;
      --topbar:56px;
    }
    [data-theme="light"]{
      --bg:#f7f9fc;
      --panel:#fff;
      --stroke:#e5eaf0;
      --text:#0b1929;
      --sub:#506174;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--text);
      background:var(--bg);
      overflow:hidden;
    }
    a{ color:inherit; text-decoration:none; }

    /* Top bar */
    .topbar{
      position:sticky;
      top:0;
      z-index:50;
      height:var(--topbar);
      display:flex;
      align-items:center;
      backdrop-filter:blur(8px);
      border-bottom:1px solid #18212b;
      background:rgba(11,15,20,.9);
    }
    .logo{
      display:inline-flex;
      width:28px;
      height:28px;
      align-items:center;
      justify-content:center;
      border-radius:8px;
      background:var(--accent);
      color:#fff;
      font-weight:800;
    }
    .btn{
      border:1px solid #27313c;
      background:#0f151c;
      color:var(--text);
      padding:6px 12px;
      border-radius:12px;
      font-size:14px;
      cursor:pointer;
    }
    .btn:active{ transform:translateY(1px); }
    .search{
      min-width:220px;
      border:1px solid #27313c;
      background:#0f151c;
      border-radius:12px;
      color:var(--text);
      padding:8px 12px;
    }

    /* === 메인 레이아웃 컨테이너 (이제 .shell 대신 사용) === */
    #viewerShell{
      position:relative;
      height:calc(100vh - var(--topbar));
      width:100%;
      display:flex;
      flex-direction:row;
      overflow:hidden;
    }

    /* 왼쪽 vertical rail */
    .rail{
      width:56px;
      background:var(--panel);
      border-right:1px solid var(--stroke);
      display:flex;
      flex-direction:column;
      align-items:center;
      padding-top:0.75rem; /* pv3 느낌 */
      flex-shrink:0;
    }
    .rail .icon{
      width:36px;
      height:36px;
      display:grid;
      place-items:center;
      color:#ffffff;
      background:black;
      outline:2px solid transparent;
      outline-offset:2px;
      border-radius:.375rem;
      background-color:transparent;
      background-image:none;
      border:0 solid #e5e7eb;
      box-sizing:border-box;
      cursor:pointer;
    }
    .rail .icon.active,
    .rail .icon:hover{
      background:#142033;
      color:#8fb4ff;
    }

    /* 중앙 뷰어 영역 */
    .viewer-region{
      position:relative;
      flex:1;
      min-width:0;
      min-height:0;
      overflow:hidden;
      background:var(--bg);
    }

    /* Slide-out drawer (Models) – viewerShell 기준으로 절대 위치 */
    .drawer { position: absolute; left: 0; top: 0; height: 100%; width: 320px; background: var(--panel); border-right: 1px solid var(--stroke); opacity: 0; pointer-events: none; transition: transform .25s ease, opacity .2s ease; z-index: 30; }
    .drawer.open { transform: translateX(0px); opacity: 1; pointer-events: auto; } 
    .drawer .head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:8px 12px;
      border-bottom:1px solid var(--stroke);
    }
    .drawer .scroll{
      height: calc(100% - 44px);
      overflow:auto;
      padding:12px;
    }
    .tree{
      border:1px solid var(--stroke);
      border-radius:10px;
    }
    .tree-h{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 12px;
    }
    .chip{
      background:#15202b;
      color:var(--sub);
      font-size:12px;
      padding:2px 8px;
      border-radius:6px;
    }
    .tree-b{
      border-top:1px solid var(--stroke);
      padding:8px 12px;
    }
    .item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:6px 8px;
      border-radius:8px;
    }
    .item:hover{ background:#0f151c; }

    /* Cesium Viewer root */
    #viewerRoot{
      height:100%;
      width:100%;
      position:relative;
      display:block;
      overflow:hidden;
    }
    .viewer-placeholder{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      opacity:.9;
      justify-content:center;
      height:100%;
    }
    .viewer-placeholder .box{
      width:120px;
      height:80px;
      border:1px dashed var(--stroke);
      border-radius:12px;
    }

    /* Header actions & dropdown */
    .header-actions{ display:flex; align-items:center; }
    .more{ display:none; align-items:center; justify-content:center; }
    .dropdown{
      position:absolute;
      right:12px;
      top:calc(var(--topbar) + 6px);
      background:var(--panel);
      border:1px solid var(--stroke);
      border-radius:12px;
      padding:8px;
      display:none;
      z-index:70;
    }
    .dropdown.open{ display:block; }
    .dropdown .btn{
      width:100%;
      text-align:left;
      margin:4px 0;
    }

    /* Responsive */
    @media (max-width: 1024px){
      .header-actions{ display:none; }
      .more{ display:inline-flex; }
      .search{ display:none; }
    }
  </style>

  <script src="./cesium/Cesium.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="/dist/git-viewer.umd.js"></script>
</head>
<body>

  <!-- Top Bar -->
  <header class="topbar">
    <div class="flex items-center justify-between ph3 pv2" style="max-width:100%; width:100%;">
      <div class="flex items-center">
        <div class="logo mr2">><</div>
        <div class="fw6">3D Model Viewer</div>
        <span class="ml2 f7 bg-dark-blue white br2 ph2 pv1"
              style="background:#142033;color:#8fb4ff;">for 서울시</span>
      </div>
      <div class="flex items-center header-actions">
        <input class="search mr2" placeholder="Search…" aria-label="Search" />
        <button class="btn mr1" id="btnTheme" aria-pressed="true">Temp</button>
        <button class="btn mr1" id="btnShare">Share</button>
        <button class="btn" id="btnHelp">Help</button>
      </div>
      <button class="btn more ml2" id="btnMenu" aria-haspopup="true" aria-expanded="false" title="More">⋯</button>
    </div>
  </header>

  <!-- dropdown menu -->
  <div class="dropdown" id="menuDropdown" role="menu" aria-hidden="true">
    <button class="btn" id="menuTheme">Temp</button>
    <button class="btn" id="menuShare">Share</button>
    <button class="btn" id="menuHelp">Help</button>
  </div>

  <!-- 메인 레이아웃: 왼쪽 메뉴 + 뷰어 영역 -->
  <div id="viewerShell">
    <!-- Left vertical rail -->
    <nav class="rail">
      <button class="icon mb2" id="btnModels" title="Models" aria-expanded="false">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6">
          <path d="M4 7l8-4 8 4v10l-8 4-8-4z"/>
          <path d="M12 3v18"/>
        </svg>
      </button>
      <button class="icon mb2" id="btnLayers" title="Layers">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6">
          <path d="M12 3l9 5-9 5-9-5 9-5z"/>
          <path d="M21 12l-9 5-9-5"/>
        </svg>
      </button>
      <button class="icon" id="btnClipping" title="Clipping">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6">
          <path d="M3 7h18"/>
          <path d="M7 21V3"/>
          <rect x="7" y="7" width="10" height="10" rx="1"/>
        </svg>
      </button>
    </nav>

    <!-- Viewer + Drawer 영역 -->
    <div class="viewer-region">
      <!-- Slide-out drawer (Models) -->
      <aside class="drawer" id="drawerModels" aria-label="Models drawer">
        <div class="head">
          <div class="flex items-center">
            <span class="mr2">Models</span>
            <span class="f7 ph2 pv1 br2" style="background:#15202b;color:var(--sub);">Latest</span>
          </div>
          <button class="btn" id="btnCloseDrawer" style="padding:4px 8px;font-size:12px;">Close</button>
        </div>
        <div class="scroll">
          <div class="tree">
            <div class="tree-h">
              <div class="flex items-center">
                <span class="mr2 br2"
                      style="display:inline-flex;width:20px;height:20px;align-items:center;justify-content:center;background:#15233a;color:#8fb4ff;font-size:12px;">◆</span>
                <span>sample model</span>
              </div>
              <span class="chip">Aug 4, 2023</span>
            </div>
            <div class="tree-b">
              <div class="item">
                <span style="color:var(--sub)">Base</span>
                <button class="btn" style="padding:4px 8px;font-size:12px;">Select</button>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <!-- 이 div가 CesiumViewer target -->
      <div id="viewerRoot">
        <div class="viewer-placeholder">
          <div class="box"></div>
          <div>Place your WebGL/WebGPU viewer here</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Theme (지금은 동작 막음)
    function toggleTheme(){
      return;
      const r=document.documentElement;
      const dark=r.getAttribute('data-theme')!=='light';
      r.setAttribute('data-theme', dark?'light':'dark');
      const t=document.getElementById('btnTheme');
      if(t) t.setAttribute('aria-pressed', String(!dark));
    }
    document.getElementById('btnTheme')?.addEventListener('click', toggleTheme);

    // Drawer logic
    const btnModels = document.getElementById('btnModels');
    const drawerModels = document.getElementById('drawerModels');
    const btnCloseDrawer = document.getElementById('btnCloseDrawer');

    function openDrawer(){
      drawerModels.classList.add('open');
      btnModels.classList.add('active');
      btnModels.setAttribute('aria-expanded','true');
    }
    function closeDrawer(){
      drawerModels.classList.remove('open');
      btnModels.classList.remove('active');
      btnModels.setAttribute('aria-expanded','false');
    }

    btnModels.addEventListener('click', ()=>{
      drawerModels.classList.contains('open') ? closeDrawer() : openDrawer();
    });
    btnCloseDrawer.addEventListener('click', closeDrawer);

    // Header dropdown (mobile)
    const menuBtn = document.getElementById('btnMenu');
    const menu = document.getElementById('menuDropdown');

    function closeMenu(){
      if(!menu) return;
      menu.classList.remove('open');
      menu.setAttribute('aria-hidden','true');
      menuBtn?.setAttribute('aria-expanded','false');
    }
    function toggleMenu(){
      if(!menu) return;
      const isOpen = menu.classList.contains('open');
      if(isOpen){
        closeMenu();
      }else{
        menu.classList.add('open');
        menu.setAttribute('aria-hidden','false');
        menuBtn?.setAttribute('aria-expanded','true');
      }
    }

    menuBtn?.addEventListener('click',(e)=>{
      e.stopPropagation();
      toggleMenu();
    });
    document.addEventListener('click',(e)=>{
      if(menu?.classList.contains('open')){
        const within = menu.contains(e.target) || menuBtn?.contains(e.target);
        if(!within) closeMenu();
      }
    });

    // ESC closes drawer & menu
    document.addEventListener('keydown',(e)=>{
      if(e.key==='Escape'){
        closeDrawer();
        closeMenu();
      }
    });

    // Dropdown items
    document.getElementById('menuShare')?.addEventListener('click', ()=> alert('Share: stub'));
    document.getElementById('menuHelp')?.addEventListener('click', ()=> alert('Help: stub'));
    // document.getElementById('menuTheme')?.addEventListener('click', toggleTheme);
  </script>
  <script>
document.addEventListener("DOMContentLoaded", async function () {
      try {
          const app = await GIT.CesiumViewer("#viewerRoot", {
            tilesetUrl: "http://175.116.181.151:29090/3d-tileset/02_draco_glb/tileset.json",
            propertyUrls: ["http://175.116.181.151:29090/3d-tileset/properties/combined_properties.json"],
            info: {
              text: "서울시 공동구입니다.",
              iconSrc: "./src/under.png",
              length: 100,
            },
          });
      } catch (err) {
        console.error("초기화 실패", err);
      }
    });
  </script>
</body>
</html>
