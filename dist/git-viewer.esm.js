const HUD_CSS='\n                /* 기본: 패널 위치 */\n                #hud-info-panel {\n                    position: absolute;\n                    top: 8px;\n                    left: 8px;\n                    z-index: 1;\n                    font-size: 11px;\n                    color: #e6edf3;\n                }\n\n                #hud-info-panel .hud-info-body {\n                    display: block;\n                }\n\n                /* camerafree 도움말 */\n                .free-help { position:absolute; left:50%; transform:translateX(-50%); bottom:64px; padding:10px 12px; border-radius:10px; background:rgba(17,22,28,.95); color:#e6edf3; border:1px solid rgba(255,255,255,.08); box-shadow:0 10px 24px rgba(0,0,0,.45); z-index:5000; max-width:calc(100vw - 32px); font:11px system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif; }\n                .free-help h4 { margin:0 0 6px 0; font-size:14px; font-weight:700; color:#9ecbff; }\n                .free-help .row{ display:flex; gap:10px; margin:4px 0; }\n                .free-help kbd{ min-width:40px; padding:2px 6px; border-radius:6px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); color:#fff; font:600 11px ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; text-align:center; }\n                \n       \n                #btn_cameraFreeMode,\n                #btn_orbitMode {\n                position: relative;\n                overflow: hidden;\n                }\n\n                #btn_cameraFreeMode.is-active,\n                #btn_orbitMode.is-active {\n                background: #151922;          /* HUD 배경색과 어울리게 */\n                border-color: #d1d5db;        /* 은색 계열 */\n                color: #f9fafb;\n                }\n\n                /* 라인 기본 위치 설정 (기본은 보이지 않게) */\n                #btn_cameraFreeMode .line-top,\n                #btn_cameraFreeMode .line-right,\n                #btn_cameraFreeMode .line-bottom,\n                #btn_cameraFreeMode .line-left,\n                #btn_orbitMode .line-top,\n                #btn_orbitMode .line-right,\n                #btn_orbitMode .line-bottom,\n                #btn_orbitMode .line-left {\n                position: absolute;\n                display: block;\n                opacity: 0;\n                pointer-events: none;\n                }\n\n                /* === 활성화 상태에서만 라인 + 애니메이션 적용 === */\n\n                /* 상단 라인 */\n                #btn_cameraFreeMode.is-active .line-top,\n                #btn_orbitMode.is-active .line-top {\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 3px;\n                opacity: 1;\n                background: linear-gradient(\n                    to right,\n                    rgba(15, 17, 22, 0),\n                    #ffe66b,\n                    #ffb347,\n                    rgba(15, 17, 22, 0)\n                ); /* 노랑 → 주황 계열 빛 */\n                animation: hudLineTop 2s linear infinite;\n                }\n\n                /* 우측 라인 */\n                #btn_cameraFreeMode.is-active .line-right,\n                #btn_orbitMode.is-active .line-right {\n                top: 0;\n                right: 0;\n                width: 3px;\n                height: 100%;\n                opacity: 1;\n                background: linear-gradient(\n                    to bottom,\n                    rgba(15, 17, 22, 0),\n                    #ffe66b,\n                    #ff9f1c,\n                    rgba(15, 17, 22, 0)\n                );\n                animation: hudLineRight 2s linear infinite;\n                animation-delay: 0.5s;\n                }\n\n                /* 하단 라인 */\n                #btn_cameraFreeMode.is-active .line-bottom,\n                #btn_orbitMode.is-active .line-bottom {\n                bottom: 0;\n                left: 0;\n                width: 100%;\n                height: 3px;\n                opacity: 1;\n                background: linear-gradient(\n                    to left,\n                    rgba(15, 17, 22, 0),\n                    #ffe66b,\n                    #ffb347,\n                    rgba(15, 17, 22, 0)\n                );\n                animation: hudLineBottom 2s linear infinite;\n                }\n\n                /* 좌측 라인 */\n                #btn_cameraFreeMode.is-active .line-left,\n                #btn_orbitMode.is-active .line-left {\n                top: 0;\n                left: 0;\n                width: 3px;\n                height: 100%;\n                opacity: 1;\n                background: linear-gradient(\n                    to top,\n                    rgba(15, 17, 22, 0),\n                    #ffe66b,\n                    #ff9f1c,\n                    rgba(15, 17, 22, 0)\n                );\n                animation: hudLineLeft 2s linear infinite;\n                animation-delay: 0.5s;\n                }\n\n                /* ==== keyframes (같이 사용) ==== */\n\n                @keyframes hudLineTop {\n                0%   { transform: translateX(-100%); }\n                100% { transform: translateX(100%); }\n                }\n\n                @keyframes hudLineRight {\n                0%   { transform: translateY(-100%); }\n                100% { transform: translateY(100%); }\n                }\n\n                @keyframes hudLineBottom {\n                0%   { transform: translateX(100%); }\n                100% { transform: translateX(-100%); }\n                }\n\n                @keyframes hudLineLeft {\n                0%   { transform: translateY(100%); }\n                100% { transform: translateY(-100%); }\n                }\n\n                /* Alpha 행 레이아웃 */\n                .hud-alpha-row {\n                    display:flex;\n                    align-items:center;\n                    gap:4px;\n                    flex-wrap:wrap;\n                }\n                .hud-alpha-row span {\n                    flex:0 0 auto;\n                }\n                .hud-alpha-value {\n                    min-width:28px;\n                    text-align:right;\n                }\n                .hud-alpha-range {\n                    flex:1 1 auto;\n                    min-width:80px;\n                }\n\n                /* 모델 옵션 드롭다운 */\n                .hud-mode-wrap{\n                    position:relative;\n                }\n                .hud-cg-menu{\n                    position:absolute;\n                    top:0;\n                    left:100%;\n                    margin-left:4px;\n                    background:rgba(42,42,42,.7);\n                    border-radius:8px;\n                    padding:6px 8px;\n                    border:1px solid rgba(255,255,255,.1);\n                    box-shadow:0 8px 18px rgba(0,0,0,.45);\n                    display:none;\n                    flex-direction:column;\n                    gap:4px;\n                    min-width:120px;\n                    z-index:6000;\n                }\n\n                .hud-mode-wrap.is-open .hud-cg-menu{\n                    display:flex;\n                }\n                \n                .hud-cg-item{\n                    width:100%;\n                    margin:0;\n                    font-size:11px;\n                    text-align:left;\n                    white-space:nowrap;\n                    border: 0px;\n                    text-align: center;\n                    background: transparent;\n                }\n\n                .cesium-performanceDisplay-defaultContainer {\n                    top: 85px !important;\n                }\n\n                /* 좁은 화면용 HUD */\n                @media (max-width: 1024px) {\n                    /* 카메라 영역 전체를 가로로 꽉 채우기 */\n                    #hud-info-panel .hud-mode-wrap {\n                        width: 100%;\n                    }\n\n                    #hud-info-panel {\n                        display: flex;\n                        flex-direction: column;\n                        align-items: flex-start;\n                        max-width: calc(100% - 16px);\n                    }\n\n                    /* 토글 버튼 노출 */\n                    #hud-info-toggle {\n                        display: inline-flex;\n                        align-items: center;\n                        justify-content: center;\n                        padding: 3px 8px;\n                        margin-bottom: 4px;\n                        border-radius: 999px;\n                        border: 1px solid rgba(255,255,255,0.4);\n                        background: rgba(0,0,0,0.7);\n                        color: #e6edf3;\n                        font-size: 10px;\n                        cursor: pointer;\n                    }\n\n                    /* 드롭다운 패널 기본: 접혀 있음 */\n                    #hud-info-panel .hud-info-body {\n                        position: relative;\n                        margin-top: 4px;\n                        border-radius: 8px;\n                        padding: 6px 10px;\n                        max-height: 0;\n                        overflow: hidden;\n                        opacity: 0;\n                        transform-origin: top left;\n                        transform: translateY(-4px);\n                        transition:\n                        max-height 0.18s ease,\n                        opacity 0.18s ease,\n                        transform 0.18s ease;\n                    }\n\n                    /* is-open 클래스일 때만 펼쳐지도록 */\n                    #hud-info-panel.is-open .hud-info-body {\n                        max-height: 100%;           /* 내용 높이보다 조금 크게 잡기 */\n                        opacity: 1;\n                        transform: translateY(0);\n                    }\n\n                    #hud-info-panel .hud-cg-menu {\n                        position: static;      /* absolute + left:100% 제거 효과 */\n                        margin-left: 0;\n                        margin-top: 4px;\n\n                        width: 100%;\n                        box-shadow: 0 6px 14px rgba(0,0,0,0.5);\n                    }\n                }\n\n                /* 큰 화면용 HUD */\n                @media (min-width: 1025px) {\n                    /* 토글 버튼은 안 보이게 */\n                    #hud-info-toggle {\n                        display: none;\n                    }\n\n                    /* 큰 화면에서는 항상 body 보이도록 강제 */\n                    #hud-info-panel .hud-info-body {\n                        display: block !important;\n                        position: static;\n                        max-height: none;\n                        opacity: 1;\n                        transform: none;\n                    }\n                }\n\n                /* 카메라 모드 그룹 컨테이너 */\n                .hud-mode-group {\n                    border-radius: 8px;\n                }\n\n                /* 버튼 래퍼: 살짝 어두운 바탕 + 라운드 */\n                .hud-mode-buttons {\n                    display: flex;\n                    gap: 2px;\n                    padding: 2px;\n                    border-radius: 8px;\n                    background: rgb(20 26 34 / 66%);\n                    border: 1px solid rgba(255, 255, 255, 0.08);\n                }\n\n                /* 개별 버튼: 기본 상태 */\n                .hud-mode-btn {\n                    flex: 1;\n                    margin: 0 !important;\n                    border-radius: 6px;\n                    border: none;\n                    background: transparent;\n                    color: #ffffffff;\n                    font-size: 11px;\n                    padding: 4px 0;\n                    transition: background 0.18s ease, color 0.18s ease,\n                                box-shadow 0.18s ease, transform 0.08s ease;\n                }\n\n                /* 활성 상태: 라디오에서 선택된 것처럼 */\n                .hud-mode-btn.is-active {\n                    background: #ff7c1c;\n                    color: #ffffff;\n                    box-shadow:\n                        0 0 0 1px rgba(255, 180, 80, 0.55),\n                        0 0 10px rgba(255, 140, 40, 0.75);\n                    transform: translateY(0);\n                }\n\n                /*  hover 공통 스타일 */\n                #hud-info-panel .cesium-button:hover {\n                    background: rgba(47, 128, 255, 0.18);\n                    color: #f5f7fb;\n                }   \n\n                /* HUD 안의 모든 글씨 공통 스타일 */\n                #hud-info-panel,\n                #hud-info-panel * {\n                    color: #ffffff;\n                    text-shadow:\n                    1px 1px 0 #000,\n                    -1px -1px 0 #000,\n                    1px -1px 0 #000,\n                    -1px 1px 0 #000,\n                    1px 1px 0 #000;\n                    font-family: Arial, Helvetica, sans-serif;\n                }\n',HUD_HTML='\n<div id="hud-info-panel" style="position:absolute; top:8px; left:8px; z-index:1; font-size:11px; width: 170px; max-width: 170px; color:#e6edf3; pointer-events:auto;">\n    <button id="hud-info-toggle" type="button" class="cesium-button">\n        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <path d="M3 6h18"></path>\n        <path d="M7 12h10"></path>\n        <path d="M10 18h4"></path>\n        </svg>\n    </button>\n    <div class="hud-info-body">\n        <div style="background:rgb(20 26 34 / 66%); padding:6px 10px; border-radius:8px; margin-bottom:6px;">\n        경도 : <span id="hud-lon"></span>\n        </div>\n        <div style="background:rgb(20 26 34 / 66%); padding:6px 10px; border-radius:8px; margin-bottom:6px;">\n        위도 : <span id="hud-lat"></span>\n        </div>\n        <div style="background:rgb(20 26 34 / 66%); padding:6px 10px; border-radius:8px; margin-bottom:6px;">\n        높이 : <span id="hud-height"></span>\n        </div>\n        <div style="background:rgb(20 26 34 / 66%); padding:6px 10px; border-radius:8px; margin-bottom:6px;">\n        Zoom Level : <span id="hud-zoom">0m</span>\n        </div>\n\n        \x3c!-- 카메라 그룹 --\x3e\n        <div class="hud-mode-wrap" style="margin-bottom:6px; background: rgb(20 26 34 / 66%); border-radius: 8px;">\n        <button id="hud-camera-group" type="button" class="cesium-button" style="font-size:11px;width:100%;margin:0;background: transparent; border-radius: 8px;">\n            카메라 ▸\n        </button>\n\n        <div class="hud-cg-menu">\n            <button type="button" class="cesium-button hud-cg-item" data-view="top"   id="hud-topdown">top</button>\n            <button type="button" class="cesium-button hud-cg-item" data-view="left"  id="hud-leftHalfDown">left</button>\n            <button type="button" class="cesium-button hud-cg-item" data-view="right" id="hud-rightHalfDown">right</button>\n        </div>\n        </div>\n        \x3c!-- 카메라 모드 토글 버튼 그룹 --\x3e\n        <div class="hud-mode-group" style="margin-bottom:6px;">\n            <div class="hud-mode-buttons" role="radiogroup">\n                <button id="btn_cameraFreeMode" type="button" class="cesium-button hud-mode-btn" role="radio" aria-checked="true" >\n                탐색\n                </button>\n                <button id="btn_orbitMode" type="button" class="cesium-button hud-mode-btn" role="radio" aria-checked="false">\n                회전\n                </button>\n            </div>\n        </div>\n\n        \x3c!-- 지하시설물 특화 블럭 --\x3e\n        <div style="background: rgb(20 26 34 / 66%); padding:6px 10px; border-radius:8px; margin-bottom:6px; display:none;">\n        \x3c!-- 상단 타이틀 --\x3e\n            <div style="font-weight:600; margin-bottom:0.5rem;">\n                지하시설물 특화\n            </div>\n            \x3c!-- 하위 옵션 전체 래퍼 --\x3e\n            <div style="margin-left:4px; font-size:11px;">\n\n                \x3c!-- 상위 옵션: Translucency (접었다 펼치는 헤더) --\x3e\n                <div class="hud-trans-header"\n                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:4px; cursor:pointer;">\n                    <div style="display:flex; align-items:center; gap:4px;">\n                        \x3c!-- + / - 토글 아이콘 --\x3e\n                        <span class="hud-trans-toggle"\n                            style="display:inline-block; width:14px; text-align:center;">−</span>\n                        <span>Translucency</span>\n                    </div>\n                    <input\n                        type="checkbox"\n                        id="hud-translucency"\n                        style="accent-color:#ffcd00; margin-left:8px;"\n                        checked\n                    />\n                </div>\n\n                \x3c!-- Translucency 하위 옵션 그룹 --\x3e\n                <div class="hud-trans-body" style="margin-left:16px; margin-top:2px; font-size:0.9em;">\n                    \x3c!-- Fade by distance --\x3e\n                    <label style="display:block; margin-bottom:6px;">\n                        Fade by distance\n                        <input type="checkbox" id="hud-fadeByDistance" style="accent-color:#ffcd00" checked/>\n                    </label>\n\n                    \x3c!-- Alpha --\x3e\n                    <div class="hud-alpha-row" style="display:flex; align-items:center; gap:4px; flex-wrap:wrap;">\n                        <span style="min-width:40px;">Alpha</span>\n                        <span id="hud-alpha-value" class="hud-alpha-value" style="font-size:0.85em; opacity:0.8;">0.5</span>\n                        <input id="hud-alpha-range"\n                            type="range" min="0.0" max="1.0" step="0.1" data-bind="value: alpha, valueUpdate: \'input\'" class="hud-alpha-range"\n                            style="appearance:none; background-color:#ffffff57; accent-color:#ffcd00; border-radius:10px; cursor:pointer; height:8px;"/>\n                    </div>\n                </div>\n\n                \x3c!-- 같은 레벨의 항목: 모델만 보기 --\x3e\n                <div style="margin-top:8px; padding-top:6px; border-top:1px solid rgba(255,255,255,0.08); display:flex; align-items:center; justify-content:space-between;">\n                    <div style="display:flex; align-items:center; gap:4px;">\n                        <span style="display:inline-block; width:14px;"></span>\n                        <span>View 3D Model Only</span>\n                    </div>\n                    <input type="checkbox" id="hud-only-model" style="accent-color:#ffcd00"/>\n                </div>\n                <div style="margin-top:8px; padding-top:6px; border-top:1px solid rgba(255,255,255,0.08); display:flex; align-items:center; justify-content:space-between;">\n                    <div style="display:flex; align-items:center; gap:4px;">\n                        <span style="display:inline-block; width:14px;"></span>\n                        <span>Performance</span>\n                    </div>\n                    <input type="checkbox" id="hud-performance" style="accent-color:#ffcd00"/>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n',INSPECTOR_CSS="\n    .shell {\n        display: grid;\n        grid-template-columns: 1fr 360px; /* 왼쪽 viewer, 오른쪽 inspector */\n        width: 100%;\n        height: 100%;\n    }\n    .shell > * {\n        min-width: 0;\n        min-height: 0;\n    }\n    .shell.no-inspector {\n        grid-template-columns: 1fr; /* inspector 닫으면 viewer가 전체 사용 */\n    }\n\n    main {\n        position: relative;\n        height: 100%;\n        width: 100%;\n    }\n\n    /* Inspector 박스 (오른쪽) */\n    .inspector {\n        background: #11161c;\n        border-left: 1px solid #222a33;\n        display: flex;\n        flex-direction: column;\n        height: 100%;\n        overflow: hidden;\n        padding: 1rem;\n    }\n\n    .inspector[hidden] {\n        display: none !important;\n    }\n\n    /* 상단 close 버튼 & 타이틀 */\n    .inspectorBaseBtn {\n        font-size: 11px;\n        padding: 3px 8px;\n        margin: 0;\n        cursor: pointer;\n        border-radius: 12px;\n        border: 1px solid #27313c;\n        color: #e6edf3;\n    }\n\n\n    /* 화면 작아졌을때 스크롤 스타일 */\n    #inspector_list_container::-webkit-scrollbar {\n        width: 8px;\n    }\n\n    #inspector_list_container::-webkit-scrollbar-track {\n        background: rgba(8, 12, 18, 0.95);\n        border-radius: 999px;\n    }\n\n    #inspector_list_container::-webkit-scrollbar-thumb {\n        background: linear-gradient(180deg, #3b82f6, #0ea5e9);\n        border-radius: 999px;\n        border: 1px solid rgba(0, 0, 0, 0.5);\n    }\n\n    #inspector_list_container::-webkit-scrollbar-thumb:hover {\n        background: linear-gradient(180deg, #60a5fa, #22d3ee);\n    }\n    \n    /* key-value 영역 */\n    .inspect_list {\n        padding: 10px 0;\n        border-bottom: 1px solid #222a33;\n        font-size: 11px;\n    }\n\n    .inspect_list:last-child {\n        border-bottom: 0;\n    }\n\n    .inspect_list .k {\n        color: #ffffffff;\n        margin-bottom: 5px;\n    }\n\n    .inspector button:hover {\n      background: rgba(47, 128, 255, 0.18);\n      color: #f5f7fb;\n    }\n\n    .inspector,\n    .inspector * {\n        color: #ffffff;\n        text-shadow:\n          1px 1px 0 #000,\n          -1px -1px 0 #000,\n          1px -1px 0 #000,\n          -1px 1px 0 #000,\n          1px 1px 0 #000;\n        font-family: Arial, Helvetica, sans-serif;\n    }\n\n    @media (max-width: 1024px) {\n        /* 전체 레이아웃: 세로 방향 flex 컨테이너로 변경 */\n        .shell {\n            display: flex;\n            flex-direction: column; /* 위: main, 아래: inspector */\n            width: 100%;\n            height: 100%;\n        }\n\n        /* 윗부분(viewer 영역) 높이 비율 2 */\n        .shell main {\n            flex: 2 1 0;   /* 2 : 1 비율에서 '2' */\n            min-height: 0; /* overflow 스크롤 깨짐 방지 */\n        }\n\n        /* 아랫부분(inspector 영역) 높이 비율 1 */\n        .shell .inspector {\n            display: flex;         /* 기존 스타일 유지 + flex column */\n            flex-direction: column;\n            flex: 1 1 0;           /* 2 : 1 비율 '1' */\n            min-height: 0;\n            border-left: none;     /* 좌측 경계선 제거 */\n            border-top: 1px solid #222a33; /* 위쪽에 경계선 */\n        }\n\n        /* 닫기 눌렀을 때 아래 pane만 감추는 처리 (기존 no-inspector 클래스와 연동) */\n        .shell.no-inspector .inspector {\n            display: none !important;\n        }\n    }\n",INSPECTOR_HTML='\n    <aside class="inspector">\n        <div style="border-color:#222a33; display:flex; align-items:center;justify-content:space-between;border-bottom:1px solid rgba(0,0,0,0.2);">\n            <h3 style="font-size:.875rem; margin:0; font-weight:600; color:white;">모델정보</h3>\n            <button id="btnInspectorModelShow" class="inspectorBaseBtn cesium-button" disabled>숨김</button>\n            <button class="inspectorBaseBtn cesium-button" id="btnInspectorClose">닫기</button>\n        </div>\n        <div id="inspector_list_container" style="flex:1; overflow:auto;">\n            <div class="inspect_list" style = "text-align: center;">\n                <div style="color:#e6edf3;">모델을 클릭해 주세요.</div>\n            </div>\n        </div>\n    </aside>\n',COMPASS_SVG='\n<svg\n   xmlns:dc="http://purl.org/dc/elements/1.1/"\n   xmlns:cc="http://creativecommons.org/ns#"\n   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\n   xmlns:svg="http://www.w3.org/2000/svg"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   width="256"\n   height="256"\n   viewBox="0 0 67.733332 67.733336"\n   version="1.1"\n   id="svg8"\n   inkscape:version="0.92.4 (5da689c313, 2019-01-14)"\n   sodipodi:docname="compas.svg">\n  <defs\n     id="defs2" />\n  <sodipodi:namedview\n     id="base"\n     pagecolor="#ff00ff"\n     bordercolor="#666666"\n     borderopacity="1.0"\n     inkscape:pageopacity="0"\n     inkscape:pageshadow="2"\n     inkscape:zoom="0.9899495"\n     inkscape:cx="-23.735523"\n     inkscape:cy="75.513805"\n     inkscape:document-units="mm"\n     inkscape:current-layer="layer1"\n     showgrid="false"\n     units="px"\n     inkscape:window-width="1920"\n     inkscape:window-height="1001"\n     inkscape:window-x="-9"\n     inkscape:window-y="-9"\n     inkscape:window-maximized="1" />\n  <metadata\n     id="metadata5">\n    <rdf:RDF>\n      <cc:Work\n         rdf:about="">\n        <dc:format>image/svg+xml</dc:format>\n        <dc:type\n           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />\n        <dc:title />\n      </cc:Work>\n    </rdf:RDF>\n  </metadata>\n  <g\n     inkscape:label="Layer 1"\n     inkscape:groupmode="layer"\n     id="layer1"\n     transform="translate(0,-229.26665)">\n    <rect\n       transform="matrix(0.28684886,-0.95797585,0.28684886,0.95797585,0,0)"\n       y="186.256"\n       x="-88.509865"\n       height="20.228861"\n       width="20.407875"\n       id="rect841"\n       style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:3.19949436;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill" />\n    <path\n       style="fill:#ff0000;fill-opacity:1;stroke:none;stroke-width:0.31378534px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"\n       d="m 33.892345,243.66881 -5.853981,19.55025 11.656606,-0.1715 z"\n       id="path839"\n       inkscape:connector-curvature="0" />\n    <rect\n       style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:1.34890436;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill"\n       id="rect837"\n       width="20.407875"\n       height="20.228861"\n       x="-88.509865"\n       y="186.256"\n       transform="matrix(0.28684886,-0.95797585,0.28684886,0.95797585,0,0)" />\n    <circle\n       r="26.400972"\n       cy="263.13333"\n       cx="33.866665"\n       id="circle875"\n       style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:3;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />\n    <path\n       style="color:#000000;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;vector-effect:none;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:3.77952766;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate"\n       d="M 128.00195 21.101562 C 68.983697 21.101562 21.097652 68.979815 21.097656 127.99805 C 21.097652 187.01631 68.983697 234.90234 128.00195 234.90234 C 187.02021 234.90234 234.89844 187.01631 234.89844 127.99805 C 234.89844 68.979815 187.02021 21.101562 128.00195 21.101562 z M 128.00195 24.880859 C 184.9776 24.880859 231.11914 71.022423 231.11914 127.99805 C 231.11914 184.97371 184.9776 231.12305 128.00195 231.12305 C 71.026305 231.12305 24.876949 184.97371 24.876953 127.99805 C 24.876949 71.022423 71.026305 24.880859 128.00195 24.880859 z M 128.00195 32.646484 C 75.383495 32.646484 32.642571 75.379576 32.642578 127.99805 C 32.642571 180.61652 75.383495 223.35742 128.00195 223.35742 C 180.62041 223.35742 223.35352 180.61652 223.35352 127.99805 C 223.35352 75.379576 180.62041 32.646484 128.00195 32.646484 z M 128 36.423828 A 91.575673 91.575673 0 0 1 219.57617 128 A 91.575673 91.575673 0 0 1 128 219.57617 A 91.575673 91.575673 0 0 1 36.423828 128 A 91.575673 91.575673 0 0 1 128 36.423828 z "\n       transform="matrix(0.26458333,0,0,0.26458333,0,229.26665)"\n       id="path831" />\n    <text\n       xml:space="preserve"\n       style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:14.86962605px;line-height:1.25;font-family:Calibri;-inkscape-font-specification:\'Calibri Bold\';letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:2.10750604;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers"\n       x="28.969419"\n       y="241.2182"\n       id="text817"><tspan\n         sodipodi:role="line"\n         id="tspan815"\n         x="28.969419"\n         y="241.2182"\n         style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:Calibri;-inkscape-font-specification:\'Calibri Bold\';fill:#00ff0a;fill-opacity:1;stroke:#000000;stroke-width:2.10750604;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers">N</tspan></text>\n    <text\n       id="text821"\n       y="294.46481"\n       x="30.341665"\n       style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:14.86962605px;line-height:1.25;font-family:Calibri;-inkscape-font-specification:\'Calibri Bold\';letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:2.10750604;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill"\n       xml:space="preserve"><tspan\n         style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:Calibri;-inkscape-font-specification:\'Calibri Bold\';fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:2.10750604;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill"\n         y="294.46481"\n         x="30.341665"\n         id="tspan819"\n         sodipodi:role="line">S</tspan></text>\n    <text\n       xml:space="preserve"\n       style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:12.01801109px;line-height:1.25;font-family:Calibri;-inkscape-font-specification:\'Calibri Bold\';letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:1.70334029;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill"\n       x="2.7455826"\n       y="244.59872"\n       id="text825"\n       transform="scale(0.91513312,1.0927372)"><tspan\n         sodipodi:role="line"\n         id="tspan823"\n         x="2.7455826"\n         y="244.59872"\n         style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:Calibri;-inkscape-font-specification:\'Calibri Bold\';letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:1.70334029;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill">W</tspan></text>\n    <text\n       id="text829"\n       y="267.8309"\n       x="56.043221"\n       style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:14.86962605px;line-height:1.25;font-family:Calibri;-inkscape-font-specification:\'Calibri Bold\';letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:2.10750604;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill"\n       xml:space="preserve"><tspan\n         style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:Calibri;-inkscape-font-specification:\'Calibri Bold\';fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:2.10750604;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill"\n         y="267.8309"\n         x="56.043221"\n         id="tspan827"\n         sodipodi:role="line">E</tspan></text>\n  </g>\n</svg>\n\n',VIEW_PRESETS={top:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-90)},right:{heading:Cesium.Math.toRadians(90),pitch:Cesium.Math.toRadians(-45)},left:{heading:Cesium.Math.toRadians(-90),pitch:Cesium.Math.toRadians(-45)}};function flyToTilesetsWithPreset(viewer,union,presetKey="top",duration=.8,range=600){if("left"===presetKey|"right"===presetKey)return void alert("해당 서비스 준비중입니다.");if(!union)return;const preset=VIEW_PRESETS[presetKey]||VIEW_PRESETS.top;viewer.scene.camera.flyToBoundingSphere(union,{duration:duration,offset:new Cesium.HeadingPitchRange(preset.heading,preset.pitch,range),easingFunction:Cesium.EasingFunction.SINUSOIDAL_IN_OUT})}function CameraFreeMode({cesiumViewer:cesiumViewer}){let handler,startMousePosition,mousePosition,enabled=!1,viewer=cesiumViewer,looking=!1;const PITCH_MIN=Cesium.Math.toRadians(-89),PITCH_MAX=Cesium.Math.toRadians(89);let headingTemp=0,pitchTemp=0;const flags={moveForward:!1,moveBackward:!1,moveUp:!1,moveDown:!1,moveLeft:!1,moveRight:!1},keyDown=e=>{const m={KeyW:"moveForward",KeyS:"moveBackward",KeyQ:"moveUp",KeyE:"moveDown",KeyA:"moveLeft",KeyD:"moveRight"}[e.code];m&&(flags[m]=!0)},keyUp=e=>{const m={KeyW:"moveForward",KeyS:"moveBackward",KeyQ:"moveUp",KeyE:"moveDown",KeyA:"moveLeft",KeyD:"moveRight"}[e.code];m&&(flags[m]=!1)};function setDefaultControls(enabled){const c=viewer.scene.screenSpaceCameraController;c.enableRotate=enabled,c.enableTranslate=enabled,c.enableZoom=enabled,c.enableTilt=enabled,c.enableLook=enabled}function onTick(){const camera=viewer.camera,canvas=viewer.canvas,ellipsoid=viewer.scene.globe.ellipsoid;if(looking){const w=canvas.clientWidth,h=canvas.clientHeight,dx=(mousePosition.x-startMousePosition.x)/w,dy=(mousePosition.y-startMousePosition.y)/h,dHeading=Cesium.Math.toRadians(180*dx*.25),dPitch=Cesium.Math.toRadians(180*-dy*.25);let newHeading=headingTemp+dHeading,newPitch=Cesium.Math.clamp(pitchTemp+dPitch,PITCH_MIN,PITCH_MAX);newHeading=Cesium.Math.negativePiToPi(newHeading),camera.setView({orientation:new Cesium.HeadingPitchRoll(newHeading,newPitch,0)})}const moveRate=ellipsoid.cartesianToCartographic(camera.position).height/100;flags.moveForward&&camera.moveForward(moveRate),flags.moveBackward&&camera.moveBackward(moveRate),flags.moveUp&&camera.moveUp(moveRate),flags.moveDown&&camera.moveDown(moveRate),flags.moveLeft&&camera.moveLeft(moveRate),flags.moveRight&&camera.moveRight(moveRate)}function placeFreeHelp(){const $tb=$(viewer.container),$fh=$("#freeHelp");if(!$tb.length||!$fh.length)return;const r=$tb[0].getBoundingClientRect();$fh.css({left:`${r.left+r.width/2}px`,bottom:"8px",transform:"translateX(-50%)"})}return{enable:function(){viewer&&(enabled||(setDefaultControls(!1),viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),handler||(handler=new Cesium.ScreenSpaceEventHandler(viewer.canvas)),handler.setInputAction(movement=>{looking=!0,mousePosition=startMousePosition=Cesium.Cartesian3.clone(movement.position),headingTemp=viewer.camera.heading,pitchTemp=Cesium.Math.clamp(viewer.camera.pitch,PITCH_MIN,PITCH_MAX)},Cesium.ScreenSpaceEventType.LEFT_DOWN),handler.setInputAction(movement=>{mousePosition=movement.endPosition},Cesium.ScreenSpaceEventType.MOUSE_MOVE),handler.setInputAction(()=>{looking=!1},Cesium.ScreenSpaceEventType.LEFT_UP),document.addEventListener("keydown",keyDown),document.addEventListener("keyup",keyUp),viewer.clock.onTick.addEventListener(onTick),$("#freeHelp").length||($("body").append('\n            <div id="freeHelp" class="free-help" role="dialog" aria-live="polite">\n            <div class="row"><kbd>W / S</kbd><div>앞/뒤 이동</div></div>\n            <div class="row"><kbd>A / D</kbd><div>좌/우 이동</div></div>\n            <div class="row"><kbd>Q / E</kbd><div>상/하 이동</div></div>\n            <div class="row"><kbd>마우스 드래그</kbd><div>회전(좌·우 / 상·하)</div></div>\n            </div>\n        '),placeFreeHelp(),$(window).on("resize.freehelp scroll.freehelp",placeFreeHelp)),enabled=!0))},disable:function(){viewer&&enabled&&(viewer.clock.onTick.removeEventListener(onTick),document.removeEventListener("keydown",keyDown),document.removeEventListener("keyup",keyUp),handler&&(handler.destroy(),handler=void 0),looking=!1,Object.keys(flags).forEach(k=>flags[k]=!1),setDefaultControls(!0),$(window).off(".freehelp"),$("#freeHelp").remove(),enabled=!1)}}}function Measurement({cesiumViewer:cesiumViewer}){let mode,floatingPoint,activeShape,mouseLabel,prevCursor,viewer=cesiumViewer,handler=new Cesium.ScreenSpaceEventHandler(viewer.canvas),areaOptions="ground",activeShapePoints=[],keydownHandler=null,measureEndEntity={graphics:[],points:[],labels:[]},session={points:[],labels:[],graphics:[]};function offHandler(){handler&&(handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK),handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK))}function resetSession(){session.graphics.forEach(function(g){viewer.entities.remove(g)}),session.points.forEach(function(p){viewer.entities.remove(p)}),session.labels.forEach(function(l){viewer.entities.remove(l)}),session.graphics=[],session.points=[],session.labels=[],activeShape&&viewer.entities.remove(activeShape),floatingPoint&&viewer.entities.remove(floatingPoint),activeShape=void 0,floatingPoint=void 0,activeShapePoints=[]}function createLabel(pos,text,options={}){const LABEL_STYLE_font="bold 11px Inter, Pretendard, system-ui, sans-serif",LABEL_STYLE_rowH=22,LABEL_STYLE_padX=8,LABEL_STYLE_radius=11,LABEL_STYLE_gap=5,LABEL_STYLE_fg="#FFFFFF",LABEL_STYLE_scale=1,parts=String(text).split(/\n/).map(s=>s.trim()).filter(Boolean),axes=["경도","위도","높이"],colors=["#E53935","#22C55E","#1E88E5"],lines=parts.length>1?parts.map((v,i)=>`${axes[i]||""}${axes[i]?" : ":""}${v}${2===i?" m":""}`):[text];var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");ctx.font=LABEL_STYLE_font;let maxTextW=0;for(const s of lines)maxTextW=Math.max(maxTextW,Math.ceil(ctx.measureText(s).width));const w=maxTextW+2*LABEL_STYLE_padX,h=lines.length>1?lines.length*LABEL_STYLE_rowH+(lines.length-1)*LABEL_STYLE_gap:LABEL_STYLE_rowH;var dpr=Math.min(1.5,window.devicePixelRatio||1);function roundRect(x,y,w,h,r){ctx.beginPath(),ctx.moveTo(x+r,y),ctx.arcTo(x+w,y,x+w,y+h,r),ctx.arcTo(x+w,y+h,x,y+h,r),ctx.arcTo(x,y+h,x,y,r),ctx.arcTo(x,y,x+w,y,r),ctx.closePath()}canvas.width=Math.max(2,Math.round(w*dpr)),canvas.height=Math.max(2,Math.round(h*dpr)),ctx.scale(dpr,dpr),ctx.font=LABEL_STYLE_font,ctx.textBaseline="middle",ctx.textAlign="center";let y=0;for(let i=0;i<lines.length;i++){const bg=lines.length>1?colors[i%colors.length]:"#2F80FF";ctx.fillStyle=bg,roundRect(0,y,w,LABEL_STYLE_rowH,LABEL_STYLE_radius),ctx.fill(),ctx.fillStyle=LABEL_STYLE_fg,ctx.fillText(lines[i],w/2,y+LABEL_STYLE_rowH/2),y+=LABEL_STYLE_rowH+(i<lines.length-1?LABEL_STYLE_gap:0)}const placeRight=!0===options.point,horizontalOrigin=placeRight?Cesium.HorizontalOrigin.LEFT:Cesium.HorizontalOrigin.CENTER,verticalOrigin=Cesium.VerticalOrigin.CENTER,pixelOffset=placeRight?new Cesium.Cartesian2(12,0):new Cesium.Cartesian2(0,-20);return viewer.entities.add({position:pos,billboard:{image:canvas,horizontalOrigin:horizontalOrigin,verticalOrigin:verticalOrigin,scale:LABEL_STYLE_scale,pixelOffset:pixelOffset,eyeOffset:new Cesium.Cartesian3(0,0,-1),heightReference:Cesium.HeightReference.NONE,disableDepthTestDistance:Number.POSITIVE_INFINITY}})}function createPoint(pos){return viewer.entities.add({position:pos,point:{pixelSize:6,outlineWidth:2,color:Cesium.Color.fromCssColorString("#FFFFFF"),outlineColor:Cesium.Color.fromCssColorString("#2F80FF"),heightReference:Cesium.HeightReference.NONE,disableDepthTestDistance:Number.POSITIVE_INFINITY}})}function drawShape(positionData,clickEvtType){function getLineMaterial(isFinal){return isFinal?Cesium.Color.fromCssColorString("#2F80FF"):new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.fromCssColorString("#2F80FF")})}function addPolyline(positions,material){return viewer.entities.add({polyline:{positions:positions,clampToGround:!1,arcType:Cesium.ArcType.NONE,width:2.5,material:material,depthFailMaterial:material}})}const isFinal=clickEvtType===Cesium.ScreenSpaceEventType.RIGHT_CLICK;return"D"===mode?addPolyline(positionData,getLineMaterial(isFinal)):"A"===mode?"ground"===areaOptions?(hierarchy=positionData,viewer.entities.add({polygon:{hierarchy:hierarchy,material:Cesium.Color.fromCssColorString("rgba(47,128,255,0.25)"),outline:!0,outlineColor:Cesium.Color.fromCssColorString("#2F80FF"),outlineWidth:1.5}})):addPolyline(positionData,getLineMaterial(isFinal)):void 0;var hierarchy}function bindDrawing(){handler.setInputAction(function(){viewer.trackedEntity=void 0},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),handler.setInputAction(async function(movement){var cart=viewer.scene.pickPosition(movement.position);if(Cesium.defined(cart)){if("P"===mode){const feature=viewer.scene.pick(movement.position);if(!Cesium.defined(feature))return;const cartographic=Cesium.Cartographic.fromCartesian(cart),lon=Cesium.Math.toDegrees(cartographic.longitude).toFixed(6),lat=Cesium.Math.toDegrees(cartographic.latitude).toFixed(6),height=cartographic.height.toFixed(2);return measureEndEntity.points.push(createPoint(cart)),void measureEndEntity.labels.push(createLabel(cart,`${lon}\n${lat}\n${height}`,{point:!0}))}if("V"===mode){const feature=viewer.scene.pick(movement.position);if(!Cesium.defined(feature))return;return void await async function(screenPos){const scene=viewer.scene;if(!scene.pickPositionSupported)return;const cartModel=scene.pickPosition(screenPos);if(!Cesium.defined(cartModel))return;const cg=Cesium.Cartographic.fromCartesian(cartModel),modelHeight=cg.height,cp=new Cesium.Cartographic(cg.longitude,cg.latitude,0);let terrainHeight=await async function(cp){const globe=viewer.scene.globe,tp=globe.terrainProvider;try{if(tp.availability){if(tp.hasMetadata){const[res]=await Cesium.sampleTerrainMostDetailed(tp,[cp]);return res.height}return globe.getHeight(cp)??0}}catch(e){return globe.getHeight(cp)??0}}(cp);const dz=modelHeight-terrainHeight,absDz=Math.abs(dz),cartTerrain=Cesium.Cartesian3.fromRadians(cp.longitude,cp.latitude,terrainHeight),verticalLine=viewer.entities.add({polyline:{positions:[cartModel,cartTerrain],width:2.5,arcType:Cesium.ArcType.NONE,clampToGround:!1,material:Cesium.Color.fromCssColorString("#fff200ff").withAlpha(1),depthFailMaterial:Cesium.Color.fromCssColorString("#fff200ff")}});measureEndEntity.graphics.push(verticalLine);const label=createLabel(Cesium.Cartesian3.midpoint(cartModel,cartTerrain,new Cesium.Cartesian3),`수직 거리: ${absDz.toFixed(2)} m`);measureEndEntity.labels.push(label);const pModel=viewer.entities.add({position:cartModel,point:{pixelSize:6,color:Cesium.Color.WHITE,disableDepthTestDistance:Number.POSITIVE_INFINITY}});measureEndEntity.points.push(pModel);const pTerr=viewer.entities.add({position:cartTerrain,point:{pixelSize:6,color:Cesium.Color.WHITE,outlineColor:Cesium.Color.BLACK,outlineWidth:1.5,disableDepthTestDistance:Number.POSITIVE_INFINITY}});return measureEndEntity.points.push(pTerr),{verticalLine:verticalLine,label:label,pModel:pModel,pTerr:pTerr}}(movement.position)}var dynamicPositions;if(0===activeShapePoints.length)resetSession(),floatingPoint=createPoint(cart),activeShapePoints.push(cart),dynamicPositions="D"===mode?new Cesium.CallbackProperty(function(){return activeShapePoints},!1):"ground"===areaOptions?new Cesium.CallbackProperty(function(){return new Cesium.PolygonHierarchy(activeShapePoints)},!1):new Cesium.CallbackProperty(function(){const pts=activeShapePoints;return 0===pts.length?[]:pts.length>1?pts.concat([pts[0]]):pts},!1),activeShape=drawShape(dynamicPositions),session.graphics.push(activeShape);if(activeShapePoints.length>1&&"D"===mode){var prev=activeShapePoints[activeShapePoints.length-2],dist=Cesium.Cartesian3.distance(cart,prev),segLabel=createLabel(Cesium.Cartesian3.midpoint(prev,cart,new Cesium.Cartesian3),dist>1e3?(dist/1e3).toFixed(3)+"km":dist.toFixed(2)+"m");session.labels.push(segLabel)}activeShapePoints.push(cart);var p=createPoint(cart);session.points.push(p)}},Cesium.ScreenSpaceEventType.LEFT_CLICK),handler.setInputAction(function(movement){if(function(screenPosition){ensureMouseLabel();const scene=viewer.scene;let cart=scene.pickPositionSupported?scene.pickPosition(screenPosition):void 0;Cesium.defined(cart)||(cart=scene.camera.pickEllipsoid(screenPosition,scene.globe.ellipsoid));if(!Cesium.defined(cart))return void(mouseLabel.show=!1);mouseLabel.position=cart,mouseLabel.show=!0,mouseLabel.label.show=!0}(movement.endPosition,setMouseLabelText(mode)),Cesium.defined(floatingPoint)){var np=viewer.scene.pickPosition(movement.endPosition);Cesium.defined(np)&&(floatingPoint.position.setValue(np),activeShapePoints.pop(),activeShapePoints.push(np))}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),handler.setInputAction(function(){if("A"===mode){if(session.points.length<3)return void alert("면적 측정 : 기본 3개 이상의 점이 필요합니다");if("ground"===areaOptions){for(var hierarchy=activeShape.polygon.hierarchy.getValue(),indices=Cesium.PolygonPipeline.triangulate(hierarchy.positions),area=0,i=0;i<indices.length;i+=3){var v1=hierarchy.positions[indices[i]],v2=hierarchy.positions[indices[i+1]],v3=hierarchy.positions[indices[i+2]],vc=Cesium.Cartesian3.subtract(v2,v1,new Cesium.Cartesian3),vd=Cesium.Cartesian3.subtract(v3,v1,new Cesium.Cartesian3),cross=Cesium.Cartesian3.cross(vc,vd,new Cesium.Cartesian3);area+=Cesium.Cartesian3.magnitude(cross)/2}var txt="면적 : "+area.toFixed(2)+"m²",areaLabel=createLabel(Cesium.BoundingSphere.fromPoints(hierarchy.positions).center,txt);session.labels.push(areaLabel)}else{const ring=activeShapePoints.slice(),area=function(points){if(!points||points.length<3)return 0;const p0=points[0];let area=0;for(let i=1;i<points.length-1;i++){const v1=Cesium.Cartesian3.subtract(points[i],p0,new Cesium.Cartesian3),v2=Cesium.Cartesian3.subtract(points[i+1],p0,new Cesium.Cartesian3),cross=Cesium.Cartesian3.cross(v1,v2,new Cesium.Cartesian3);area+=.5*Cesium.Cartesian3.magnitude(cross)}return area}(ring),label=createLabel(Cesium.BoundingSphere.fromPoints(ring).center,"면적 : "+area.toFixed(2)+" m²");session.labels.push(label)}}!function(clickEvtType){if(activeShape){var position,arr;activeShapePoints.pop(),position="A"===mode?"ground"===areaOptions?new Cesium.PolygonHierarchy(activeShapePoints):(arr=activeShapePoints).length>2&&arr[0]!==arr[arr.length-1]?arr.concat([arr[0]]):arr:activeShapePoints,viewer.entities.remove(activeShape),activeShape=void 0;var finalShape=drawShape(position,clickEvtType);measureEndEntity.graphics.push(finalShape),floatingPoint&&viewer.entities.remove(floatingPoint),floatingPoint=void 0,Array.prototype.push.apply(measureEndEntity.points,session.points),Array.prototype.push.apply(measureEndEntity.labels,session.labels),session.points=[],session.labels=[],session.graphics=[],activeShapePoints=[],hideMouseLabel()}}(Cesium.ScreenSpaceEventType.RIGHT_CLICK)},Cesium.ScreenSpaceEventType.RIGHT_CLICK)}function ensureMouseLabel(){mouseLabel||(mouseLabel=viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(0,0,0),label:{font:"600 12px Inter, Pretendard, system-ui, sans-serif",style:Cesium.LabelStyle.FILL_AND_OUTLINE,fillColor:Cesium.Color.WHITE,outlineColor:Cesium.Color.fromCssColorString("rgba(0,0,0,0.85)"),outlineWidth:3,showBackground:!0,backgroundColor:Cesium.Color.fromCssColorString("#444444ff").withAlpha(1),backgroundPadding:new Cesium.Cartesian2(8,6),horizontalOrigin:Cesium.HorizontalOrigin.LEFT,verticalOrigin:Cesium.VerticalOrigin.TOP,pixelOffset:new Cesium.Cartesian2(12,12),disableDepthTestDistance:Number.POSITIVE_INFINITY},show:!1}))}function setMouseLabelText(mode){let text="우클릭: 종료\nESC: 취소";return"V"===mode&&(text="좌클릭: 측정\nESC: 취소"),"P"===mode&&(text="좌클릭: 측정\nESC: 취소"),text}function hideMouseLabel(){mouseLabel&&(mouseLabel.label.show=!1)}function setDrawingCursor(on){const canvas=viewer.canvas;canvas&&(on?(prevCursor||(prevCursor=getComputedStyle(canvas).cursor),canvas.style.cursor="crosshair"):(canvas.style.cursor=prevCursor||"auto",prevCursor=null))}return{start:function(m){var canvas;mode=m,resetSession(),offHandler(),bindDrawing(),0!==(canvas=viewer.canvas).tabIndex&&(canvas.tabIndex=0),canvas.addEventListener("click",function(){canvas.focus()}),keydownHandler=function(e){"Escape"!==e.key&&"Esc"!==e.key&&27!==e.keyCode||resetSession()},canvas.addEventListener("keydown",keydownHandler),ensureMouseLabel(),mouseLabel.label.text=setMouseLabelText(mode),setDrawingCursor(!0)},stop:function(){var canvas;offHandler(),resetSession(),(canvas=viewer&&viewer.canvas)&&keydownHandler&&canvas.removeEventListener("keydown",keydownHandler),keydownHandler=null,hideMouseLabel(),setDrawingCursor(!1),mode=void 0},setAreaMode:function(mode){areaOptions="surface"===mode?"surface":"ground"},removeAll:function(){measureEndEntity.graphics.forEach(function(g){viewer.entities.remove(g)}),measureEndEntity.points.forEach(function(p){viewer.entities.remove(p)}),measureEndEntity.labels.forEach(function(l){viewer.entities.remove(l)}),measureEndEntity.graphics=[],measureEndEntity.points=[],measureEndEntity.labels=[]},mountToolBar:function({container:container,onPoint:onPoint,onLine:onLine,onVertical:onVertical,onAreaGround:onAreaGround,onAreaSurface:onAreaSurface,onClose:onClose,onInit:onInit,onMarkerAdd:onMarkerAdd,onMarkerClose:onMarkerClose}){const root="string"==typeof container?document.querySelector(container):container;if(!root)throw new Error("Tool Bar 생성: 유효한 container가 필요합니다.");if(!document.getElementById("dynamic-toolbar-style")){const css='\n                .tool-root{\n                    position:absolute;\n                    left:50%;\n                    bottom:16px;\n                    transform:translateX(-50%);\n                    display:flex;\n                    flex-direction:column;\n                    gap:8px;\n                    z-index:4000;\n                    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans KR",sans-serif;\n                }\n                .tool-group-bar{\n                    display:inline-flex;\n                    align-items:center;\n                    gap:6px;\n                    padding:4px;\n                    border-radius:999px;\n                    background:rgba(11,14,18,.96);\n                    border:1px solid #222a33;\n                }\n                .tool-group{\n                    appearance:none;\n                    border:0;\n                    outline:0;\n                    border-radius:999px;\n                    padding:0 16px;\n                    height:32px;\n                    display:inline-flex;\n                    align-items:center;\n                    justify-content:center;\n                    font-size:11px;\n                    color:#d0d7e2;\n                    background:transparent;\n                    cursor:pointer;\n                    white-space:nowrap;\n                }\n                .tool-group.is-active{\n                    background:#2f80ff;\n                    color:#fff;\n                }\n\n                .tool-panel{\n                    display: none;\n                    flex-direction: column;\n                    /* gap: 8px; */\n                    min-width: 275px;\n                    max-width: calc(100vw - 19px);\n                    padding: 3px 3px;\n                    border-radius: 16px;\n                    background: rgb(11 14 18 / 83%);\n                    border: 1px solid #222a33;\n                }\n                .tool-panel.is-open{\n                    display:flex;\n                }\n\n                .tool-panel-main{\n                    display:flex;\n                    align-items:center;\n                    justify-content:space-between;\n                    gap:12px;\n                }\n                .tool-chip-row{\n                    display:flex;\n                    /*flex-wrap:wrap;*/\n                    gap:6px;\n                }\n                .tool{\n                    border: none;\n                    color: #ffffff;\n                    padding: 6px 10px;\n                    font-size: 11px;\n                    cursor: pointer;\n                    user-select: none;\n                    background: transparent\n                }\n                .tool:hover {\n                    color: #fff;\n                    fill: none;\n                    background: transparent;\n                    box-shadow: 0 0 3px #fff;\n                }\n                .tool.is-active{\n                    color: #fff;\n                    fill: none;\n                    background: transparent;\n                    box-shadow: 0 0 3px #fff;\n                }\n\n                .tool-panel-footer{\n                    display:flex;\n                    align-items:center;\n                    justify-content:end;\n                    margin-top:4px;\n                    padding-top:6px;\n                    border-top:1px solid rgba(255,255,255,.06);\n                    font-size:12px;\n                    color:#9ca6b5;\n                }\n                \n\n                @media (max-width: 480px){\n                    .tool-panel{\n                        min-width:auto;\n                    }\n                }\n                ',style=document.createElement("style");style.id="dynamic-toolbar-style",style.textContent=css,document.head.appendChild(style)}let toolRoot=root.querySelector(".tool-root");toolRoot||(toolRoot=document.createElement("div"),toolRoot.className="tool-root",toolRoot.innerHTML='\n                    \x3c!-- 측정 패널 --\x3e\n                    <div class="tool-panel tool-panel--measure" data-panel="measure">\n                        <div class="tool-panel-main">\n                            <div class="tool-chip-row">\n                                <button class="tool cesium-button" id="btn_point">\n                                    <svg width="22" height="22" viewBox="0 0 22 22" fill="none" class="size-5 flex-shrink-0"><path d="M2.46481 16.6006C2.82352 16.3935 3.28213 16.5163 3.48923 16.875C3.69629 17.2337 3.5734 17.6923 3.21481 17.8994L2.3486 18.3994C1.98989 18.6065 1.5313 18.4837 1.32419 18.125C1.11709 17.7663 1.23994 17.3077 1.5986 17.1006L2.46481 16.6006ZM18.5107 16.875C18.7178 16.5163 19.1764 16.3936 19.5351 16.6006L20.4013 17.1006C20.76 17.3077 20.8829 17.7663 20.6757 18.125C20.4686 18.4837 20.01 18.6065 19.6513 18.3994L18.7851 17.8994C18.4266 17.6923 18.3037 17.2336 18.5107 16.875ZM6.14548 14.4756C6.50418 14.2685 6.9628 14.3913 7.16989 14.75C7.37695 15.1087 7.25407 15.5673 6.89548 15.7744L6.02926 16.2744C5.67056 16.4815 5.21197 16.3587 5.00485 16C4.79776 15.6413 4.9206 15.1827 5.27926 14.9756L6.14548 14.4756ZM14.83 14.75C15.0371 14.3913 15.4958 14.2686 15.8545 14.4756L16.7207 14.9756C17.0794 15.1827 17.2022 15.6413 16.9951 16C16.788 16.3587 16.3294 16.4815 15.9707 16.2744L15.1045 15.7744C14.7459 15.5673 14.623 15.1086 14.83 14.75ZM11 9.5C12.6568 9.5 14 10.8431 14 12.5C14 14.1569 12.6568 15.5 11 15.5C9.34313 15.5 7.99997 14.1568 7.99997 12.5C7.99997 10.8432 9.34313 9.50002 11 9.5ZM11 11C10.1716 11 9.49997 11.6716 9.49997 12.5C9.49997 13.3284 10.1716 14 11 14C11.8284 14 12.5 13.3284 12.5 12.5C12.5 11.6716 11.8284 11 11 11ZM11 5.5C11.4142 5.5 11.75 5.83579 11.75 6.25V7.25C11.75 7.66421 11.4142 8 11 8C10.5858 7.99998 10.25 7.6642 10.25 7.25V6.25C10.25 5.8358 10.5858 5.50002 11 5.5ZM11 1.25C11.4142 1.25 11.75 1.58579 11.75 2V3C11.75 3.41421 11.4142 3.75 11 3.75C10.5858 3.74998 10.25 3.4142 10.25 3V2C10.25 1.5858 10.5858 1.25002 11 1.25Z" fill="currentColor"></path></svg>\n                                </button>\n                                <button class="tool cesium-button" id="btn_line">\n                                    <svg width="22" height="22" viewBox="0 0 22 22" fill="none" class="size-5 flex-shrink-0"><path d="M3 16C4.65685 16 6 17.3431 6 19C6 20.6569 4.65685 22 3 22C1.34315 22 0 20.6569 0 19C0 17.3431 1.34315 16 3 16ZM3 17.5C2.17157 17.5 1.5 18.1716 1.5 19C1.5 19.8284 2.17157 20.5 3 20.5C3.82843 20.5 4.5 19.8284 4.5 19C4.5 18.1716 3.82843 17.5 3 17.5ZM7.07324 13.8662C7.36614 13.5733 7.8409 13.5733 8.13379 13.8662C8.42668 14.1591 8.42668 14.6339 8.13379 14.9268L7.42676 15.6338C7.13386 15.9267 6.6591 15.9267 6.36621 15.6338C6.07332 15.3409 6.07332 14.8661 6.36621 14.5732L7.07324 13.8662ZM10.8232 10.1162C11.1161 9.82332 11.5909 9.82332 11.8838 10.1162C12.1767 10.4091 12.1767 10.8839 11.8838 11.1768L11.1768 11.8838C10.8839 12.1767 10.4091 12.1767 10.1162 11.8838C9.82332 11.5909 9.82332 11.1161 10.1162 10.8232L10.8232 10.1162ZM14.5732 6.36621C14.8661 6.07332 15.3409 6.07332 15.6338 6.36621C15.9267 6.6591 15.9267 7.13386 15.6338 7.42676L14.9268 8.13379C14.6339 8.42668 14.1591 8.42668 13.8662 8.13379C13.5733 7.8409 13.5733 7.36614 13.8662 7.07324L14.5732 6.36621ZM19 0C20.6569 0 22 1.34315 22 3C22 4.65685 20.6569 6 19 6C17.3431 6 16 4.65685 16 3C16 1.34315 17.3431 0 19 0ZM19 1.5C18.1716 1.5 17.5 2.17157 17.5 3C17.5 3.82843 18.1716 4.5 19 4.5C19.8284 4.5 20.5 3.82843 20.5 3C20.5 2.17157 19.8284 1.5 19 1.5Z" fill="currentColor"></path></svg>\n                                </button>\n                                \n                                <button class="tool cesium-button" id="btn_vertical">\n                                    <svg width="22" height="22" viewBox="0 0 22 22" fill="none" class="size-5 flex-shrink-0"><path d="M11 16C12.3976 16 13.569 16.9565 13.9023 18.25H19C19.4142 18.25 19.75 18.5858 19.75 19C19.75 19.4142 19.4142 19.75 19 19.75H13.9023C13.569 21.0435 12.3976 22 11 22C9.59958 22 8.42628 21.0397 8.0957 19.7422C8.06429 19.7462 8.0325 19.75 8 19.75H3C2.58579 19.75 2.25 19.4142 2.25 19C2.25 18.5858 2.58579 18.25 3 18.25H8C8.03246 18.25 8.06433 18.2528 8.0957 18.2568C8.4266 16.9598 9.59991 16 11 16ZM11 17.5C10.1716 17.5 9.5 18.1716 9.5 19C9.5 19.8284 10.1716 20.5 11 20.5C11.8284 20.5 12.5 19.8284 12.5 19C12.5 18.1716 11.8284 17.5 11 17.5ZM11 11.75C11.4142 11.75 11.75 12.0858 11.75 12.5V13.5C11.75 13.9142 11.4142 14.25 11 14.25C10.5858 14.25 10.25 13.9142 10.25 13.5V12.5C10.25 12.0858 10.5858 11.75 11 11.75ZM11 7.75C11.4142 7.75 11.75 8.08579 11.75 8.5V9.5C11.75 9.91421 11.4142 10.25 11 10.25C10.5858 10.25 10.25 9.91421 10.25 9.5V8.5C10.25 8.08579 10.5858 7.75 11 7.75ZM11 0C12.3976 0 13.569 0.956465 13.9023 2.25H19C19.4142 2.25 19.75 2.58579 19.75 3C19.75 3.41421 19.4142 3.75 19 3.75H13.9023C13.569 5.04354 12.3976 6 11 6C9.59958 6 8.42628 5.03968 8.0957 3.74219C8.06429 3.7462 8.0325 3.75 8 3.75H3C2.58579 3.75 2.25 3.41421 2.25 3C2.25 2.58579 2.58579 2.25 3 2.25H8C8.03246 2.25 8.06433 2.25284 8.0957 2.25684C8.4266 0.959806 9.59991 0 11 0ZM11 1.5C10.1716 1.5 9.5 2.17157 9.5 3C9.5 3.82843 10.1716 4.5 11 4.5C11.8284 4.5 12.5 3.82843 12.5 3C12.5 2.17157 11.8284 1.5 11 1.5Z" fill="currentColor"></path></svg>\n                                </button>\n                                <button class="tool cesium-button" id="btn_ground">\n                                    <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">\n                                    <g transform="rotate(315 13 7.5) scale(0.8)">\n                                        <path d="M3 16C4.65685 16 6 17.3431 6 19C6 20.6569 4.65685 22 3 22C1.34315 22 0 20.6569 0 19C0 17.3431 1.34315 16 3 16ZM19 16C20.6569 16 22 17.3431 22 19C22 20.6569 20.6569 22 19 22C17.3431 22 16 20.6569 16 19C16 17.3431 17.3431 16 19 16ZM3 17.5C2.17157 17.5 1.5 18.1716 1.5 19C1.5 19.8284 2.17157 20.5 3 20.5C3.82843 20.5 4.5 19.8284 4.5 19C4.5 18.1716 3.82843 17.5 3 17.5ZM19 17.5C18.1716 17.5 17.5 18.1716 17.5 19C17.5 19.8284 18.1716 20.5 19 20.5C19.8284 20.5 20.5 19.8284 20.5 19C20.5 18.1716 19.8284 17.5 19 17.5ZM9.5 18.25C9.91421 18.25 10.25 18.5858 10.25 19C10.25 19.4142 9.91421 19.75 9.5 19.75H8.5C8.08579 19.75 7.75 19.4142 7.75 19C7.75 18.5858 8.08579 18.25 8.5 18.25H9.5ZM13.5 18.25C13.9142 18.25 14.25 18.5858 14.25 19C14.25 19.4142 13.9142 19.75 13.5 19.75H12.5C12.0858 19.75 11.75 19.4142 11.75 19C11.75 18.5858 12.0858 18.25 12.5 18.25H13.5ZM3 11.75C3.41421 11.75 3.75 12.0858 3.75 12.5V13.5C3.75 13.9142 3.41421 14.25 3 14.25C2.58579 14.25 2.25 13.9142 2.25 13.5V12.5C2.25 12.0858 2.58579 11.75 3 11.75ZM19 11.75C19.4142 11.75 19.75 12.0858 19.75 12.5V13.5C19.75 13.9142 19.4142 14.25 19 14.25C18.5858 14.25 18.25 13.9142 18.25 13.5V12.5C18.25 12.0858 18.5858 11.75 19 11.75ZM3 7.75C3.41421 7.75 3.75 8.08579 3.75 8.5V9.5C3.75 9.91421 3.41421 10.25 3 10.25C2.58579 10.25 2.25 9.91421 2.25 9.5V8.5C2.25 8.08579 2.58579 7.75 3 7.75ZM19 7.75C19.4142 7.75 19.75 8.08579 19.75 8.5V9.5C19.75 9.91421 19.4142 10.25 19 10.25C18.5858 10.25 18.25 9.91421 18.25 9.5V8.5C18.25 8.08579 18.5858 7.75 19 7.75ZM3 0C4.65685 0 6 1.34315 6 3C6 4.65685 4.65685 6 3 6C1.34315 6 0 4.65685 0 3C0 1.34315 1.34315 0 3 0ZM19 0C20.6569 0 22 1.34315 22 3C22 4.65685 20.6569 6 19 6C17.3431 6 16 4.65685 16 3C16 1.34315 17.3431 0 19 0ZM3 1.5C2.17157 1.5 1.5 2.17157 1.5 3C1.5 3.82843 2.17157 4.5 3 4.5C3.82843 4.5 4.5 3.82843 4.5 3C4.5 2.17157 3.82843 1.5 3 1.5ZM19 1.5C18.1716 1.5 17.5 2.17157 17.5 3C17.5 3.82843 18.1716 4.5 19 4.5C19.8284 4.5 20.5 3.82843 20.5 3C20.5 2.17157 19.8284 1.5 19 1.5ZM9.5 2.25C9.91421 2.25 10.25 2.58579 10.25 3C10.25 3.41421 9.91421 3.75 9.5 3.75H8.5C8.08579 3.75 7.75 3.41421 7.75 3C7.75 2.58579 8.08579 2.25 8.5 2.25H9.5ZM13.5 2.25C13.9142 2.25 14.25 2.58579 14.25 3C14.25 3.41421 13.9142 3.75 13.5 3.75H12.5C12.0858 3.75 11.75 3.41421 11.75 3C11.75 2.58579 12.0858 2.25 12.5 2.25H13.5Z" fill="currentColor"></path>\n                                    </g>\n                                    <rect x="2" y="20.2" width="18" height="1.1" rx="0.55" fill="currentColor"></rect>\n                                    </svg>\n                                </button>\n                                <button class="tool cesium-button" id="btn_surface">\n                                    <svg width="22" height="22" viewBox="0 0 22 22" fill="none" class="size-5 flex-shrink-0"><path d="M3 16C4.65685 16 6 17.3431 6 19C6 20.6569 4.65685 22 3 22C1.34315 22 0 20.6569 0 19C0 17.3431 1.34315 16 3 16ZM19 16C20.6569 16 22 17.3431 22 19C22 20.6569 20.6569 22 19 22C17.3431 22 16 20.6569 16 19C16 17.3431 17.3431 16 19 16ZM3 17.5C2.17157 17.5 1.5 18.1716 1.5 19C1.5 19.8284 2.17157 20.5 3 20.5C3.82843 20.5 4.5 19.8284 4.5 19C4.5 18.1716 3.82843 17.5 3 17.5ZM19 17.5C18.1716 17.5 17.5 18.1716 17.5 19C17.5 19.8284 18.1716 20.5 19 20.5C19.8284 20.5 20.5 19.8284 20.5 19C20.5 18.1716 19.8284 17.5 19 17.5ZM9.5 18.25C9.91421 18.25 10.25 18.5858 10.25 19C10.25 19.4142 9.91421 19.75 9.5 19.75H8.5C8.08579 19.75 7.75 19.4142 7.75 19C7.75 18.5858 8.08579 18.25 8.5 18.25H9.5ZM13.5 18.25C13.9142 18.25 14.25 18.5858 14.25 19C14.25 19.4142 13.9142 19.75 13.5 19.75H12.5C12.0858 19.75 11.75 19.4142 11.75 19C11.75 18.5858 12.0858 18.25 12.5 18.25H13.5ZM3 11.75C3.41421 11.75 3.75 12.0858 3.75 12.5V13.5C3.75 13.9142 3.41421 14.25 3 14.25C2.58579 14.25 2.25 13.9142 2.25 13.5V12.5C2.25 12.0858 2.58579 11.75 3 11.75ZM19 11.75C19.4142 11.75 19.75 12.0858 19.75 12.5V13.5C19.75 13.9142 19.4142 14.25 19 14.25C18.5858 14.25 18.25 13.9142 18.25 13.5V12.5C18.25 12.0858 18.5858 11.75 19 11.75ZM3 7.75C3.41421 7.75 3.75 8.08579 3.75 8.5V9.5C3.75 9.91421 3.41421 10.25 3 10.25C2.58579 10.25 2.25 9.91421 2.25 9.5V8.5C2.25 8.08579 2.58579 7.75 3 7.75ZM19 7.75C19.4142 7.75 19.75 8.08579 19.75 8.5V9.5C19.75 9.91421 19.4142 10.25 19 10.25C18.5858 10.25 18.25 9.91421 18.25 9.5V8.5C18.25 8.08579 18.5858 7.75 19 7.75ZM3 0C4.65685 0 6 1.34315 6 3C6 4.65685 4.65685 6 3 6C1.34315 6 0 4.65685 0 3C0 1.34315 1.34315 0 3 0ZM19 0C20.6569 0 22 1.34315 22 3C22 4.65685 20.6569 6 19 6C17.3431 6 16 4.65685 16 3C16 1.34315 17.3431 0 19 0ZM3 1.5C2.17157 1.5 1.5 2.17157 1.5 3C1.5 3.82843 2.17157 4.5 3 4.5C3.82843 4.5 4.5 3.82843 4.5 3C4.5 2.17157 3.82843 1.5 3 1.5ZM19 1.5C18.1716 1.5 17.5 2.17157 17.5 3C17.5 3.82843 18.1716 4.5 19 4.5C19.8284 4.5 20.5 3.82843 20.5 3C20.5 2.17157 19.8284 1.5 19 1.5ZM9.5 2.25C9.91421 2.25 10.25 2.58579 10.25 3C10.25 3.41421 9.91421 3.75 9.5 3.75H8.5C8.08579 3.75 7.75 3.41421 7.75 3C7.75 2.58579 8.08579 2.25 8.5 2.25H9.5ZM13.5 2.25C13.9142 2.25 14.25 2.58579 14.25 3C14.25 3.41421 13.9142 3.75 13.5 3.75H12.5C12.0858 3.75 11.75 3.41421 11.75 3C11.75 2.58579 12.0858 2.25 12.5 2.25H13.5Z" fill="currentColor"></path>\n                                    </svg>\n                                    </button>\n                            </div>\n                        </div>\n                        <div class="tool-panel-footer">\n                            <button class="tool cesium-button" id="btn_init">초기화</button>\n                            <button class="tool cesium-button" id="btn_close">종료</button>\n                        </div>\n                    </div>\n\n                    \x3c!-- 마커 패널 --\x3e\n                    <div class="tool-panel tool-panel--marker" data-panel="marker">\n                        <div class="tool-panel-main">\n                            <div class="tool-chip-row">\n                                <button class="tool cesium-button" id="btn_marker_point">포인트 마커</button>\n                                <button class="tool cesium-button" id="btn_marker_line">라인 마커</button>\n                            </div>\n                        </div>\n                        <div class="tool-panel-footer">\n                            <button class="tool cesium-button" id="btn_marker_init">초기화</button>\n                            <button class="tool cesium-button" id="btn_marker_close">종료</button>\n                        </div>\n                    </div>\n                    \x3c!-- 도구 그룹--\x3e\n                    <div class="tool-group-bar">\n                        <button class="tool-group" id="group-measure">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide size-5 lucide-ruler-icon lucide-ruler size-5"><path d="M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z"></path><path d="m14.5 12.5 2-2"></path><path d="m11.5 9.5 2-2"></path><path d="m8.5 6.5 2-2"></path><path d="m17.5 15.5 2-2"></path></svg>\n                        </button>\n                        <button class="tool-group" id="group-marker">\n                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" class="size-5"><path d="M6.5 18.4999H16.5C17.6046 18.4999 18.5 17.6044 18.5 16.4999C18.5 15.3953 17.6046 14.4999 16.5 14.4999H3.5C2.39543 14.4999 1.5 13.6044 1.5 12.4999C1.5 11.3953 2.39543 10.4999 3.5 10.4999H7.5M17.815 4.52155C18.147 4.18958 18.3335 3.73935 18.3335 3.26988C18.3335 2.80041 18.147 2.35018 17.815 2.01821C17.483 1.68625 17.0328 1.49976 16.5633 1.49976C16.0939 1.49976 15.6436 1.68625 15.3117 2.01821L10.97 6.36155C10.7719 6.55956 10.6269 6.80432 10.5483 7.07321L9.85083 9.46488C9.82992 9.53659 9.82867 9.6126 9.8472 9.68496C9.86574 9.75731 9.90339 9.82336 9.95621 9.87617C10.009 9.92899 10.0751 9.96664 10.1474 9.98518C10.2198 10.0037 10.2958 10.0025 10.3675 9.98155L12.7592 9.28405C13.0281 9.20553 13.2728 9.06051 13.4708 8.86238L17.815 4.52155Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>\n                        </button>\n                    </div>\n                ',root.appendChild(toolRoot));const $rootWrap=$(toolRoot),$groupMeasure=$rootWrap.find("#group-measure"),$groupMarker=$rootWrap.find("#group-marker"),$measurePanel=$rootWrap.find(".tool-panel--measure"),$markerPanel=$rootWrap.find(".tool-panel--marker"),$tools=$measurePanel.find(".tool"),$btnPoint=$measurePanel.find("#btn_point"),$btnLine=$measurePanel.find("#btn_line"),$btnVert=$measurePanel.find("#btn_vertical"),$btnAreaG=$measurePanel.find("#btn_ground"),$btnAreaS=$measurePanel.find("#btn_surface"),$btnInit=$measurePanel.find("#btn_init"),$btnClose=$measurePanel.find("#btn_close"),$btnMarkerClose=$markerPanel.find("#btn_marker_close"),$btnMarkerInit=$markerPanel.find("#btn_marker_init");let measureOpen=!1,markerOpen=!1;function setActive($btn){$tools.removeClass("is-active"),$btn.addClass("is-active")}function clearActive(){$tools.removeClass("is-active")}function closeAllPanels(){measureOpen=!1,markerOpen=!1,$measurePanel.removeClass("is-open"),$markerPanel.removeClass("is-open"),$groupMeasure.removeClass("is-active"),$groupMarker.removeClass("is-active"),clearActive()}return $groupMeasure.on("click",()=>{measureOpen?(closeAllPanels(),onClose?.()):(measureOpen=!0,markerOpen=!1,$measurePanel.addClass("is-open"),$markerPanel.removeClass("is-open"),$groupMeasure.addClass("is-active"),$groupMarker.removeClass("is-active"))}),$groupMarker.on("click",()=>{alert("해당 서비스 준비중입니다."),markerOpen?closeAllPanels():(markerOpen=!0,measureOpen=!1,$markerPanel.addClass("is-open"),$measurePanel.removeClass("is-open"),$groupMarker.addClass("is-active"),$groupMeasure.removeClass("is-active"),onClose?.())}),$btnPoint.on("click",()=>{setActive($btnPoint),onPoint?.()}),$btnLine.on("click",()=>{setActive($btnLine),onLine?.()}),$btnVert.on("click",()=>{setActive($btnVert),onVertical?.()}),$btnAreaG.on("click",()=>{setActive($btnAreaG),onAreaGround?.()}),$btnAreaS.on("click",()=>{setActive($btnAreaS),onAreaSurface?.()}),$btnInit.on("click",()=>{clearActive(),onInit?.()}),$btnClose.on("click",()=>{clearActive(),onClose?.(),closeAllPanels()}),$btnMarkerInit.on("click",()=>{}),$btnMarkerClose.on("click",()=>{closeAllPanels()}),{showMountToolBar:function(){$rootWrap.css("display","flex")},hiddenMountToolBar:function(){$rootWrap.css("display","none"),closeAllPanels()}}}}}var CesiumHandler=function(){let viewer,handler;Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzYjI4ZjRhOS1lNDdiLTQwYjQtOWUxNC04ZDgxMzA5ZDZkOWYiLCJpZCI6MjQwMDY3LCJpYXQiOjE3NjI5MzU5MTZ9.3Ld8v74q8vXrCIoM0TQGdgqlCUO3pX4UQKmUTSO1Fck";let inspectorBoxEl,inspectorLists,$btnInspectorModelShow,infoBoxEls={},infoBoxEnabled=!1,properties={},inspectorBoxEnabled=!1,inspectorSelectedModel=null,$btnResetHiddenModels=null;const inspectorHiddenModel=new Set;let entityOverlayEl=null;const entityScratch=new Cesium.Cartesian2;let unionTilesetCenter,hoverCheckLastTime=0,currentModelConfig={tilesetUrl:null,propertyUrls:[],info:{text:void 0,iconSrc:void 0,length:100}},loaded_3Dtilesets=[];const hoverState={model:void 0,color:void 0,blendMode:void 0,blendAmount:void 0},selectedState={model:void 0,color:void 0,blendMode:void 0,blendAmount:void 0};var DefaultOption={animation:!1,shouldAnimate:!1,baseLayerPicker:!1,fullscreenButton:!1,vrButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,timeline:!1,navigationHelpButton:!1,trackedEntity:void 0,selectionIndicator:!1,projectionPicker:!1,navigationInstructionsInitiallyVisible:!1,shadows:!1,maximumRenderTimeChange:1/0,sceneMode:Cesium.SceneMode.SCENE3D,terrain:Cesium.Terrain.fromWorldTerrain(),baseLayer:new Cesium.ImageryLayer(new Cesium.UrlTemplateImageryProvider({url:"https://xdworld.vworld.kr/2d/Satellite/service/{z}/{x}/{y}.jpeg",subdomains:"base",minimumLevel:0,maximumLevel:19,rectangle:new Cesium.Rectangle(Cesium.Math.toRadians(-180),Cesium.Math.toRadians(-90),Cesium.Math.toRadians(180),Cesium.Math.toRadians(90))}))};const underFacilitySpecialEvn={translucencyEnabled:!0,fadeByDistance:!0,alpha:.5};let cameraFree,cameraOrbitMode,measurement,toolBarApi;const Mode_NORMAL="normal",Mode_CAMERA_FREE="cameraFree",Mode_ORBIT="orbit",Mode_MEASURE_POINT="measure_point",Mode_MEASURE_DISTANCE="measure_distance",Mode_MEASURE_VERTICAL="measure_vertical",Mode_MEASURE_AREA_GROUND="measure_area_ground",Mode_MEASURE_AREA_SURFACE="measure_area_surface";let currentMode=Mode_NORMAL;function setMode(nextMode){if(currentMode!==nextMode){switch(measurement.stop(),cameraFree.disable(),cameraOrbitMode.disable(),infoBoxEnabled=!1,handler&&handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),function(){inspectorBoxEnabled=!1,handler&&handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);setInspectorBox(!1)}(),restoreModelState(selectedState),toolBarApi&&toolBarApi.showMountToolBar(),nextMode){case Mode_NORMAL:infoBoxEnable(),inspectBoxEnable();break;case Mode_CAMERA_FREE:toolBarApi&&toolBarApi.hiddenMountToolBar(),cameraFree.enable();break;case Mode_ORBIT:toolBarApi&&toolBarApi.hiddenMountToolBar(),cameraOrbitMode.enable(unionTilesetCenter);break;case Mode_MEASURE_POINT:measurement.start("P");break;case Mode_MEASURE_DISTANCE:measurement.start("D");break;case Mode_MEASURE_VERTICAL:return void alert("서비스 준비중입니다.");case Mode_MEASURE_AREA_GROUND:measurement.setAreaMode("ground"),measurement.start("A");break;case Mode_MEASURE_AREA_SURFACE:measurement.setAreaMode("surface"),measurement.start("A")}currentMode=nextMode}}async function applyModelConfig(config={}){const tasks=[];if(config.tilesetUrl){const tilesets=await async function({url:url}){loaded_3Dtilesets.length>0&&loaded_3Dtilesets.forEach(ts=>{viewer.scene.primitives.remove(ts)});if(loaded_3Dtilesets=[],0===url.length)return console.warn("tilesetUrl 이 존재하지 않습니다."),[];const allLoaded=[];for(const u of url){const tilesets=await loadAllTilesets(u);allLoaded.push(...tilesets)}return loaded_3Dtilesets=allLoaded,allLoaded}({url:config.tilesetUrl});unionTilesetCenter=function(loadedTilesets){const paddingScale=1.2,ready=loadedTilesets.filter(t=>t&&t.boundingSphere);if(0===ready.length)return;let union=ready[0].boundingSphere;for(let i=1;i<ready.length;i++)union=Cesium.BoundingSphere.union(union,ready[i].boundingSphere);return union=new Cesium.BoundingSphere(union.center,union.radius*paddingScale),union}(tilesets),flyToTilesetsWithPreset(viewer,unionTilesetCenter,"top",.8,600),tasks.push(tilesets)}return config.info&&(function(){const lineEntity=viewer.entities.getById("entity_line"),iconEntity=viewer.entities.getById("entity_icon");lineEntity&&viewer.entities.remove(lineEntity);iconEntity&&viewer.entities.remove(iconEntity)}(),function(options={}){if(!unionTilesetCenter||!viewer)return;const text=options.text||"Untitled",iconSrc=options.iconSrc||void 0,lineLength=options.length||100,ellipsoid=viewer.scene.globe.ellipsoid,centerCartesian=unionTilesetCenter.center,centerCarto=ellipsoid.cartesianToCartographic(centerCartesian),baseHeight=centerCarto.height,cylinderMidH=baseHeight+lineLength/2,labelHeight=baseHeight+lineLength,cylinderPos=Cesium.Cartesian3.fromRadians(centerCarto.longitude,centerCarto.latitude,cylinderMidH),labelPos=Cesium.Cartesian3.fromRadians(centerCarto.longitude,centerCarto.latitude,labelHeight);viewer.entities.add({id:"entity_line",position:cylinderPos,orientation:Cesium.Transforms.headingPitchRollQuaternion(cylinderPos,new Cesium.HeadingPitchRoll(0,0,0)),cylinder:{length:lineLength,topRadius:.2,bottomRadius:.2,material:Cesium.Color.WHITE.withAlpha(.9),outline:!1,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,8e3)}}),function({text:text,iconSrc:iconSrc,size:size=40,padding:padding=4,bgColor:bgColor="rgba(11, 15, 20, 0.96)",borderColor:borderColor="rgba(255, 233, 33, 1)",shadow:shadow=!0,pixelScale:pixelScale=1.5}={}){const canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),dpr=(window.devicePixelRatio||1)*pixelScale,total=size+2*padding;canvas.width=total*dpr,canvas.height=total*dpr,ctx.scale(dpr,dpr);const cx=total/2,cy=total/2,r=size/2;ctx.save(),shadow&&(ctx.shadowColor="rgba(0,0,0,0.6)",ctx.shadowBlur=8,ctx.shadowOffsetY=2);if(ctx.beginPath(),ctx.arc(cx,cy,r,0,2*Math.PI),ctx.closePath(),ctx.fillStyle=bgColor,ctx.strokeStyle=borderColor,ctx.lineWidth=2,ctx.fill(),ctx.stroke(),ctx.restore(),!iconSrc)return ctx.save(),ctx.font="600 8px sans-serif",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillStyle="#ffffff",ctx.strokeText(text,cx,cy),ctx.fillText(text,cx,cy),ctx.restore(),Promise.resolve(canvas);return new Promise((resolve,reject)=>{const img=new Image;img.onload=()=>{const iconR=.9*r,iconSize=2*iconR,x=cx-iconSize/2,y=cy-iconSize/2;ctx.save(),ctx.beginPath(),ctx.arc(cx,cy,iconR,0,2*Math.PI),ctx.closePath(),ctx.clip(),ctx.drawImage(img,x,y,iconSize,iconSize),ctx.restore(),resolve(canvas)},img.onerror=reject,img.src=iconSrc})}({text:text,iconSrc:iconSrc,size:50,padding:5,pixelScale:1.5}).then(badgeCanvas=>{viewer.entities.add({id:"entity_icon",position:labelPos,properties:{title:`${text}`,desc:"이 영역은 지하시설물 3D 모델의 중심 지점을 나타냅니다."},billboard:{image:badgeCanvas,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,pixelOffset:new Cesium.Cartesian2(0,6),scale:1,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,8e3)}})})}(config.info)),config.propertyUrls&&config.propertyUrls.length&&tasks.push(async function({url:url}){let totalLoaded=0;for(const jsonUrl of url)try{const response=await fetch(jsonUrl);if(!response.ok){console.warn(`JSON 파일 로드 실패 (${response.status}): ${jsonUrl}`);continue}const propertiesData=await response.json();properties={...properties,...propertiesData},totalLoaded+=Object.keys(propertiesData).length}catch(error){console.error(`JSON 로드 실패: ${jsonUrl}`,error)}return console.log(`${totalLoaded}개 객체 로드 완료`),properties}({url:config.propertyUrls})),Promise.all(tasks)}function updateInspectorToggleButton(model){if(inspectorSelectedModel=model,$btnInspectorModelShow)if(model){$btnInspectorModelShow.removeAttr("disabled");const isVisible=!1!==model.show;$btnInspectorModelShow.text(""+(isVisible?"숨김":"보기"))}else $btnInspectorModelShow.attr("disabled"),$btnInspectorModelShow.textContent="숨김"}function injectStyleOnce(id,cssText){document.getElementById(id)||$("<style>",{id:id,text:cssText}).appendTo("head")}function inspectBoxEnable(){inspectorBoxEnabled||(inspectorBoxEnabled=!0,handler&&handler.setInputAction(onMouseLeftClick,Cesium.ScreenSpaceEventType.LEFT_CLICK))}function setInspectorBox(isOpen){if(!inspectorBoxEl)return;const $inspector=$(inspectorBoxEl),$shell=$inspector.closest(".shell"),$btnInspectorClose=$inspector.find("#btnInspectorClose");isOpen?($inspector.removeAttr("hidden"),$shell.removeClass("no-inspector"),$btnInspectorClose.text("닫기"),inspectorBoxEnabled=!0):($inspector.attr("hidden",""),$shell.addClass("no-inspector"),$btnInspectorClose.text("열기"),inspectorBoxEnabled=!1)}function translucencyUpdate(){viewer.scene.globe.translucency.enabled=underFacilitySpecialEvn.translucencyEnabled;let alpha=Number(underFacilitySpecialEvn.alpha);alpha=isNaN(alpha)?1:alpha,alpha=Cesium.Math.clamp(alpha,0,1),viewer.scene.globe.translucency.frontFaceAlphaByDistance.nearValue=alpha,viewer.scene.globe.translucency.frontFaceAlphaByDistance.farValue=underFacilitySpecialEvn.fadeByDistance?1:alpha}async function createTileset(url){if(url)try{const tileset=await Cesium.Cesium3DTileset.fromUrl(url,{shadows:Cesium.ShadowMode.ENABLED,maximumScreenSpaceError:20,skipLevelOfDetail:!0,baseScreenSpaceError:1024,skipScreenSpaceErrorFactor:16,skipLevels:1,immediatelyLoadDesiredLevelOfDetail:!1,loadSiblings:!1,dynamicScreenSpaceError:!0,dynamicScreenSpaceErrorDensity:2e-4,dynamicScreenSpaceErrorFactor:24,dynamicScreenSpaceErrorHeightFalloff:.25,cullWithChildrenBounds:!0,cullRequestsWhileMoving:!0});return viewer.scene.primitives.add(tileset),tileset}catch(error){return void console.error(`Tileset 생성 중 오류 발생: ${error}`)}else console.warn("url이 유효하지 않습니다.")}async function loadAllTilesets(rootTilesetUrl){try{const url=await Promise.resolve(rootTilesetUrl),response=await fetch(url);if(!response.ok)return console.error(`Root tileset 로드 실패: ${response.status}`),[];const rootData=await response.json(),children=rootData.root?.children||[];console.log(`타입별 Tileset: ${children.length}개`);const loadedTilesets=[],baseUrl=url.substring(0,url.lastIndexOf("/")+1);for(const child of children)if(child.content&&child.content.uri){const childUrl=baseUrl+child.content.uri;child.content.uri.replace("_tileset.json","").replace("/tileset.json","");const tileset=await createTileset(childUrl);tileset&&loadedTilesets.push(tileset)}return console.log(`총 ${loadedTilesets.length}개 Tileset 로드 완료`),loadedTilesets}catch(error){return console.error("루트 tileset 처리 실패:",error),[]}}function infoBoxEnable(){infoBoxEnabled||(infoBoxEnabled=!0,handler&&handler.setInputAction(onMouseMove,Cesium.ScreenSpaceEventType.MOUSE_MOVE))}function applyModelHighlight(state,model,color,blendAmount){model&&(state.model=model,state.color=model.color?model.color.clone():Cesium.Color.WHITE.clone(),state.blendMode=model.colorBlendMode,state.blendAmount=model.colorBlendAmount,model.color=color,model.colorBlendMode=Cesium.ColorBlendMode.MIX,model.colorBlendAmount=blendAmount)}function restoreModelState(state){state.model&&(state.color&&(state.model.color=state.color),Cesium.defined(state.blendMode)&&(state.model.colorBlendMode=state.blendMode),"number"==typeof state.blendAmount&&(state.model.colorBlendAmount=state.blendAmount),state.model=void 0,state.color=void 0,state.blendMode=void 0,state.blendAmount=void 0)}function onMouseMove(movement){const scene=viewer.scene,now=performance.now();if(now-hoverCheckLastTime<50)return;hoverCheckLastTime=now;const picked=scene.pick(movement.endPosition);let pickedModel;if(Cesium.defined(picked)&&picked.id&&"entity_icon"===picked.id.id?function(entity){const el=function(){if(entityOverlayEl)return entityOverlayEl;const root=viewer.container,entityOverlay=document.createElement("div");return entityOverlay.id="entity-overlay",entityOverlay.style.cssText="\n                position:absolute;\n                z-index:3000;\n                transform:translate(12px, -50%); /* 아이콘 기준 오른쪽 옆에 표시 */\n                pointer-events:auto;\n                display:none;\n            ",entityOverlay.innerHTML='\n                <div style="\n                    min-width:180px;\n                    max-width:260px;\n                    padding:8px 10px;\n                    border-radius:10px;\n                    background:rgba(11,15,20,0.95);\n                    border:1px solid rgba(255,255,255,0.12);\n                    box-shadow:0 10px 24px rgba(0,0,0,0.6);\n                    color:#e6edf3;\n                    font-size:11px;">\n                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;">\n                        <div style="font-weight:600; font-size:12px;" id="entity-title"></div>\n                    </div>\n                    <div id="entity-body" style="font-size:11px; line-height:1.5;"></div>\n                </div>\n            ',root.appendChild(entityOverlay),entityOverlayEl=entityOverlay,entityOverlay}(),titleEl=el.querySelector("#entity-title"),bodyEl=el.querySelector("#entity-body"),props=entity.properties||{},now=viewer.clock.currentTime,title=props.title?.getValue?.(now)||"지하시설물",desc=props.desc?.getValue?.(now)||"요약 정보가 준비 중입니다.";titleEl.textContent=title,bodyEl.textContent=desc,el.style.display="block"}(picked.id):entityOverlayEl&&(entityOverlayEl.style.display="none"),Cesium.defined(picked)&&picked.content&&picked.content._model&&(pickedModel=picked.content._model),function(pickedModel){pickedModel||restoreModelState(hoverState),pickedModel!==hoverState.model&&pickedModel!==selectedState.model&&(hoverState.model&&hoverState.model!==selectedState.model&&restoreModelState(hoverState),pickedModel&&pickedModel!==selectedState.model&&applyModelHighlight(hoverState,pickedModel,Cesium.Color.YELLOW.withAlpha(.2),.25))}(pickedModel),!infoBoxEnabled)return;let cartesian=Cesium.defined(scene.pickPosition)?scene.pickPosition(movement.endPosition):void 0;if(Cesium.defined(cartesian)||(cartesian=scene.camera.pickEllipsoid(movement.endPosition,scene.globe.ellipsoid)),!Cesium.defined(cartesian))return;const c=Cesium.Cartographic.fromCartesian(cartesian),lon=Cesium.Math.toDegrees(c.longitude).toFixed(6),lat=Cesium.Math.toDegrees(c.latitude).toFixed(6),hgt=(c.height||0).toFixed(2)+" m";infoBoxEls.lon.textContent=lon,infoBoxEls.lat.textContent=lat,infoBoxEls.hgt.textContent=hgt;const camH=viewer.scene.globe.ellipsoid.cartesianToCartographic(viewer.camera.position).height;infoBoxEls.zoom.textContent=`${Math.max(0,0|camH)} m`}function onMouseLeftClick(movement){let pickedFeature=viewer.scene.pick(movement.position);if(restoreModelState(selectedState),!Cesium.defined(pickedFeature)||pickedFeature.id instanceof Cesium.Entity)return void setInspectorBox(!1);const model=pickedFeature.content&&pickedFeature.content._model;model?(hoverState.model===model&&restoreModelState(hoverState),applyModelHighlight(selectedState,model,Cesium.Color.CYAN.withAlpha(.3),.5),function(viewer,model){const scene=viewer.scene,camera=viewer.camera;if(!model)return;const bs=model._boundingSphere||model.boundingSphere;if(!bs)return;const center=bs.center,radius=bs.radius||10,frustum=camera.frustum,fovy=frustum.fovy||Cesium.Math.toRadians(60),aspect=frustum.aspectRatio||viewer.canvas.clientWidth/viewer.canvas.clientHeight,fovx=2*Math.atan(Math.tan(fovy/2)*aspect),distV=radius/Math.sin(fovy/2),distH=radius/Math.sin(fovx/2);let fitDistance=1.1*Math.max(distV,distH);fitDistance=Cesium.Math.clamp(fitDistance,3,50);const forward=Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(center,camera.position,new Cesium.Cartesian3),new Cesium.Cartesian3),newPosition=Cesium.Cartesian3.add(center,Cesium.Cartesian3.multiplyByScalar(forward,-fitDistance,new Cesium.Cartesian3),new Cesium.Cartesian3),direction=Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(center,newPosition,new Cesium.Cartesian3),new Cesium.Cartesian3),worldUp=scene.globe.ellipsoid.geodeticSurfaceNormal(center,new Cesium.Cartesian3),right=Cesium.Cartesian3.normalize(Cesium.Cartesian3.cross(direction,worldUp,new Cesium.Cartesian3),new Cesium.Cartesian3),up=Cesium.Cartesian3.normalize(Cesium.Cartesian3.cross(right,direction,new Cesium.Cartesian3),new Cesium.Cartesian3);camera.flyTo({destination:newPosition,orientation:{direction:direction,up:up},duration:.7,easingFunction:Cesium.EasingFunction.QUADRATIC_OUT})}(viewer,model),updateInspectorToggleButton(model)):updateInspectorToggleButton(null),function(guid){if(!inspectorLists)return;inspectorLists.innerHTML="";const props=properties[guid];if(!props)return void(inspectorLists.innerHTML='\n                    <div class="inspect_list">\n                        <div class="k">info</div>\n                        <div style="color:#cccccc;">속성이 없습니다.</div>\n                    </div>\n                ');let html="";Object.entries(props).forEach(([key,value])=>{"GUID"!==key&&(html+=`\n                    <div class="inspect_list">\n                        <div class="k">${key}</div>\n                        <div style="color:#cccccc;">${value}</div>\n                    </div>\n                `)}),inspectorLists.innerHTML=html}(pickedFeature.detail.node._name),setInspectorBox(!0)}return{init:async function(elementId,{tilesetUrl:tilesetUrl,propertyUrls:propertyUrls,info:info}={}){return viewer=function(elementId){if(!window.Cesium)return void console.error("CesiumJS not loaded.");var ph=document.querySelector(".viewer-placeholder");ph&&ph.remove();const cesiumViewer=new Cesium.Viewer(elementId,DefaultOption);cesiumViewer.scene.sun.show=!1,cesiumViewer.scene.moon.show=!1,cesiumViewer.scene.globe.depthTestAgainstTerrain=!0,cesiumViewer.scene.screenSpaceCameraController.enableCollisionDetection=!1,cesiumViewer.scene.globe.translucency.frontFaceAlphaByDistance=new Cesium.NearFarScalar(400,0,2e3,1),cesiumViewer.scene.globe.baseColor=new Cesium.Color(0,0,0,1),$(".cesium-viewer-bottom").remove(),handler||(handler=new Cesium.ScreenSpaceEventHandler(cesiumViewer.canvas));handler.setInputAction(function(){cesiumViewer.trackedEntity=void 0},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);const controller=cesiumViewer.scene.screenSpaceCameraController;controller.zoomFactor=1.5,controller.rotateFactor=.4,controller.minimumZoomDistance=2,controller.maximumZoomDistance=300;const cam=cesiumViewer.camera;return cam.inertiaSpin=.2,cam.inertiaTranslate=.4,cam.inertiaZoom=.4,cesiumViewer.scene.preRender.addEventListener(function(){if(!entityOverlayEl||"none"===entityOverlayEl.style.display)return;const entity=viewer.entities.getById("entity_icon");if(!entity)return void(entityOverlayEl.style.display="none");const time=cesiumViewer.clock.currentTime,pos=Cesium.Property.getValueOrUndefined(entity.position,time);if(!pos)return void(entityOverlayEl.style.display="none");const canvasPos=cesiumViewer.scene.cartesianToCanvasCoordinates(pos,entityScratch);Cesium.defined(canvasPos)?(entityOverlayEl.style.left=`${canvasPos.x}px`,entityOverlayEl.style.top=`${canvasPos.y}px`):entityOverlayEl.style.display="none"}),cesiumViewer}(elementId),translucencyUpdate(),function(){const $wrap=createElement(),$svg=$wrap.find("svg");$svg.css({width:"100%",height:"100%","transform-origin":"50% 50%","will-change":"transform"}),viewer.scene.postRender.addEventListener(()=>{const heading=viewer.camera.heading;$svg.css("transform",`rotateZ(${-heading}rad)`)}),$wrap.on("click",()=>{});function createElement(){return $(`\n            <div class="hud-compass" \n                 style="position:absolute; top:10px; right:10px; z-index:10000; width:64px; height:64px; pointer-events:auto;">\n                ${COMPASS_SVG}\n            </div>\n        `)}$(viewer.container).append($wrap)}(),cameraFree=CameraFreeMode({cesiumViewer:viewer}),cameraOrbitMode=function({cesiumViewer:cesiumViewer}){const viewer=cesiumViewer,scene=viewer.scene,camera=viewer.camera,orbitState={enabled:!1,callback:null};return{enable:function(unionTilesetCenter){if(orbitState.enabled)return;if(!unionTilesetCenter)return;orbitState.enabled=!0,viewer.trackedEntity=void 0;const center=unionTilesetCenter.center,radius=unionTilesetCenter.radius,pitch=Cesium.Math.toRadians(-45),range=2*radius;let heading=camera.heading;const angularSpeed=Cesium.Math.toRadians(10);camera.lookAt(center,new Cesium.HeadingPitchRange(heading,pitch,range));let lastTime=performance.now()/1e3;const cb=function(scene,time){if(!orbitState.enabled)return;const now=performance.now()/1e3,dt=now-lastTime;lastTime=now,heading+=angularSpeed*dt,camera.lookAt(center,new Cesium.HeadingPitchRange(heading,pitch,range))};orbitState.callback=cb,scene.preRender.addEventListener(cb)},disable:function(){orbitState.enabled&&(orbitState.enabled=!1,orbitState.callback&&(viewer.scene.preRender.removeEventListener(orbitState.callback),orbitState.callback=null),camera.lookAtTransform(Cesium.Matrix4.IDENTITY))}}}({cesiumViewer:viewer}),measurement=Measurement({cesiumViewer:viewer}),function({container:container}){injectStyleOnce("hud-style",HUD_CSS);const $root=$(HUD_HTML),infoBoxRootEl=$root[0];container.appendChild($root[0]),infoBoxEls.lon=infoBoxRootEl.querySelector("#hud-lon"),infoBoxEls.lat=infoBoxRootEl.querySelector("#hud-lat"),infoBoxEls.hgt=infoBoxRootEl.querySelector("#hud-height"),infoBoxEls.zoom=infoBoxRootEl.querySelector("#hud-zoom");const $cameraFree=$("#btn_cameraFreeMode"),$modeWrap=$(infoBoxRootEl).find(".hud-mode-wrap"),$hcg=$modeWrap.find("#hud-camera-group"),$hcm=$modeWrap.find(".hud-cg-menu"),$transHeader=$root.find(".hud-trans-header"),$transBody=$root.find(".hud-trans-body"),$toggleIcon=$root.find(".hud-trans-toggle"),$onlyModel=$(infoBoxRootEl).find("#hud-only-model"),$performance=$(infoBoxRootEl).find("#hud-performance"),$hudToggle=$root.find("#hud-info-toggle"),$orbitBtn=$root.find("#btn_orbitMode");$transBody.show(),$toggleIcon.text("−"),$hudToggle.on("click",e=>{e.stopPropagation(),$root.toggleClass("is-open")}),$transHeader.on("click",function(e){if($(e.target).is("#hud-translucency"))return;$transBody.is(":visible")?($transBody.slideUp(120),$toggleIcon.text("+")):($transBody.slideDown(120),$toggleIcon.text("−"))}),$onlyModel.on("change",function(){const on=$(this).is(":checked"),scene=viewer.scene;scene.globe.show=!on,scene.skyAtmosphere&&(scene.skyAtmosphere.show=!on),scene.skyBox=on?null:scene.skyBox,scene.backgroundColor=on?Cesium.Color.BLACK:Cesium.Color.fromCssColorString("#0b0f14")}),$performance.on("change",function(){const on=$(this).is(":checked");viewer.scene.debugShowFramesPerSecond=!!on}),bindTranslucencyControls(),$hcg.on("click",function(e){e.stopPropagation(),$modeWrap.toggleClass("is-open")}),$hcm.on("click","button",function(e){flyToTilesetsWithPreset(viewer,unionTilesetCenter,this.dataset.view,.8,600)}),$cameraFree.on("click",()=>{alert("해당 서비스 준비중입니다.")}),$orbitBtn.on("click",()=>{if(currentMode!==Mode_ORBIT&&!unionTilesetCenter)return void alert("타일셋이 아직 로드되지 않았습니다.");setMode(currentMode===Mode_ORBIT?Mode_NORMAL:Mode_ORBIT),syncModeButtons()});const syncModeButtons=()=>{const isFree=currentMode===Mode_CAMERA_FREE,isOrbit=currentMode===Mode_ORBIT;$cameraFree.toggleClass("is-active",isFree),$orbitBtn.toggleClass("is-active",isOrbit)};function bindTranslucencyControls(){const $chkTrans=$root.find("#hud-translucency"),$chkFade=$root.find("#hud-fadeByDistance"),$alphaRange=$root.find("#hud-alpha-range"),$alphaValue=$root.find("#hud-alpha-value"),setFadeAlphaEnabled=enabled=>{$chkFade.prop("disabled",!enabled),$alphaRange.prop("disabled",!enabled);const opacity=enabled?1:.4;$chkFade.closest("label").css("opacity",opacity),$alphaRange.closest("div").css("opacity",opacity)};$chkTrans.prop("checked",!!underFacilitySpecialEvn.translucencyEnabled),$chkFade.prop("checked",!!underFacilitySpecialEvn.fadeByDistance),$alphaRange.val(underFacilitySpecialEvn.alpha),$alphaValue.text(underFacilitySpecialEvn.alpha.toFixed(1)),setFadeAlphaEnabled(!!underFacilitySpecialEvn.translucencyEnabled);const applyAlpha=val=>{let alpha=parseFloat(val);isNaN(alpha)&&(alpha=1),alpha=Cesium.Math.clamp(alpha,0,1),underFacilitySpecialEvn.alpha=alpha,$alphaRange.val(alpha),$alphaValue.text(alpha.toFixed(1)),translucencyUpdate()};$chkTrans.on("change",()=>{const enabled=$chkTrans.is(":checked");underFacilitySpecialEvn.translucencyEnabled=enabled,setFadeAlphaEnabled(enabled),translucencyUpdate()}),$chkFade.on("change",()=>{underFacilitySpecialEvn.fadeByDistance=$chkFade.is(":checked"),translucencyUpdate()}),$alphaRange.on("input change",function(){applyAlpha(this.value)})}}({container:viewer.container}),infoBoxEnable(),toolBarApi=measurement.mountToolBar({container:viewer.container,onPoint:()=>setMode(Mode_MEASURE_POINT),onLine:()=>setMode(Mode_MEASURE_DISTANCE),onVertical:()=>setMode(Mode_MEASURE_VERTICAL),onAreaGround:()=>setMode(Mode_MEASURE_AREA_GROUND),onAreaSurface:()=>setMode(Mode_MEASURE_AREA_SURFACE),onClose:()=>setMode(Mode_NORMAL),onInit:()=>measurement.removeAll(),onMarkerAdd(){console.log("마커 추가 클릭")},onMarkerClear(){console.log("마커 초기화 클릭")}}),function(){const $viewerContainer=$(viewer.container),$parent=$viewerContainer.parent();if(!$viewerContainer.length)return;if(!$parent.length||$parent.hasClass("shell"))return;injectStyleOnce("dynamic-inspector",INSPECTOR_CSS);const $shell=$('\n            <div class="shell" id="shell">\n            <main></main>\n            </div>\n        ');$viewerContainer.before($shell);$shell.find("main").append($viewerContainer);const $inspectorBox=$(INSPECTOR_HTML);$shell.append($inspectorBox),inspectorBoxEl=$inspectorBox[0],inspectorLists=document.getElementById("inspector_list_container");const $btnInspectorClose=$inspectorBox.find("#btnInspectorClose");function updateHiddenModelsResetButton(){if(inspectorHiddenModel.size>0){if(!$btnResetHiddenModels){const $root=$(viewer.container);$btnResetHiddenModels=$('\n                    <button\n                        id="btn-reset-hidden-models"\n                        type="button"\n                        class="cesium-button"\n                        style="\n                            position:absolute;\n                            top:8px;\n                            left:50%;\n                            transform:translateX(-50%);\n                            z-index:2000;\n                            padding:4px 12px;\n                            font-size:11px;\n                            background: #2f80ff;\n                            text-shadow: 1px 1px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;">\n                        숨김 모델 초기화\n                    </button>\n                '),$btnResetHiddenModels.on("click",()=>{inspectorHiddenModel.forEach(model=>{model&&!model.isDestroyed?.()&&(model.show=!0)}),inspectorHiddenModel.clear(),inspectorSelectedModel&&!inspectorSelectedModel.isDestroyed?.()&&(inspectorSelectedModel.show=!0,$btnInspectorModelShow&&$btnInspectorModelShow.text("숨김")),$btnResetHiddenModels.hide()}),$root.append($btnResetHiddenModels)}$btnResetHiddenModels.show()}else $btnResetHiddenModels&&$btnResetHiddenModels.hide()}$btnInspectorModelShow=$inspectorBox.find("#btnInspectorModelShow"),$btnInspectorModelShow.on("click",function(){const model=inspectorSelectedModel;if(!model)return;const isVisible=!1!==model.show;model.show=!isVisible,isVisible?inspectorHiddenModel.add(model):inspectorHiddenModel.delete(model),$btnInspectorModelShow.text(""+(isVisible?"보기":"숨김")),updateHiddenModelsResetButton()}),$btnInspectorClose.on("click",function(){void 0!==$inspectorBox.attr("hidden")?($inspectorBox.removeAttr("hidden"),$shell.removeClass("no-inspector"),$(this).text("닫기")):($inspectorBox.attr("hidden",""),$shell.addClass("no-inspector"),$(this).text("열기"))})}(),inspectBoxEnable(),currentModelConfig={tilesetUrl:tilesetUrl,propertyUrls:propertyUrls,info:info},await applyModelConfig(currentModelConfig),setMode(Mode_NORMAL),viewer},updateModelConfig:async function(config={}){return currentModelConfig={...currentModelConfig,...config,info:{...currentModelConfig.info,...config.info||{}}},applyModelConfig(currentModelConfig)}}}();async function CesiumViewer(target,options={}){const elementId="string"==typeof target?target.replace(/^#/,""):target&&target.id;return await CesiumHandler.init(elementId,options),{update3Dtileset:function(tilesetUrl,propertyUrls=[]){return CesiumHandler.updateModelConfig(tilesetUrl,propertyUrls)}}}export{CesiumViewer};
//# sourceMappingURL=git-viewer.esm.js.map
