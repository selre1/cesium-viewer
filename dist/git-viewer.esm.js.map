{"version":3,"file":"git-viewer.esm.js","sources":["../src/UiTemplates.js","../src/CameraMovement.js","../src/CameraFreeMode.js","../src/Measurement.js","../src/CesiumHandler.js","../src/CameraOrbitMode.js","../src/index.js"],"sourcesContent":["/* ================= infobox Templates ================= */\r\nexport const HUD_STYLE_ID = 'hud-style';\r\nexport const HUD_CSS = `\r\n                /* 기본: 패널 위치 */\r\n                #hud-info-panel {\r\n                    position: absolute;\r\n                    top: 8px;\r\n                    left: 8px;\r\n                    z-index: 1;\r\n                    font-size: 11px;\r\n                    color: #e6edf3;\r\n                }\r\n\r\n                #hud-info-panel .hud-info-body {\r\n                    display: block;\r\n                }\r\n\r\n                /* camerafree 도움말 */\r\n                .free-help { position:absolute; left:50%; transform:translateX(-50%); bottom:64px; padding:10px 12px; border-radius:10px; background:rgba(17,22,28,.95); color:#e6edf3; border:1px solid rgba(255,255,255,.08); box-shadow:0 10px 24px rgba(0,0,0,.45); z-index:5000; max-width:calc(100vw - 32px); font:11px system-ui,-apple-system,Segoe UI,Roboto,\"Noto Sans KR\",sans-serif; }\r\n                .free-help h4 { margin:0 0 6px 0; font-size:14px; font-weight:700; color:#9ecbff; }\r\n                .free-help .row{ display:flex; gap:10px; margin:4px 0; }\r\n                .free-help kbd{ min-width:40px; padding:2px 6px; border-radius:6px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); color:#fff; font:600 11px ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; text-align:center; }\r\n                \r\n       \r\n                #btn_cameraFreeMode,\r\n                #btn_orbitMode {\r\n                position: relative;\r\n                overflow: hidden;\r\n                }\r\n\r\n                #btn_cameraFreeMode.is-active,\r\n                #btn_orbitMode.is-active {\r\n                background: #151922;          /* HUD 배경색과 어울리게 */\r\n                border-color: #d1d5db;        /* 은색 계열 */\r\n                color: #f9fafb;\r\n                }\r\n\r\n                /* 라인 기본 위치 설정 (기본은 보이지 않게) */\r\n                #btn_cameraFreeMode .line-top,\r\n                #btn_cameraFreeMode .line-right,\r\n                #btn_cameraFreeMode .line-bottom,\r\n                #btn_cameraFreeMode .line-left,\r\n                #btn_orbitMode .line-top,\r\n                #btn_orbitMode .line-right,\r\n                #btn_orbitMode .line-bottom,\r\n                #btn_orbitMode .line-left {\r\n                position: absolute;\r\n                display: block;\r\n                opacity: 0;\r\n                pointer-events: none;\r\n                }\r\n\r\n                /* === 활성화 상태에서만 라인 + 애니메이션 적용 === */\r\n\r\n                /* 상단 라인 */\r\n                #btn_cameraFreeMode.is-active .line-top,\r\n                #btn_orbitMode.is-active .line-top {\r\n                top: 0;\r\n                left: 0;\r\n                width: 100%;\r\n                height: 3px;\r\n                opacity: 1;\r\n                background: linear-gradient(\r\n                    to right,\r\n                    rgba(15, 17, 22, 0),\r\n                    #ffe66b,\r\n                    #ffb347,\r\n                    rgba(15, 17, 22, 0)\r\n                ); /* 노랑 → 주황 계열 빛 */\r\n                animation: hudLineTop 2s linear infinite;\r\n                }\r\n\r\n                /* 우측 라인 */\r\n                #btn_cameraFreeMode.is-active .line-right,\r\n                #btn_orbitMode.is-active .line-right {\r\n                top: 0;\r\n                right: 0;\r\n                width: 3px;\r\n                height: 100%;\r\n                opacity: 1;\r\n                background: linear-gradient(\r\n                    to bottom,\r\n                    rgba(15, 17, 22, 0),\r\n                    #ffe66b,\r\n                    #ff9f1c,\r\n                    rgba(15, 17, 22, 0)\r\n                );\r\n                animation: hudLineRight 2s linear infinite;\r\n                animation-delay: 0.5s;\r\n                }\r\n\r\n                /* 하단 라인 */\r\n                #btn_cameraFreeMode.is-active .line-bottom,\r\n                #btn_orbitMode.is-active .line-bottom {\r\n                bottom: 0;\r\n                left: 0;\r\n                width: 100%;\r\n                height: 3px;\r\n                opacity: 1;\r\n                background: linear-gradient(\r\n                    to left,\r\n                    rgba(15, 17, 22, 0),\r\n                    #ffe66b,\r\n                    #ffb347,\r\n                    rgba(15, 17, 22, 0)\r\n                );\r\n                animation: hudLineBottom 2s linear infinite;\r\n                }\r\n\r\n                /* 좌측 라인 */\r\n                #btn_cameraFreeMode.is-active .line-left,\r\n                #btn_orbitMode.is-active .line-left {\r\n                top: 0;\r\n                left: 0;\r\n                width: 3px;\r\n                height: 100%;\r\n                opacity: 1;\r\n                background: linear-gradient(\r\n                    to top,\r\n                    rgba(15, 17, 22, 0),\r\n                    #ffe66b,\r\n                    #ff9f1c,\r\n                    rgba(15, 17, 22, 0)\r\n                );\r\n                animation: hudLineLeft 2s linear infinite;\r\n                animation-delay: 0.5s;\r\n                }\r\n\r\n                /* ==== keyframes (같이 사용) ==== */\r\n\r\n                @keyframes hudLineTop {\r\n                0%   { transform: translateX(-100%); }\r\n                100% { transform: translateX(100%); }\r\n                }\r\n\r\n                @keyframes hudLineRight {\r\n                0%   { transform: translateY(-100%); }\r\n                100% { transform: translateY(100%); }\r\n                }\r\n\r\n                @keyframes hudLineBottom {\r\n                0%   { transform: translateX(100%); }\r\n                100% { transform: translateX(-100%); }\r\n                }\r\n\r\n                @keyframes hudLineLeft {\r\n                0%   { transform: translateY(100%); }\r\n                100% { transform: translateY(-100%); }\r\n                }\r\n\r\n                /* Alpha 행 레이아웃 */\r\n                .hud-alpha-row {\r\n                    display:flex;\r\n                    align-items:center;\r\n                    gap:4px;\r\n                    flex-wrap:wrap;\r\n                }\r\n                .hud-alpha-row span {\r\n                    flex:0 0 auto;\r\n                }\r\n                .hud-alpha-value {\r\n                    min-width:28px;\r\n                    text-align:right;\r\n                }\r\n                .hud-alpha-range {\r\n                    flex:1 1 auto;\r\n                    min-width:80px;\r\n                }\r\n\r\n                /* 모델 옵션 드롭다운 */\r\n                .hud-mode-wrap{\r\n                    position:relative;\r\n                }\r\n                .hud-cg-menu{\r\n                    position:absolute;\r\n                    top:0;\r\n                    left:100%;\r\n                    margin-left:4px;\r\n                    background:rgba(42,42,42,.7);\r\n                    border-radius:8px;\r\n                    padding:6px 8px;\r\n                    border:1px solid rgba(255,255,255,.1);\r\n                    box-shadow:0 8px 18px rgba(0,0,0,.45);\r\n                    display:none;\r\n                    flex-direction:column;\r\n                    gap:4px;\r\n                    min-width:120px;\r\n                    z-index:6000;\r\n                }\r\n\r\n                .hud-mode-wrap.is-open .hud-cg-menu{\r\n                    display:flex;\r\n                }\r\n                \r\n                .hud-cg-item{\r\n                    width:100%;\r\n                    margin:0;\r\n                    font-size:11px;\r\n                    text-align:left;\r\n                    white-space:nowrap;\r\n                    border: 0px;\r\n                    text-align: center;\r\n                    background: transparent;\r\n                }\r\n\r\n                .cesium-performanceDisplay-defaultContainer {\r\n                    top: 85px !important;\r\n                }\r\n\r\n                /* 좁은 화면용 HUD */\r\n                @media (max-width: 1024px) {\r\n                    /* 카메라 영역 전체를 가로로 꽉 채우기 */\r\n                    #hud-info-panel .hud-mode-wrap {\r\n                        width: 100%;\r\n                    }\r\n\r\n                    #hud-info-panel {\r\n                        display: flex;\r\n                        flex-direction: column;\r\n                        align-items: flex-start;\r\n                        max-width: calc(100% - 16px);\r\n                    }\r\n\r\n                    /* 토글 버튼 노출 */\r\n                    #hud-info-toggle {\r\n                        display: inline-flex;\r\n                        align-items: center;\r\n                        justify-content: center;\r\n                        padding: 3px 8px;\r\n                        margin-bottom: 4px;\r\n                        border-radius: 999px;\r\n                        border: 1px solid rgba(255,255,255,0.4);\r\n                        background: rgba(0,0,0,0.7);\r\n                        color: #e6edf3;\r\n                        font-size: 10px;\r\n                        cursor: pointer;\r\n                    }\r\n\r\n                    /* 드롭다운 패널 기본: 접혀 있음 */\r\n                    #hud-info-panel .hud-info-body {\r\n                        position: relative;\r\n                        margin-top: 4px;\r\n                        border-radius: 8px;\r\n                        padding: 6px 10px;\r\n                        max-height: 0;\r\n                        overflow: hidden;\r\n                        opacity: 0;\r\n                        transform-origin: top left;\r\n                        transform: translateY(-4px);\r\n                        transition:\r\n                        max-height 0.18s ease,\r\n                        opacity 0.18s ease,\r\n                        transform 0.18s ease;\r\n                    }\r\n\r\n                    /* is-open 클래스일 때만 펼쳐지도록 */\r\n                    #hud-info-panel.is-open .hud-info-body {\r\n                        max-height: 100%;           /* 내용 높이보다 조금 크게 잡기 */\r\n                        opacity: 1;\r\n                        transform: translateY(0);\r\n                    }\r\n\r\n                    #hud-info-panel .hud-cg-menu {\r\n                        position: static;      /* absolute + left:100% 제거 효과 */\r\n                        margin-left: 0;\r\n                        margin-top: 4px;\r\n\r\n                        width: 100%;\r\n                        box-shadow: 0 6px 14px rgba(0,0,0,0.5);\r\n                    }\r\n                }\r\n\r\n                /* 큰 화면용 HUD */\r\n                @media (min-width: 1025px) {\r\n                    /* 토글 버튼은 안 보이게 */\r\n                    #hud-info-toggle {\r\n                        display: none;\r\n                    }\r\n\r\n                    /* 큰 화면에서는 항상 body 보이도록 강제 */\r\n                    #hud-info-panel .hud-info-body {\r\n                        display: block !important;\r\n                        position: static;\r\n                        max-height: none;\r\n                        opacity: 1;\r\n                        transform: none;\r\n                    }\r\n                }\r\n\r\n                /* 카메라 모드 그룹 컨테이너 */\r\n                .hud-mode-group {\r\n                    border-radius: 8px;\r\n                }\r\n\r\n                /* 버튼 래퍼: 살짝 어두운 바탕 + 라운드 */\r\n                .hud-mode-buttons {\r\n                    display: flex;\r\n                    gap: 2px;\r\n                    padding: 2px;\r\n                    border-radius: 8px;\r\n                    background: rgb(20 26 34 / 66%);\r\n                    border: 1px solid rgba(255, 255, 255, 0.08);\r\n                }\r\n\r\n                /* 개별 버튼: 기본 상태 */\r\n                .hud-mode-btn {\r\n                    flex: 1;\r\n                    margin: 0 !important;\r\n                    border-radius: 6px;\r\n                    border: none;\r\n                    background: transparent;\r\n                    color: #ffffffff;\r\n                    font-size: 11px;\r\n                    padding: 4px 0;\r\n                    transition: background 0.18s ease, color 0.18s ease,\r\n                                box-shadow 0.18s ease, transform 0.08s ease;\r\n                }\r\n\r\n                /* 활성 상태: 라디오에서 선택된 것처럼 */\r\n                .hud-mode-btn.is-active {\r\n                    background: #ff7c1c;\r\n                    color: #ffffff;\r\n                    box-shadow:\r\n                        0 0 0 1px rgba(255, 180, 80, 0.55),\r\n                        0 0 10px rgba(255, 140, 40, 0.75);\r\n                    transform: translateY(0);\r\n                }\r\n\r\n                /*  hover 공통 스타일 */\r\n                #hud-info-panel .cesium-button:hover {\r\n                    background: rgba(47, 128, 255, 0.18);\r\n                    color: #f5f7fb;\r\n                }   \r\n\r\n                /* HUD 안의 모든 글씨 공통 스타일 */\r\n                #hud-info-panel,\r\n                #hud-info-panel * {\r\n                    color: #ffffff;\r\n                    text-shadow:\r\n                    1px 1px 0 #000,\r\n                    -1px -1px 0 #000,\r\n                    1px -1px 0 #000,\r\n                    -1px 1px 0 #000,\r\n                    1px 1px 0 #000;\r\n                    font-family: Arial, Helvetica, sans-serif;\r\n                }\r\n`;\r\n\r\nexport const HUD_HTML = `\r\n<div id=\"hud-info-panel\" style=\"position:absolute; top:8px; left:8px; z-index:1; font-size:11px; width: 170px; max-width: 170px; color:#e6edf3; pointer-events:auto;\">\r\n    <button id=\"hud-info-toggle\" type=\"button\" class=\"cesium-button\">\r\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n        <path d=\"M3 6h18\"></path>\r\n        <path d=\"M7 12h10\"></path>\r\n        <path d=\"M10 18h4\"></path>\r\n        </svg>\r\n    </button>\r\n    <div class=\"hud-info-body\">\r\n        <div style=\"background:rgb(20 26 34 / 66%); padding:6px 10px; border-radius:8px; margin-bottom:6px;\">\r\n        경도 : <span id=\"hud-lon\"></span>\r\n        </div>\r\n        <div style=\"background:rgb(20 26 34 / 66%); padding:6px 10px; border-radius:8px; margin-bottom:6px;\">\r\n        위도 : <span id=\"hud-lat\"></span>\r\n        </div>\r\n        <div style=\"background:rgb(20 26 34 / 66%); padding:6px 10px; border-radius:8px; margin-bottom:6px;\">\r\n        높이 : <span id=\"hud-height\"></span>\r\n        </div>\r\n        <div style=\"background:rgb(20 26 34 / 66%); padding:6px 10px; border-radius:8px; margin-bottom:6px;\">\r\n        Zoom Level : <span id=\"hud-zoom\">0m</span>\r\n        </div>\r\n\r\n        <!-- 카메라 그룹 -->\r\n        <div class=\"hud-mode-wrap\" style=\"margin-bottom:6px; background: rgb(20 26 34 / 66%); border-radius: 8px;\">\r\n        <button id=\"hud-camera-group\" type=\"button\" class=\"cesium-button\" style=\"width:100%;margin:0;background: transparent; border-radius: 8px;\">\r\n            카메라 ▸\r\n        </button>\r\n\r\n        <div class=\"hud-cg-menu\">\r\n            <button type=\"button\" class=\"cesium-button hud-cg-item\" data-view=\"top\"   id=\"hud-topdown\">top</button>\r\n            <button type=\"button\" class=\"cesium-button hud-cg-item\" data-view=\"left\"  id=\"hud-leftHalfDown\">left</button>\r\n            <button type=\"button\" class=\"cesium-button hud-cg-item\" data-view=\"right\" id=\"hud-rightHalfDown\">right</button>\r\n        </div>\r\n        </div>\r\n        <!-- 카메라 모드 토글 버튼 그룹 -->\r\n        <div class=\"hud-mode-group\" style=\"margin-bottom:6px;\">\r\n            <div class=\"hud-mode-buttons\" role=\"radiogroup\">\r\n                <button id=\"btn_cameraFreeMode\" type=\"button\" class=\"cesium-button hud-mode-btn\" role=\"radio\" aria-checked=\"true\" >\r\n                탐색\r\n                </button>\r\n                <button id=\"btn_orbitMode\" type=\"button\" class=\"cesium-button hud-mode-btn\" role=\"radio\" aria-checked=\"false\">\r\n                회전\r\n                </button>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- 지하시설물 특화 블럭 -->\r\n        <div style=\"background: rgb(20 26 34 / 66%); padding:6px 10px; border-radius:8px; margin-bottom:6px; display:block;\">\r\n        <!-- 상단 타이틀 -->\r\n            <div style=\"font-weight:600; margin-bottom:0.5rem;\">\r\n                지하시설물 특화\r\n            </div>\r\n            <!-- 하위 옵션 전체 래퍼 -->\r\n            <div style=\"margin-left:4px; font-size:11px;\">\r\n\r\n                <!-- 상위 옵션: Translucency (접었다 펼치는 헤더) -->\r\n                <div class=\"hud-trans-header\"\r\n                    style=\"display:flex; justify-content:space-between; align-items:center; margin-bottom:4px; cursor:pointer;\">\r\n                    <div style=\"display:flex; align-items:center; gap:4px;\">\r\n                        <!-- + / - 토글 아이콘 -->\r\n                        <span class=\"hud-trans-toggle\"\r\n                            style=\"display:inline-block; width:14px; text-align:center;\">−</span>\r\n                        <span>Translucency</span>\r\n                    </div>\r\n                    <input\r\n                        type=\"checkbox\"\r\n                        id=\"hud-translucency\"\r\n                        style=\"accent-color:#ffcd00; margin-left:8px;\"\r\n                        checked\r\n                    />\r\n                </div>\r\n\r\n                <!-- Translucency 하위 옵션 그룹 -->\r\n                <div class=\"hud-trans-body\" style=\"margin-left:16px; margin-top:2px; font-size:0.9em;\">\r\n                    <!-- Fade by distance -->\r\n                    <label style=\"display:block; margin-bottom:6px;\">\r\n                        Fade by distance\r\n                        <input type=\"checkbox\" id=\"hud-fadeByDistance\" style=\"accent-color:#ffcd00\" checked/>\r\n                    </label>\r\n\r\n                    <!-- Alpha -->\r\n                    <div class=\"hud-alpha-row\" style=\"display:flex; align-items:center; gap:4px; flex-wrap:wrap;\">\r\n                        <span style=\"min-width:40px;\">Alpha</span>\r\n                        <span id=\"hud-alpha-value\" class=\"hud-alpha-value\" style=\"font-size:0.85em; opacity:0.8;\">0.5</span>\r\n                        <input id=\"hud-alpha-range\"\r\n                            type=\"range\" min=\"0.0\" max=\"1.0\" step=\"0.1\" data-bind=\"value: alpha, valueUpdate: 'input'\" class=\"hud-alpha-range\"\r\n                            style=\"appearance:none; background-color:#ffffff57; accent-color:#ffcd00; border-radius:10px; cursor:pointer; height:8px;\"/>\r\n                    </div>\r\n                </div>\r\n\r\n                <!-- 같은 레벨의 항목: 모델만 보기 -->\r\n                <div style=\"margin-top:8px; padding-top:6px; border-top:1px solid rgba(255,255,255,0.08); display:flex; align-items:center; justify-content:space-between;\">\r\n                    <div style=\"display:flex; align-items:center; gap:4px;\">\r\n                        <span style=\"display:inline-block; width:14px;\"></span>\r\n                        <span>View 3D Model Only</span>\r\n                    </div>\r\n                    <input type=\"checkbox\" id=\"hud-only-model\" style=\"accent-color:#ffcd00\"/>\r\n                </div>\r\n                <div style=\"margin-top:8px; padding-top:6px; border-top:1px solid rgba(255,255,255,0.08); display:flex; align-items:center; justify-content:space-between;\">\r\n                    <div style=\"display:flex; align-items:center; gap:4px;\">\r\n                        <span style=\"display:inline-block; width:14px;\"></span>\r\n                        <span>Performance</span>\r\n                    </div>\r\n                    <input type=\"checkbox\" id=\"hud-performance\" style=\"accent-color:#ffcd00\"/>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n`;\r\n\r\n\r\n/* ================= Inspector Templates ================= */\r\n\r\nexport const INSPECTOR_STYLE_ID = 'dynamic-inspector';\r\nexport const INSPECTOR_CSS = `\r\n    .shell {\r\n        display: grid;\r\n        grid-template-columns: 1fr 360px; /* 왼쪽 viewer, 오른쪽 inspector */\r\n        width: 100%;\r\n        height: 100%;\r\n    }\r\n    .shell > * {\r\n        min-width: 0;\r\n        min-height: 0;\r\n    }\r\n    .shell.no-inspector {\r\n        grid-template-columns: 1fr; /* inspector 닫으면 viewer가 전체 사용 */\r\n    }\r\n\r\n    main {\r\n        position: relative;\r\n        height: 100%;\r\n        width: 100%;\r\n    }\r\n\r\n    /* Inspector 박스 (오른쪽) */\r\n    .inspector {\r\n        background: #11161c;\r\n        border-left: 1px solid #222a33;\r\n        display: flex;\r\n        flex-direction: column;\r\n        height: 100%;\r\n        overflow: hidden;\r\n        padding: 1rem;\r\n    }\r\n\r\n    .inspector[hidden] {\r\n        display: none !important;\r\n    }\r\n\r\n    /* 상단 close 버튼 & 타이틀 */\r\n    .inspectorBaseBtn {\r\n        font-size: 11px;\r\n        padding: 3px 8px;\r\n        margin: 0;\r\n        cursor: pointer;\r\n        border-radius: 12px;\r\n        border: 1px solid #27313c;\r\n        color: #e6edf3;\r\n    }\r\n\r\n\r\n    /* 화면 작아졌을때 스크롤 스타일 */\r\n    #inspector_list_container::-webkit-scrollbar {\r\n        width: 8px;\r\n    }\r\n\r\n    #inspector_list_container::-webkit-scrollbar-track {\r\n        background: rgba(8, 12, 18, 0.95);\r\n        border-radius: 999px;\r\n    }\r\n\r\n    #inspector_list_container::-webkit-scrollbar-thumb {\r\n        background: linear-gradient(180deg, #3b82f6, #0ea5e9);\r\n        border-radius: 999px;\r\n        border: 1px solid rgba(0, 0, 0, 0.5);\r\n    }\r\n\r\n    #inspector_list_container::-webkit-scrollbar-thumb:hover {\r\n        background: linear-gradient(180deg, #60a5fa, #22d3ee);\r\n    }\r\n    \r\n    /* key-value 영역 */\r\n    .inspect_list {\r\n        padding: 10px 0;\r\n        border-bottom: 1px solid #222a33;\r\n        font-size: 11px;\r\n    }\r\n\r\n    .inspect_list:last-child {\r\n        border-bottom: 0;\r\n    }\r\n\r\n    .inspect_list .k {\r\n        color: #ffffffff;\r\n        margin-bottom: 5px;\r\n    }\r\n\r\n    .inspector button:hover {\r\n      background: rgba(47, 128, 255, 0.18);\r\n      color: #f5f7fb;\r\n    }\r\n\r\n    .inspector,\r\n    .inspector * {\r\n        color: #ffffff;\r\n        text-shadow:\r\n          1px 1px 0 #000,\r\n          -1px -1px 0 #000,\r\n          1px -1px 0 #000,\r\n          -1px 1px 0 #000,\r\n          1px 1px 0 #000;\r\n        font-family: Arial, Helvetica, sans-serif;\r\n    }\r\n\r\n    @media (max-width: 1024px) {\r\n        /* 전체 레이아웃: 세로 방향 flex 컨테이너로 변경 */\r\n        .shell {\r\n            display: flex;\r\n            flex-direction: column; /* 위: main, 아래: inspector */\r\n            width: 100%;\r\n            height: 100%;\r\n        }\r\n\r\n        /* 윗부분(viewer 영역) 높이 비율 2 */\r\n        .shell main {\r\n            flex: 2 1 0;   /* 2 : 1 비율에서 '2' */\r\n            min-height: 0; /* overflow 스크롤 깨짐 방지 */\r\n        }\r\n\r\n        /* 아랫부분(inspector 영역) 높이 비율 1 */\r\n        .shell .inspector {\r\n            display: flex;         /* 기존 스타일 유지 + flex column */\r\n            flex-direction: column;\r\n            flex: 1 1 0;           /* 2 : 1 비율 '1' */\r\n            min-height: 0;\r\n            border-left: none;     /* 좌측 경계선 제거 */\r\n            border-top: 1px solid #222a33; /* 위쪽에 경계선 */\r\n        }\r\n\r\n        /* 닫기 눌렀을 때 아래 pane만 감추는 처리 (기존 no-inspector 클래스와 연동) */\r\n        .shell.no-inspector .inspector {\r\n            display: none !important;\r\n        }\r\n    }\r\n`;\r\nexport const INSPECTOR_HTML = `\r\n    <aside class=\"inspector\">\r\n        <div style=\"border-color:#222a33; display:flex; align-items:center;justify-content:space-between;border-bottom:1px solid rgba(0,0,0,0.2);\">\r\n            <h3 style=\"font-size:.875rem; margin:0; font-weight:600; color:white;\">모델정보</h3>\r\n            <button id=\"btnInspectorModelShow\" class=\"inspectorBaseBtn cesium-button\" disabled>숨김</button>\r\n            <button class=\"inspectorBaseBtn cesium-button\" id=\"btnInspectorClose\">닫기</button>\r\n        </div>\r\n        <div id=\"inspector_list_container\" style=\"flex:1; overflow:auto;\">\r\n            <div class=\"inspect_list\" style = \"text-align: center;\">\r\n                <div style=\"color:#e6edf3;\">모델을 클릭해 주세요.</div>\r\n            </div>\r\n        </div>\r\n    </aside>\r\n`;\r\n\r\nexport const COMPASS_SVG = `\r\n<svg\r\n   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\r\n   xmlns:cc=\"http://creativecommons.org/ns#\"\r\n   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\r\n   xmlns:svg=\"http://www.w3.org/2000/svg\"\r\n   xmlns=\"http://www.w3.org/2000/svg\"\r\n   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\r\n   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\r\n   width=\"256\"\r\n   height=\"256\"\r\n   viewBox=\"0 0 67.733332 67.733336\"\r\n   version=\"1.1\"\r\n   id=\"svg8\"\r\n   inkscape:version=\"0.92.4 (5da689c313, 2019-01-14)\"\r\n   sodipodi:docname=\"compas.svg\">\r\n  <defs\r\n     id=\"defs2\" />\r\n  <sodipodi:namedview\r\n     id=\"base\"\r\n     pagecolor=\"#ff00ff\"\r\n     bordercolor=\"#666666\"\r\n     borderopacity=\"1.0\"\r\n     inkscape:pageopacity=\"0\"\r\n     inkscape:pageshadow=\"2\"\r\n     inkscape:zoom=\"0.9899495\"\r\n     inkscape:cx=\"-23.735523\"\r\n     inkscape:cy=\"75.513805\"\r\n     inkscape:document-units=\"mm\"\r\n     inkscape:current-layer=\"layer1\"\r\n     showgrid=\"false\"\r\n     units=\"px\"\r\n     inkscape:window-width=\"1920\"\r\n     inkscape:window-height=\"1001\"\r\n     inkscape:window-x=\"-9\"\r\n     inkscape:window-y=\"-9\"\r\n     inkscape:window-maximized=\"1\" />\r\n  <metadata\r\n     id=\"metadata5\">\r\n    <rdf:RDF>\r\n      <cc:Work\r\n         rdf:about=\"\">\r\n        <dc:format>image/svg+xml</dc:format>\r\n        <dc:type\r\n           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\r\n        <dc:title />\r\n      </cc:Work>\r\n    </rdf:RDF>\r\n  </metadata>\r\n  <g\r\n     inkscape:label=\"Layer 1\"\r\n     inkscape:groupmode=\"layer\"\r\n     id=\"layer1\"\r\n     transform=\"translate(0,-229.26665)\">\r\n    <rect\r\n       transform=\"matrix(0.28684886,-0.95797585,0.28684886,0.95797585,0,0)\"\r\n       y=\"186.256\"\r\n       x=\"-88.509865\"\r\n       height=\"20.228861\"\r\n       width=\"20.407875\"\r\n       id=\"rect841\"\r\n       style=\"fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:3.19949436;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill\" />\r\n    <path\r\n       style=\"fill:#ff0000;fill-opacity:1;stroke:none;stroke-width:0.31378534px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\"\r\n       d=\"m 33.892345,243.66881 -5.853981,19.55025 11.656606,-0.1715 z\"\r\n       id=\"path839\"\r\n       inkscape:connector-curvature=\"0\" />\r\n    <rect\r\n       style=\"fill:none;fill-opacity:1;stroke:#000000;stroke-width:1.34890436;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill\"\r\n       id=\"rect837\"\r\n       width=\"20.407875\"\r\n       height=\"20.228861\"\r\n       x=\"-88.509865\"\r\n       y=\"186.256\"\r\n       transform=\"matrix(0.28684886,-0.95797585,0.28684886,0.95797585,0,0)\" />\r\n    <circle\r\n       r=\"26.400972\"\r\n       cy=\"263.13333\"\r\n       cx=\"33.866665\"\r\n       id=\"circle875\"\r\n       style=\"fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:3;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\" />\r\n    <path\r\n       style=\"color:#000000;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;vector-effect:none;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:3.77952766;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate\"\r\n       d=\"M 128.00195 21.101562 C 68.983697 21.101562 21.097652 68.979815 21.097656 127.99805 C 21.097652 187.01631 68.983697 234.90234 128.00195 234.90234 C 187.02021 234.90234 234.89844 187.01631 234.89844 127.99805 C 234.89844 68.979815 187.02021 21.101562 128.00195 21.101562 z M 128.00195 24.880859 C 184.9776 24.880859 231.11914 71.022423 231.11914 127.99805 C 231.11914 184.97371 184.9776 231.12305 128.00195 231.12305 C 71.026305 231.12305 24.876949 184.97371 24.876953 127.99805 C 24.876949 71.022423 71.026305 24.880859 128.00195 24.880859 z M 128.00195 32.646484 C 75.383495 32.646484 32.642571 75.379576 32.642578 127.99805 C 32.642571 180.61652 75.383495 223.35742 128.00195 223.35742 C 180.62041 223.35742 223.35352 180.61652 223.35352 127.99805 C 223.35352 75.379576 180.62041 32.646484 128.00195 32.646484 z M 128 36.423828 A 91.575673 91.575673 0 0 1 219.57617 128 A 91.575673 91.575673 0 0 1 128 219.57617 A 91.575673 91.575673 0 0 1 36.423828 128 A 91.575673 91.575673 0 0 1 128 36.423828 z \"\r\n       transform=\"matrix(0.26458333,0,0,0.26458333,0,229.26665)\"\r\n       id=\"path831\" />\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:14.86962605px;line-height:1.25;font-family:Calibri;-inkscape-font-specification:'Calibri Bold';letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:2.10750604;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers\"\r\n       x=\"28.969419\"\r\n       y=\"241.2182\"\r\n       id=\"text817\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan815\"\r\n         x=\"28.969419\"\r\n         y=\"241.2182\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:Calibri;-inkscape-font-specification:'Calibri Bold';fill:#00ff0a;fill-opacity:1;stroke:#000000;stroke-width:2.10750604;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:stroke fill markers\">N</tspan></text>\r\n    <text\r\n       id=\"text821\"\r\n       y=\"294.46481\"\r\n       x=\"30.341665\"\r\n       style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:14.86962605px;line-height:1.25;font-family:Calibri;-inkscape-font-specification:'Calibri Bold';letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:2.10750604;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill\"\r\n       xml:space=\"preserve\"><tspan\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:Calibri;-inkscape-font-specification:'Calibri Bold';fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:2.10750604;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill\"\r\n         y=\"294.46481\"\r\n         x=\"30.341665\"\r\n         id=\"tspan819\"\r\n         sodipodi:role=\"line\">S</tspan></text>\r\n    <text\r\n       xml:space=\"preserve\"\r\n       style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:12.01801109px;line-height:1.25;font-family:Calibri;-inkscape-font-specification:'Calibri Bold';letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:1.70334029;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill\"\r\n       x=\"2.7455826\"\r\n       y=\"244.59872\"\r\n       id=\"text825\"\r\n       transform=\"scale(0.91513312,1.0927372)\"><tspan\r\n         sodipodi:role=\"line\"\r\n         id=\"tspan823\"\r\n         x=\"2.7455826\"\r\n         y=\"244.59872\"\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:Calibri;-inkscape-font-specification:'Calibri Bold';letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:1.70334029;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill\">W</tspan></text>\r\n    <text\r\n       id=\"text829\"\r\n       y=\"267.8309\"\r\n       x=\"56.043221\"\r\n       style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:14.86962605px;line-height:1.25;font-family:Calibri;-inkscape-font-specification:'Calibri Bold';letter-spacing:0px;word-spacing:0px;fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:2.10750604;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill\"\r\n       xml:space=\"preserve\"><tspan\r\n         style=\"font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:Calibri;-inkscape-font-specification:'Calibri Bold';fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:2.10750604;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:markers stroke fill\"\r\n         y=\"267.8309\"\r\n         x=\"56.043221\"\r\n         id=\"tspan827\"\r\n         sodipodi:role=\"line\">E</tspan></text>\r\n  </g>\r\n</svg>\r\n\r\n`;","const VIEW_PRESETS = {\r\n  // 수직 보기 (완전 top-down)\r\n  top: {\r\n    heading: Cesium.Math.toRadians(0),     // heading은 수직일 때는 의미 거의 없음\r\n    pitch:   Cesium.Math.toRadians(-90),\r\n  },\r\n\r\n  // 오른쪽 보기 (동쪽에서 45° 경사로 내려다봄)\r\n  right: {\r\n    // Cesium 기준: heading 0 = 북, +90 = 동, +180 = 남, -90 = 서\r\n    heading: Cesium.Math.toRadians(90),    // 동쪽 방향\r\n    pitch:   Cesium.Math.toRadians(-45),   // 45도 내려보기\r\n  },\r\n\r\n  // 왼쪽 보기 (서쪽에서 45° 경사로 내려다봄)\r\n  left: {\r\n    heading: Cesium.Math.toRadians(-90),   // 서쪽 방향\r\n    pitch:   Cesium.Math.toRadians(-45),\r\n  },\r\n};\r\n\r\n/*\r\n* 지하에서 수평상태로 바라본 후 모델 클릭시 자연스러운 슬라이딩 이동 가능\r\n* 카메라는 사용자가 바라보는 상태 그대로 유지, 높이 유지\r\n*/\r\nexport function moveSlidingDirection(viewer,movement){\r\n    const scene = viewer.scene;\r\n    if (!scene.pickPositionSupported) return;\r\n\r\n    const cartesian = scene.pickPosition(movement.position);\r\n    if (!Cesium.defined(cartesian)) return;\r\n\r\n    const globe     = scene.globe;\r\n    const ellipsoid = globe.ellipsoid;\r\n\r\n    const clickCarto  = ellipsoid.cartesianToCartographic(cartesian);\r\n    const cameraCarto = ellipsoid.cartesianToCartographic(viewer.camera.position);\r\n\r\n    // 카메라의 현재 높이 유지\r\n    const destCarto = new Cesium.Cartographic(\r\n        clickCarto.longitude,\r\n        clickCarto.latitude,\r\n        cameraCarto.height\r\n    );\r\n    const dest = ellipsoid.cartographicToCartesian(destCarto);\r\n\r\n    viewer.camera.flyTo({\r\n        destination: dest,\r\n        orientation: {\r\n            heading: viewer.camera.heading,\r\n            pitch:   viewer.camera.pitch,\r\n            roll:    viewer.camera.roll\r\n        },\r\n        duration: 0.7,\r\n        easingFunction: Cesium.EasingFunction.QUADRATIC_OUT\r\n    });\r\n}\r\n\r\n// 모델클릭 시 해당 모델로 카메라 이동\r\n// 마우스의 노말벡터 방향으로 카메라 방향이 이동하기 때문에 카메라가 휙 돌아가는 현상 발생\r\nexport function moveNormalDirection(viewer, movement, model){\r\n       const scene  = viewer.scene;\r\n        const camera = viewer.camera;\r\n\r\n        if (!scene.pickPositionSupported) {\r\n            return;\r\n        }\r\n\r\n        // 클릭한 위치(현재 화면에서 보이는 표면 위치)\r\n        const target = scene.pickPosition(movement.position);\r\n        if (!Cesium.defined(target)) {\r\n            return;\r\n        }\r\n\r\n        // 모델 전체 반지름\r\n        const rawRadius = (model && model.boundingSphere)\r\n            ? model.boundingSphere.radius\r\n            : 10.0; // fallback\r\n\r\n        // 현재 카메라와 클릭 지점 사이 거리\r\n        const currentDistance = Cesium.Cartesian3.distance(camera.position, target);\r\n\r\n        // 화면에 꽉 차게 만들 이상적인 거리 (건물 전체 기준)\r\n        const fovy = camera.frustum.fovy || Cesium.Math.toRadians(60.0);\r\n        let fitDistance = (rawRadius / Math.sin(fovy / 2.0)) * 1.1; // 여유 10%\r\n\r\n        // 계단 같이 내부 요소를 눌렀을 때\r\n        //    건물 전체를 보기 위해 뒤로 쭉 빠지지 않도록\r\n        //     지금보다 더 멀리는 가지 않게 제한\r\n        fitDistance = Math.min(fitDistance, currentDistance);\r\n\r\n        // 너무 멀거나, 너무 코앞까지 붙지 않게 클램프\r\n        //  dMin / dMax => 사용성에 따라 조절 (단위: meter 정도)\r\n        const dMin = 3.0;    // 실내 볼 때 최소 거리\r\n        const dMax = 100.0;  // 건물 전체 볼 때도 이 이상은 안 멀어지게\r\n        fitDistance = Cesium.Math.clamp(fitDistance, dMin, dMax);\r\n\r\n        // 카메라 → 타겟 방향(정면 방향)\r\n        const dirCamToTarget = Cesium.Cartesian3.normalize(\r\n            Cesium.Cartesian3.subtract(\r\n                target,\r\n                camera.position,\r\n                new Cesium.Cartesian3()\r\n            ),\r\n            new Cesium.Cartesian3()\r\n        );\r\n\r\n        // 타겟 기준으로 정면에서 fitDistance만큼 떨어진 위치\r\n        const newPosition = Cesium.Cartesian3.add(\r\n            target,\r\n            Cesium.Cartesian3.multiplyByScalar(\r\n                dirCamToTarget,\r\n                -fitDistance,\r\n                new Cesium.Cartesian3()\r\n            ),\r\n            new Cesium.Cartesian3()\r\n        );\r\n\r\n        // 새 위치에서 타겟을 정확히 바라보는 direction\r\n        const newDirection = Cesium.Cartesian3.normalize(\r\n            Cesium.Cartesian3.subtract(\r\n                target,\r\n                newPosition,\r\n                new Cesium.Cartesian3()\r\n            ),\r\n            new Cesium.Cartesian3()\r\n        );\r\n\r\n        camera.flyTo({\r\n            destination: newPosition,\r\n            orientation: {\r\n                direction: newDirection,\r\n                up: camera.up   // 기존 상단 방향 유지 (화면 기울기 유지)\r\n            },\r\n            duration: 0.7,\r\n            easingFunction: Cesium.EasingFunction.QUADRATIC_OUT\r\n        });\r\n}\r\n\r\n/*\r\n* 모델의 사이즈에 맞춰서 카메라 이동\r\n* 카메라 위치 자세 유지 o\r\n* pivot 불가\r\n*/\r\nexport function flyDirectionStayFitModel(viewer, model){\r\n        const scene  = viewer.scene;\r\n        const camera = viewer.camera;\r\n\r\n        if (!model) return;\r\n\r\n        //모델의 bounding sphere 정보 가져오기\r\n        const bs = model._boundingSphere || model.boundingSphere;\r\n        if (!bs) return;\r\n\r\n        const center = bs.center;             // 모델 중심\r\n        const radius = bs.radius || 10.0;     // 모델 크기\r\n\r\n        //카메라 FOV 기반으로 전체가 보이는 최소 거리 계산\r\n        const frustum = camera.frustum;\r\n        const fovy    = frustum.fovy || Cesium.Math.toRadians(60.0);\r\n        const aspect  = frustum.aspectRatio\r\n            || (viewer.canvas.clientWidth / viewer.canvas.clientHeight);\r\n\r\n        const fovx = 2.0 * Math.atan(Math.tan(fovy / 2.0) * aspect);\r\n\r\n        // 세로/가로 중 더 가까운 쪽 기준으로 거리 계산\r\n        const distV = radius / Math.sin(fovy / 2.0);\r\n        const distH = radius / Math.sin(fovx / 2.0);\r\n        let fitDistance = Math.max(distV, distH) * 1.1;   // 살짝 여유 10%\r\n\r\n        // 너무 가깝거나 너무 멀지 않게 한번 더 클램프\r\n        const dMin = 3.0;    // 실내용 너무 붙지 않게\r\n        const dMax = 50.0;  // 너무 멀어지지 않게 (필요하면 조정)\r\n        fitDistance = Cesium.Math.clamp(fitDistance, dMin, dMax);\r\n\r\n        // 현재 카메라 → 모델 중심 방향 기준으로 앞/뒤 결정\r\n        const forward = Cesium.Cartesian3.normalize(\r\n            Cesium.Cartesian3.subtract(\r\n                center,\r\n                camera.position,\r\n                new Cesium.Cartesian3()\r\n            ),\r\n            new Cesium.Cartesian3()\r\n        );\r\n\r\n        // 최종 카메라 위치 = 모델 중심 앞쪽에서 fitDistance 만큼 떨어진 곳\r\n        const newPosition = Cesium.Cartesian3.add(\r\n            center,\r\n            Cesium.Cartesian3.multiplyByScalar(\r\n                forward,\r\n                -fitDistance,\r\n                new Cesium.Cartesian3()\r\n            ),\r\n            new Cesium.Cartesian3()\r\n        );\r\n\r\n        // direction = 중심을 바라보는 방향\r\n        const direction = Cesium.Cartesian3.normalize(\r\n            Cesium.Cartesian3.subtract(\r\n                center,\r\n                newPosition,\r\n                new Cesium.Cartesian3()\r\n            ),\r\n            new Cesium.Cartesian3()\r\n        );\r\n\r\n        // up 벡터는 지표면 법선 기반 구성\r\n        const ellipsoid = scene.globe.ellipsoid;\r\n        const worldUp   = ellipsoid.geodeticSurfaceNormal(\r\n            center,\r\n            new Cesium.Cartesian3()\r\n        );\r\n\r\n        const right = Cesium.Cartesian3.normalize(\r\n            Cesium.Cartesian3.cross(direction, worldUp, new Cesium.Cartesian3()),\r\n            new Cesium.Cartesian3()\r\n        );\r\n        const up = Cesium.Cartesian3.normalize(\r\n            Cesium.Cartesian3.cross(right, direction, new Cesium.Cartesian3()),\r\n            new Cesium.Cartesian3()\r\n        );\r\n\r\n        camera.flyTo({\r\n            destination: newPosition,\r\n            orientation: {\r\n                direction: direction,\r\n                up: up\r\n            },\r\n            duration: 0.7,\r\n            easingFunction: Cesium.EasingFunction.QUADRATIC_OUT\r\n        });\r\n}\r\n\r\n/*\r\n* 모델의 사이즈에 맞춰서 카메라 이동\r\n* 카메라 위치 자세 유지 x\r\n*/\r\nexport function flyPivotFitModel(viewer, model){\r\n    if (!viewer || !model) return;\r\n\r\n    const camera = viewer.camera;\r\n\r\n    // 모델의 BoundingSphere\r\n    let bs = model._boundingSphere || model.boundingSphere;\r\n    if (!bs) return;\r\n\r\n    const radius = bs.radius || 10.0;\r\n\r\n    // 화면에 꽉 차게 들어오도록 거리 계산\r\n    const frustum = camera.frustum;\r\n    const fovy    = frustum.fovy || Cesium.Math.toRadians(60.0);\r\n    const aspect  = frustum.aspectRatio\r\n        || (viewer.canvas.clientWidth / viewer.canvas.clientHeight);\r\n\r\n    const fovx    = 2.0 * Math.atan(Math.tan(fovy / 2.0) * aspect);\r\n    const distV   = radius / Math.sin(fovy / 2.0);\r\n    const distH   = radius / Math.sin(fovx / 2.0);\r\n    let fitDistance = Math.max(distV, distH) * 1.1; // 여유 10%\r\n\r\n    // 거리 클램프\r\n    const dMin = 3.0;\r\n    const dMax = 50.0;\r\n    fitDistance = Cesium.Math.clamp(fitDistance, dMin, dMax);\r\n\r\n    // 현재 카메라 heading/pitch 가져오기\r\n    let heading = camera.heading;\r\n    let pitch   = camera.pitch;\r\n\r\n    const minPitch = Cesium.Math.toRadians(-80);\r\n    const maxPitch = Cesium.Math.toRadians(-10);\r\n    pitch = Cesium.Math.clamp(pitch, minPitch, maxPitch);\r\n\r\n    const offset = new Cesium.HeadingPitchRange(\r\n        heading,\r\n        pitch,\r\n        fitDistance\r\n    );\r\n\r\n    // Cesium 내장 로직으로 fly + pivot 설정\r\n    camera.flyToBoundingSphere(bs, {\r\n        offset,\r\n        duration: 0.7,\r\n        easingFunction: Cesium.EasingFunction.QUADRATIC_OUT\r\n    });\r\n}\r\n\r\nexport function flyToTilesetsWithPreset(\r\n  viewer,\r\n  union,                 \r\n  presetKey = \"top\",     // \"top\" | \"left\" | \"right\"\r\n  duration = 0.8,\r\n  range = 600\r\n) {\r\n  if(presetKey===\"left\" | presetKey === \"right\"){\r\n    alert('해당 서비스 준비중입니다.');\r\n    return;\r\n  }\r\n  if (!union) {\r\n    return;\r\n  }\r\n\r\n  const preset = VIEW_PRESETS[presetKey] || VIEW_PRESETS.top;\r\n\r\n  viewer.scene.camera.flyToBoundingSphere(union, {\r\n    duration,\r\n    offset: new Cesium.HeadingPitchRange(\r\n      preset.heading,\r\n      preset.pitch,\r\n      range\r\n    ),\r\n    easingFunction: Cesium.EasingFunction.SINUSOIDAL_IN_OUT,\r\n  });\r\n}","export function CameraFreeMode({cesiumViewer}){\r\n    let enabled = false;\r\n\r\n    let viewer = cesiumViewer, handler;\r\n    let looking = false;\r\n    let startMousePosition, mousePosition;\r\n\r\n    const SENS = 0.25; // 마우스 감도\r\n     // 마우스 회전 감도와 피치 한계\r\n    const PITCH_MIN = Cesium.Math.toRadians(-89.0);\r\n    const PITCH_MAX = Cesium.Math.toRadians( 89.0);\r\n\r\n    // 드래그 시작 시 기준 각도 저장\r\n    let headingTemp = 0.0;\r\n    let pitchTemp   = 0.0;\r\n    \r\n    const flags = {\r\n        moveForward:false, \r\n        moveBackward:false, \r\n        moveUp:false, \r\n        moveDown:false, \r\n        moveLeft:false, \r\n        moveRight:false\r\n    };\r\n\r\n    const keyDown = (e) => {\r\n        const m = {\r\n            KeyW: 'moveForward', \r\n            KeyS: 'moveBackward', \r\n            KeyQ: 'moveUp', \r\n            KeyE: 'moveDown', \r\n            KeyA: 'moveLeft', \r\n            KeyD: 'moveRight'\r\n        }[e.code];\r\n        if (m) flags[m] = true;\r\n    };\r\n    const keyUp = (e) => {\r\n        const m = {\r\n        KeyW: 'moveForward', KeyS: 'moveBackward', KeyQ: 'moveUp', KeyE: 'moveDown', KeyA: 'moveLeft', KeyD: 'moveRight'\r\n        }[e.code];\r\n        if (m) flags[m] = false;\r\n    };\r\n\r\n    function setDefaultControls(enabled) {\r\n        const c = viewer.scene.screenSpaceCameraController;\r\n        c.enableRotate   = enabled;\r\n        c.enableTranslate= enabled;\r\n        c.enableZoom     = enabled;\r\n        c.enableTilt     = enabled;\r\n        c.enableLook     = enabled;\r\n    }\r\n\r\n    function onTick() {\r\n        const camera = viewer.camera;\r\n        const canvas = viewer.canvas;\r\n        const ellipsoid = viewer.scene.globe.ellipsoid;\r\n        // 마우스 좌/우, 상/하만 반영 (roll=0 고정)\r\n        if (looking) {\r\n            const w = canvas.clientWidth;\r\n            const h = canvas.clientHeight;\r\n\r\n            const dx = (mousePosition.x - startMousePosition.x) / w;   // 좌우 이동량\r\n            const dy = (mousePosition.y - startMousePosition.y) / h;   // 상하 이동량\r\n\r\n            // 화면 이동량을 각도(라디안)로 변환\r\n            const dHeading = Cesium.Math.toRadians(dx * 180 * SENS);   // 좌우가 반대로 느껴지면 부호를 -로\r\n            const dPitch   = Cesium.Math.toRadians(-dy * 180 * SENS);\r\n\r\n            let newHeading = headingTemp + dHeading;\r\n            let newPitch   = Cesium.Math.clamp(pitchTemp + dPitch, PITCH_MIN, PITCH_MAX);\r\n\r\n            // 정규화 및 roll=0 고정\r\n            newHeading = Cesium.Math.negativePiToPi(newHeading);\r\n\r\n            camera.setView({\r\n                orientation: new Cesium.HeadingPitchRoll(newHeading, newPitch, 0.0)\r\n            });\r\n        }\r\n        const cameraHeight = ellipsoid.cartesianToCartographic(camera.position).height;\r\n        const moveRate = cameraHeight / 100.0;\r\n        if (flags.moveForward)  camera.moveForward(moveRate);\r\n        if (flags.moveBackward) camera.moveBackward(moveRate);\r\n        if (flags.moveUp)       camera.moveUp(moveRate);\r\n        if (flags.moveDown)     camera.moveDown(moveRate);\r\n        if (flags.moveLeft)     camera.moveLeft(moveRate);\r\n        if (flags.moveRight)    camera.moveRight(moveRate);\r\n    }\r\n\r\n    function freeHelpHtml() {\r\n        return `\r\n            <div id=\"freeHelp\" class=\"free-help\" role=\"dialog\" aria-live=\"polite\">\r\n            <div class=\"row\"><kbd>W / S</kbd><div>앞/뒤 이동</div></div>\r\n            <div class=\"row\"><kbd>A / D</kbd><div>좌/우 이동</div></div>\r\n            <div class=\"row\"><kbd>Q / E</kbd><div>상/하 이동</div></div>\r\n            <div class=\"row\"><kbd>마우스 드래그</kbd><div>회전(좌·우 / 상·하)</div></div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    function placeFreeHelp() {\r\n        const $tb = $(viewer.container);\r\n        const $fh = $('#freeHelp');\r\n        if (!$tb.length || !$fh.length) return;\r\n        const r = $tb[0].getBoundingClientRect();\r\n        // 툴바의 상단으로부터 약간 위(8px) 위치\r\n        //const bottom = window.innerHeight - r.top + 8;\r\n        $fh.css({ left: `${r.left + r.width / 2}px`, bottom: `8px`, transform: 'translateX(-50%)' });\r\n    }\r\n\r\n    function showHelp() {\r\n            if ($('#freeHelp').length) return;\r\n            $('body').append(freeHelpHtml());\r\n            placeFreeHelp();\r\n            $(window).on('resize.freehelp scroll.freehelp', placeFreeHelp);\r\n    }\r\n\r\n    function hideHelp() {\r\n        $(window).off('.freehelp');\r\n        $('#freeHelp').remove();\r\n    }\r\n\r\n    function enable() {\r\n        if (!viewer) return;\r\n        if (enabled) return;\r\n\r\n        //기본 카메라 조작 끄기\r\n        setDefaultControls(false);\r\n        viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\r\n           \r\n        // 마우스 핸들러 설정\r\n        if(!handler) handler = new Cesium.ScreenSpaceEventHandler(viewer.canvas);\r\n        \r\n        handler.setInputAction((movement)=>{\r\n            looking = true;\r\n            mousePosition = startMousePosition = Cesium.Cartesian3.clone(movement.position);\r\n            headingTemp = viewer.camera.heading;\r\n            pitchTemp  = Cesium.Math.clamp(viewer.camera.pitch, PITCH_MIN, PITCH_MAX);\r\n        }, Cesium.ScreenSpaceEventType.LEFT_DOWN);\r\n\r\n        handler.setInputAction((movement)=>{ \r\n            mousePosition = movement.endPosition; \r\n        },Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n        handler.setInputAction(()=>{ \r\n            looking = false;\r\n        },Cesium.ScreenSpaceEventType.LEFT_UP);\r\n\r\n        // 키보드 등록\r\n        document.addEventListener('keydown', keyDown);\r\n        document.addEventListener('keyup',   keyUp);\r\n\r\n        //업데이트\r\n        viewer.clock.onTick.addEventListener(onTick);\r\n\r\n        // 도움말 보이기\r\n        showHelp();\r\n\r\n        enabled = true;\r\n    }\r\n\r\n    function disable() {\r\n        if (!viewer) return;\r\n        if (!enabled) return;\r\n        // 업데이트 제거\r\n        viewer.clock.onTick.removeEventListener(onTick);\r\n        // 키보드 제거\r\n        document.removeEventListener('keydown', keyDown);\r\n        document.removeEventListener('keyup',   keyUp);\r\n        // 마우스 핸들러 제거\r\n        if (handler) { handler.destroy(); handler = undefined; }\r\n        looking = false;\r\n        Object.keys(flags).forEach(k=> flags[k]=false);\r\n        // 기본 카메라 조작 다시 켜기\r\n        setDefaultControls(true);\r\n\r\n        // 도움말 숨기기\r\n        hideHelp();\r\n\r\n        enabled = false;\r\n    }\r\n\r\n    return {enable, disable};\r\n}","export function Measurement({cesiumViewer}){\r\n    let viewer = cesiumViewer;\r\n    let handler = new Cesium.ScreenSpaceEventHandler(viewer.canvas);\r\n    let mode; // 'D' | 'A' | 'V' (거리 or 면적 or 수직)\r\n    let areaOptions = 'ground';\r\n    let floatingPoint, activeShape;\r\n    let activeShapePoints = [];\r\n    let keydownHandler = null;\r\n    let mouseLabel,prevCursor; //측정도구 라벨/커서\r\n\r\n    // 확정된 것들(완료 후 남기는 엔티티)\r\n    let measureEndEntity = { graphics: [], points: [], labels: [] };\r\n\r\n    // 진행 중(세션) 엔티티: 취소 시 전부 제거\r\n    let session = { points: [], labels: [], graphics: [] };\r\n\r\n    function offHandler() {\r\n        if (!handler) return;\r\n        handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n        handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n        handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK);\r\n        handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n    }\r\n\r\n    function resetSession() {\r\n        // 진행 중 엔티티 제거\r\n        session.graphics.forEach(function (g) { viewer.entities.remove(g); });\r\n        session.points.forEach(function (p) { viewer.entities.remove(p); });\r\n        session.labels.forEach(function (l) { viewer.entities.remove(l); });\r\n        session.graphics = [];\r\n        session.points = [];\r\n        session.labels = [];\r\n\r\n        // 진행 드로우 동적 제거\r\n        if (activeShape) viewer.entities.remove(activeShape);\r\n        if (floatingPoint) viewer.entities.remove(floatingPoint);\r\n        activeShape = undefined;\r\n        floatingPoint = undefined;\r\n        activeShapePoints = [];\r\n    }\r\n\r\n    // 키보드 바인딩/해제 유틸\r\n    function bindKeyboard() {\r\n        var canvas = viewer.canvas;\r\n        // 키보드 포커스 받을 수 있도록\r\n        if (canvas.tabIndex !== 0) canvas.tabIndex = 0;\r\n        // 클릭하면 포커스 이동\r\n        canvas.addEventListener('click', function () { canvas.focus(); });\r\n\r\n        keydownHandler = function (e) {\r\n            if (e.key === 'Escape' || e.key === 'Esc' || e.keyCode === 27) {\r\n                // 진행 중 측정만 취소\r\n                resetSession();\r\n            }\r\n        };\r\n        canvas.addEventListener('keydown', keydownHandler);\r\n    }\r\n\r\n    function unbindKeyboard() {\r\n        var canvas = viewer && viewer.canvas;\r\n        if (canvas && keydownHandler) {\r\n            canvas.removeEventListener('keydown', keydownHandler);\r\n        }\r\n        keydownHandler = null;\r\n    }\r\n\r\n    function createLabel(pos, text, options={}) {\r\n        const LABEL_STYLE = {\r\n            font: 'bold 11px Inter, Pretendard, system-ui, sans-serif',\r\n            rowH: 22,          // 한 줄 높이\r\n            padX: 8,          // 좌우 패딩\r\n            radius: 11,        \r\n            gap: 5,            // 줄 간격\r\n            fg: '#FFFFFF',\r\n            scale: 1,\r\n            near: 250, nearScale: 1.0,\r\n            far: 1800, farScale: 0.55\r\n        };\r\n        const parts = String(text).split(/\\n/).map(s => s.trim()).filter(Boolean);\r\n        const axes = ['경도', '위도', '높이'];\r\n        const colors = ['#E53935', '#22C55E', '#1E88E5'];\r\n        const lines = (parts.length > 1)\r\n            ? parts.map((v, i) => {\r\n                const unit = (i === 2) ? ' m' : '';   // 높이에만 단위\r\n                return `${axes[i] || ''}${axes[i] ? ' : ' : ''}${v}${unit}`;\r\n                })\r\n            : [text];\r\n\r\n        var canvas = document.createElement('canvas');\r\n        var ctx = canvas.getContext('2d');\r\n        ctx.font = LABEL_STYLE.font;\r\n\r\n\r\n        let maxTextW = 0;\r\n        for (const s of lines) maxTextW = Math.max(maxTextW, Math.ceil(ctx.measureText(s).width));\r\n        const w = maxTextW + LABEL_STYLE.padX * 2;\r\n        const h = lines.length > 1\r\n            ? (lines.length * LABEL_STYLE.rowH) + ((lines.length - 1) * LABEL_STYLE.gap)\r\n            : LABEL_STYLE.rowH;\r\n   \r\n        var dpr = Math.min(1.5, window.devicePixelRatio || 1); // 너무 커지지 않게 상한\r\n        canvas.width  = Math.max(2, Math.round(w * dpr));\r\n        canvas.height = Math.max(2, Math.round(h * dpr));\r\n        ctx.scale(dpr, dpr);\r\n\r\n        ctx.font = LABEL_STYLE.font;\r\n        ctx.textBaseline = 'middle';\r\n        ctx.textAlign = 'center';\r\n\r\n        // 라운드 사각형\r\n        function roundRect(x, y, w, h, r) {\r\n            ctx.beginPath();\r\n            ctx.moveTo(x + r, y);\r\n            ctx.arcTo(x + w, y,     x + w, y + h, r);\r\n            ctx.arcTo(x + w, y + h, x,     y + h, r);\r\n            ctx.arcTo(x,     y + h, x,     y,     r);\r\n            ctx.arcTo(x,     y,     x + w, y,     r);\r\n            ctx.closePath();\r\n        }\r\n\r\n      \r\n        let y = 0;\r\n        for (let i = 0; i < lines.length; i++) {\r\n            const bg = (lines.length > 1) ? (colors[i % colors.length]) : '#2F80FF';\r\n\r\n            // 배경 pill\r\n            ctx.fillStyle = bg;\r\n            roundRect(0, y, w, LABEL_STYLE.rowH, LABEL_STYLE.radius);\r\n            ctx.fill();\r\n\r\n            // 텍스트\r\n            ctx.fillStyle = LABEL_STYLE.fg;\r\n            ctx.fillText(lines[i], w / 2, y + LABEL_STYLE.rowH / 2);\r\n\r\n            y += LABEL_STYLE.rowH + (i < lines.length - 1 ? LABEL_STYLE.gap : 0);\r\n        }\r\n\r\n        const placeRight = options.point === true;\r\n        const horizontalOrigin = placeRight ? Cesium.HorizontalOrigin.LEFT   : Cesium.HorizontalOrigin.CENTER;\r\n        const verticalOrigin   = placeRight ? Cesium.VerticalOrigin.CENTER   : Cesium.VerticalOrigin.CENTER;\r\n        const pixelOffset      = placeRight ? new Cesium.Cartesian2(12, 0)   : new Cesium.Cartesian2(0, -20);\r\n\r\n        return viewer.entities.add({\r\n            position: pos,\r\n            billboard: {\r\n                image: canvas,\r\n                horizontalOrigin: horizontalOrigin,\r\n                verticalOrigin: verticalOrigin,\r\n           \r\n                scale: LABEL_STYLE.scale,\r\n                pixelOffset: pixelOffset,\r\n             \r\n                // scaleByDistance: new Cesium.NearFarScalar(\r\n                //     LABEL_STYLE.near, LABEL_STYLE.nearScale,\r\n                //     LABEL_STYLE.far,  LABEL_STYLE.farScale\r\n                // ),\r\n                eyeOffset: new Cesium.Cartesian3(0, 0, -1),\r\n                heightReference: Cesium.HeightReference.NONE,\r\n                disableDepthTestDistance: Number.POSITIVE_INFINITY\r\n            }\r\n        });\r\n    }\r\n\r\n    function createPoint(pos) {\r\n        return viewer.entities.add({\r\n            position: pos,\r\n            point: {\r\n                pixelSize: 6,\r\n                outlineWidth: 2,\r\n                color: Cesium.Color.fromCssColorString('#FFFFFF'),\r\n                outlineColor: Cesium.Color.fromCssColorString('#2F80FF'),\r\n                // 건물 측정은 지면 클램핑 금지\r\n                heightReference: Cesium.HeightReference.NONE,\r\n                disableDepthTestDistance: Number.POSITIVE_INFINITY\r\n            }\r\n        });\r\n    }\r\n\r\n    function drawShape(positionData, clickEvtType) {\r\n        function getLineMaterial(isFinal) {\r\n            return isFinal\r\n            ? Cesium.Color.fromCssColorString('#2F80FF') // 확정: 실선\r\n            : new Cesium.PolylineDashMaterialProperty({   // 진행중: 점선\r\n                color: Cesium.Color.fromCssColorString('#2F80FF')\r\n                // PolylineDash에는 glowPower 없음\r\n            });\r\n        }\r\n        function addPolyline(positions, material) {\r\n            return viewer.entities.add({\r\n                polyline: {\r\n                positions,\r\n                clampToGround: false,\r\n                arcType: Cesium.ArcType.NONE,\r\n                width: 2.5,\r\n                material,\r\n                depthFailMaterial: material\r\n                }\r\n            });\r\n        }\r\n        function addPolygon(hierarchy) {\r\n            return viewer.entities.add({\r\n                polygon: {\r\n                hierarchy,\r\n                material: Cesium.Color.fromCssColorString('rgba(47,128,255,0.25)'),\r\n                outline: true,\r\n                outlineColor: Cesium.Color.fromCssColorString('#2F80FF'),\r\n                outlineWidth: 1.5\r\n                }\r\n            });\r\n        }\r\n\r\n        const isFinal = (clickEvtType === Cesium.ScreenSpaceEventType.RIGHT_CLICK);\r\n\r\n        if (mode === 'D') {\r\n            // 거리: 폴리라인\r\n            return addPolyline(positionData, getLineMaterial(isFinal));\r\n        }\r\n        if(mode === 'A'){\r\n            if (areaOptions === 'ground') {\r\n                // 지면: 폴리곤\r\n                return addPolygon(positionData);\r\n            } else {\r\n                // 표면: 폴리라인(진행중 점선 / 확정 실선)\r\n                return addPolyline(positionData, getLineMaterial(isFinal));\r\n            }\r\n        }\r\n    }\r\n\r\n    function finalizeActive(clickEvtType) {\r\n        if (!activeShape) return;\r\n\r\n        function closeSurfaceRing(arr){\r\n            // 점 두개 이상이면 닫힌 링을 생성\r\n            return (arr.length > 2 && arr[0] !== arr[arr.length-1]) ? arr.concat([arr[0]]) : arr;\r\n        }\r\n\r\n        // MOUSE_MOVE에서 들어간 활성화 점 제거\r\n        activeShapePoints.pop();\r\n\r\n        var position;\r\n        if(mode === 'A') {\r\n            areaOptions === 'ground' ? \r\n            position = new Cesium.PolygonHierarchy(activeShapePoints) : position = closeSurfaceRing(activeShapePoints);\r\n        }else{\r\n            position = activeShapePoints\r\n        }\r\n        viewer.entities.remove(activeShape);\r\n        activeShape = undefined;\r\n\r\n        // 확정(라인/폴리곤)\r\n        var finalShape = drawShape(position, clickEvtType);\r\n        measureEndEntity.graphics.push(finalShape);\r\n\r\n        // 커서 이동점만 제거\r\n        if (floatingPoint) viewer.entities.remove(floatingPoint);\r\n        floatingPoint = undefined;\r\n\r\n        // 세션 엔티티는 viewer에서 제거하지 말고 확정 버킷으로 넘긴 뒤 배열만 비웁니다.\r\n        Array.prototype.push.apply(measureEndEntity.points, session.points);\r\n        Array.prototype.push.apply(measureEndEntity.labels, session.labels);\r\n        session.points = [];\r\n        session.labels = [];\r\n        session.graphics = [];\r\n\r\n        // 좌표 버퍼 리셋\r\n        activeShapePoints = [];\r\n\r\n        // 마우스 라벨 숨김\r\n        hideMouseLabel();\r\n    }\r\n\r\n    function bindDrawing() {\r\n        function areaValue(points) {\r\n            if (!points || points.length < 3) return 0;\r\n\r\n            const p0 = points[0];\r\n            let area = 0.0;\r\n            for (let i = 1; i < points.length - 1; i++) {\r\n                const v1 = Cesium.Cartesian3.subtract(points[i],     p0, new Cesium.Cartesian3());\r\n                const v2 = Cesium.Cartesian3.subtract(points[i + 1], p0, new Cesium.Cartesian3());\r\n                const cross = Cesium.Cartesian3.cross(v1, v2, new Cesium.Cartesian3());\r\n                area += Cesium.Cartesian3.magnitude(cross) * 0.5; // 면적\r\n            }\r\n            return area; // m^2 (Cartesian3가 미터 스케일일 때)\r\n        }\r\n\r\n        // 더블클릭 시 카메라 트래킹 해제\r\n        handler.setInputAction(function () {\r\n            viewer.trackedEntity = undefined;\r\n        }, Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n\r\n        // LEFT_CLICK: 점 추가(거리/면적 공통)\r\n        handler.setInputAction(async function (movement) {\r\n            var cart = viewer.scene.pickPosition(movement.position);\r\n            if (!Cesium.defined(cart)) return;\r\n            if(mode === 'P'){\r\n                const feature = viewer.scene.pick(movement.position);\r\n                if (!Cesium.defined(feature)) {\r\n                    return;\r\n                }\r\n                const cartographic = Cesium.Cartographic.fromCartesian(cart);\r\n                const lon = Cesium.Math.toDegrees(cartographic.longitude).toFixed(6);\r\n                const lat = Cesium.Math.toDegrees(cartographic.latitude).toFixed(6);\r\n                const height = cartographic.height.toFixed(2);\r\n                \r\n                measureEndEntity.points.push(createPoint(cart))\r\n                measureEndEntity.labels.push(createLabel(cart, `${lon}\\n${lat}\\n${height}`,{ point: true }))\r\n                return;\r\n            }\r\n\r\n            if (mode === 'V') {\r\n                const feature = viewer.scene.pick(movement.position);\r\n                if (!Cesium.defined(feature)) return;\r\n                await measureVerticalGapAt(movement.position);\r\n                return; \r\n            }\r\n\r\n            if (activeShapePoints.length === 0) { // 거리, 면적의 첫 포인트\r\n                resetSession();\r\n                floatingPoint = createPoint(cart);\r\n                activeShapePoints.push(cart);\r\n                var dynamicPositions;\r\n                if (mode === 'D') {\r\n                    dynamicPositions = new Cesium.CallbackProperty(function () {\r\n                        return activeShapePoints;\r\n                    }, false);\r\n                } else { // 'ground'\r\n                    if(areaOptions === 'ground'){\r\n                        dynamicPositions = new Cesium.CallbackProperty(function () {\r\n                        return new Cesium.PolygonHierarchy(activeShapePoints);\r\n                        }, false);\r\n                    }else{ // 'surface'\r\n                        dynamicPositions = new Cesium.CallbackProperty(function () {\r\n                            const pts = activeShapePoints;\r\n                            if (pts.length === 0) return [];\r\n                            return (pts.length > 1) ? pts.concat([pts[0]]) : pts; // 링 닫기\r\n                        }, false);\r\n                    }\r\n                }\r\n                activeShape = drawShape(dynamicPositions);\r\n                session.graphics.push(activeShape);\r\n            }\r\n            if (activeShapePoints.length > 1 && mode === 'D') {\r\n                var prev = activeShapePoints[activeShapePoints.length - 2];\r\n                var dist = Cesium.Cartesian3.distance(cart, prev);\r\n                var mid = Cesium.Cartesian3.midpoint(prev, cart, new Cesium.Cartesian3());\r\n                var txt = dist > 1000 ? (dist / 1000).toFixed(3) + 'km' : dist.toFixed(2) + 'm';\r\n                var segLabel = createLabel(mid, txt);\r\n                session.labels.push(segLabel);\r\n            }\r\n\r\n            activeShapePoints.push(cart);\r\n            var p = createPoint(cart);\r\n            session.points.push(p);\r\n        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n\r\n        // MOUSE_MOVE: 점선 갱신\r\n        handler.setInputAction(function (movement) {\r\n            showMouseLabelAt(movement.endPosition,setMouseLabelText(mode, areaOptions));\r\n            if (!Cesium.defined(floatingPoint)) return;\r\n            var np = viewer.scene.pickPosition(movement.endPosition);\r\n            if (!Cesium.defined(np)) return;\r\n            floatingPoint.position.setValue(np);\r\n            activeShapePoints.pop();\r\n            activeShapePoints.push(np);\r\n            \r\n        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n\r\n        // RIGHT_CLICK: 종료(거리 또는 면적 확정)\r\n        handler.setInputAction(function () {\r\n            if (mode === 'A') {\r\n                if (session.points.length < 3) {\r\n                    alert('면적 측정 : 기본 3개 이상의 점이 필요합니다');\r\n                    return;\r\n                }\r\n                if(areaOptions === 'ground'){\r\n                    var hierarchy = activeShape.polygon.hierarchy.getValue();\r\n                    var indices = Cesium.PolygonPipeline.triangulate(hierarchy.positions);\r\n                    var area = 0;\r\n                    for (var i = 0; i < indices.length; i += 3) {\r\n                        var v1 = hierarchy.positions[indices[i]];\r\n                        var v2 = hierarchy.positions[indices[i + 1]];\r\n                        var v3 = hierarchy.positions[indices[i + 2]];\r\n                        var vc = Cesium.Cartesian3.subtract(v2, v1, new Cesium.Cartesian3());\r\n                        var vd = Cesium.Cartesian3.subtract(v3, v1, new Cesium.Cartesian3());\r\n                        var cross = Cesium.Cartesian3.cross(vc, vd, new Cesium.Cartesian3());\r\n                        area += Cesium.Cartesian3.magnitude(cross) / 2.0;\r\n                    }\r\n                    var txt = '면적 : ' + area.toFixed(2) + 'm²';\r\n                    var center = Cesium.BoundingSphere.fromPoints(hierarchy.positions).center;\r\n                    var areaLabel = createLabel(center, txt);\r\n                    session.labels.push(areaLabel);\r\n                }else{\r\n                    const ring = activeShapePoints.slice(); // finalizeActive 전이라면 pop 안 했을 수도 있음\r\n                    const area = areaValue(ring);\r\n                    const center = Cesium.BoundingSphere.fromPoints(ring).center;\r\n                    const label = createLabel(center, '면적 : ' + area.toFixed(2) + ' m²');\r\n                    session.labels.push(label);\r\n                }\r\n            }\r\n            finalizeActive(Cesium.ScreenSpaceEventType.RIGHT_CLICK);\r\n        }, Cesium.ScreenSpaceEventType.RIGHT_CLICK);\r\n    }\r\n\r\n    function ensureMouseLabel() {\r\n        if (mouseLabel) return;\r\n        mouseLabel = viewer.entities.add({\r\n            position: Cesium.Cartesian3.fromDegrees(0,0,0),\r\n            label: {\r\n                font: '600 12px Inter, Pretendard, system-ui, sans-serif',\r\n\r\n                style: Cesium.LabelStyle.FILL_AND_OUTLINE,\r\n                fillColor: Cesium.Color.WHITE,\r\n                outlineColor: Cesium.Color.fromCssColorString('rgba(0,0,0,0.85)'),\r\n                outlineWidth: 3,\r\n\r\n                showBackground: true,\r\n                backgroundColor: Cesium.Color.fromCssColorString('#444444ff').withAlpha(1),\r\n                backgroundPadding: new Cesium.Cartesian2(8, 6),\r\n        \r\n                horizontalOrigin: Cesium.HorizontalOrigin.LEFT,\r\n                verticalOrigin: Cesium.VerticalOrigin.TOP,\r\n                pixelOffset: new Cesium.Cartesian2(12, 12),\r\n                disableDepthTestDistance: Number.POSITIVE_INFINITY\r\n            },\r\n            show: false\r\n        });\r\n    }\r\n\r\n    function setMouseLabelText(mode) {\r\n        let text = `우클릭: 종료\\nESC: 취소`;\r\n        if (mode === 'V') {\r\n            text = '좌클릭: 측정\\nESC: 취소';\r\n        }\r\n        if (mode === 'P') {\r\n            text = '좌클릭: 측정\\nESC: 취소';\r\n        }\r\n        \r\n        return text;\r\n    }\r\n\r\n    function showMouseLabelAt(screenPosition, text) {\r\n        ensureMouseLabel();\r\n        const scene = viewer.scene;\r\n\r\n        // 화면 좌표 → 3D 좌표\r\n        let cart = scene.pickPositionSupported ? scene.pickPosition(screenPosition) : undefined;\r\n        if (!Cesium.defined(cart)) {\r\n            cart = scene.camera.pickEllipsoid(screenPosition, scene.globe.ellipsoid);\r\n        }\r\n\r\n        if (!Cesium.defined(cart)) {\r\n            mouseLabel.show = false;\r\n            return;\r\n        }\r\n\r\n        // 위치 갱신\r\n        mouseLabel.position = cart;\r\n        mouseLabel.show = true;\r\n        mouseLabel.label.show = true;\r\n    }\r\n\r\n    function hideMouseLabel() {\r\n        if (mouseLabel) mouseLabel.label.show = false;\r\n    }\r\n\r\n    // 커서 스타일 토글\r\n    function setDrawingCursor(on) {\r\n        const canvas = viewer.canvas;\r\n        if (!canvas) return;\r\n\r\n        if (on) {\r\n            if (!prevCursor) prevCursor = getComputedStyle(canvas).cursor; // 계산값 저장\r\n            canvas.style.cursor = 'crosshair';\r\n        } else {\r\n            canvas.style.cursor = prevCursor || 'auto'; // '' 대신 'auto'로\r\n            prevCursor = null;\r\n        }\r\n    }\r\n\r\n    async function getTerrainHeightAt(cp) {\r\n        const globe = viewer.scene.globe;\r\n        const tp = globe.terrainProvider;                   \r\n        try {\r\n            if(tp.availability){\r\n                if(tp.hasMetadata){\r\n                    const [res] = await Cesium.sampleTerrainMostDetailed(tp, [cp]);\r\n                    return res.height;\r\n                }else{\r\n                    return globe.getHeight(cp) ?? 0.0;\r\n                }\r\n            }\r\n        } catch (e) {\r\n            return globe.getHeight(cp) ?? 0.0;\r\n        }\r\n    }\r\n\r\n    async function measureVerticalGapAt(screenPos) {\r\n        const scene = viewer.scene;\r\n\r\n        if (!scene.pickPositionSupported) return;\r\n        const cartModel = scene.pickPosition(screenPos);\r\n        if (!Cesium.defined(cartModel)) return;\r\n\r\n        //위경도 변환\r\n        const cg = Cesium.Cartographic.fromCartesian(cartModel);\r\n        const modelHeight = cg.height; // m\r\n\r\n        //같은 위치에서 지형 높이 샘플\r\n        const cp = new Cesium.Cartographic(cg.longitude, cg.latitude, 0);\r\n\r\n        let terrainHeight = await getTerrainHeightAt(cp);\r\n        // 수직 거리 계산(+면 지면 위, -면 지면 아래)\r\n        const dz = modelHeight - terrainHeight;\r\n        const absDz = Math.abs(dz);\r\n\r\n        //지면 점 3D 좌표\r\n        const cartTerrain = Cesium.Cartesian3.fromRadians(\r\n            cp.longitude, cp.latitude, terrainHeight\r\n        );\r\n\r\n        const verticalLine = viewer.entities.add({\r\n            polyline: {\r\n                positions: [cartModel, cartTerrain],\r\n                width: 2.5,\r\n                arcType: Cesium.ArcType.NONE,\r\n                clampToGround: false,\r\n                material: Cesium.Color.fromCssColorString('#fff200ff').withAlpha(1),\r\n                depthFailMaterial: Cesium.Color.fromCssColorString('#fff200ff')\r\n            }\r\n        });\r\n        measureEndEntity.graphics.push(verticalLine);\r\n\r\n        // 라벨 위치: 중간점\r\n        const label = createLabel(Cesium.Cartesian3.midpoint(cartModel, cartTerrain, new Cesium.Cartesian3()), `수직 거리: ${absDz.toFixed(2)} m`);\r\n        measureEndEntity.labels.push(label);\r\n\r\n        // 모델/지면 점에 작은 포인트\r\n        const pModel = viewer.entities.add({\r\n            position: cartModel,\r\n            point: { \r\n                pixelSize: 6, \r\n                color: Cesium.Color.WHITE, \r\n                disableDepthTestDistance: Number.POSITIVE_INFINITY \r\n            }\r\n        });\r\n        measureEndEntity.points.push(pModel);\r\n\r\n        // 지면포인트\r\n        const pTerr = viewer.entities.add({\r\n            position: cartTerrain,\r\n            point: { \r\n                pixelSize: 6, \r\n                color: Cesium.Color.WHITE, \r\n                outlineColor: Cesium.Color.BLACK, \r\n                outlineWidth: 1.5, \r\n                disableDepthTestDistance: Number.POSITIVE_INFINITY \r\n            }\r\n        });\r\n        measureEndEntity.points.push(pTerr);\r\n\r\n        return { verticalLine, label, pModel, pTerr };\r\n    }\r\n\r\n    function start(m) {\r\n            mode = m;\r\n            resetSession();\r\n            offHandler();\r\n            bindDrawing();\r\n            bindKeyboard();\r\n            ensureMouseLabel();\r\n            mouseLabel.label.text = setMouseLabelText(mode, areaOptions); \r\n            setDrawingCursor(true);\r\n    }\r\n\r\n    function stop(){\r\n            offHandler();\r\n            resetSession(); \r\n            unbindKeyboard()\r\n            hideMouseLabel(); \r\n            setDrawingCursor(false); \r\n            mode=undefined;\r\n             //$(\".tool-root\").find('.tool').removeClass('is-active');\r\n    }\r\n\r\n    function removeAll() {\r\n            measureEndEntity.graphics.forEach(function (g) { viewer.entities.remove(g); });\r\n            measureEndEntity.points.forEach(function (p) { viewer.entities.remove(p); });\r\n            measureEndEntity.labels.forEach(function (l) { viewer.entities.remove(l); });\r\n            measureEndEntity.graphics = [];\r\n            measureEndEntity.points = [];\r\n            measureEndEntity.labels = [];\r\n    }\r\n\r\n    function setAreaMode(mode) {\r\n            // 'ground' | 'surface' 만 허용\r\n            areaOptions = (mode === 'surface') ? 'surface' : 'ground';\r\n    }\r\n\r\n    function mountToolBar({container, onPoint, onLine,\r\n            onVertical, onAreaGround, onAreaSurface, \r\n            onClose, onInit ,onMarkerAdd, onMarkerClose}){\r\n\r\n            const root = (typeof container === 'string') ? document.querySelector(container) : container;\r\n            if (!root) { throw new Error('Tool Bar 생성: 유효한 container가 필요합니다.'); }\r\n\r\n            if (!document.getElementById('dynamic-toolbar-style')) {\r\n                const css = `\r\n                .tool-root{\r\n                    position:absolute;\r\n                    left:50%;\r\n                    bottom:16px;\r\n                    transform:translateX(-50%);\r\n                    display:flex;\r\n                    flex-direction:column;\r\n                    gap:8px;\r\n                    z-index:4000;\r\n                    font-family:system-ui,-apple-system,BlinkMacSystemFont,\"Segoe UI\",\"Noto Sans KR\",sans-serif;\r\n                }\r\n                .tool-group-bar{\r\n                    display:inline-flex;\r\n                    align-items:center;\r\n                    gap:6px;\r\n                    padding:4px;\r\n                    border-radius:999px;\r\n                    background:rgba(11,14,18,.96);\r\n                    border:1px solid #222a33;\r\n                }\r\n                .tool-group{\r\n                    appearance:none;\r\n                    border:0;\r\n                    outline:0;\r\n                    border-radius:999px;\r\n                    padding:0 16px;\r\n                    height:32px;\r\n                    display:inline-flex;\r\n                    align-items:center;\r\n                    justify-content:center;\r\n                    font-size:11px;\r\n                    color:#d0d7e2;\r\n                    background:transparent;\r\n                    cursor:pointer;\r\n                    white-space:nowrap;\r\n                }\r\n                .tool-group.is-active{\r\n                    background:#2f80ff;\r\n                    color:#fff;\r\n                }\r\n\r\n                .tool-panel{\r\n                    display: none;\r\n                    flex-direction: column;\r\n                    /* gap: 8px; */\r\n                    min-width: 275px;\r\n                    max-width: calc(100vw - 19px);\r\n                    padding: 3px 3px;\r\n                    border-radius: 16px;\r\n                    background: rgb(11 14 18 / 83%);\r\n                    border: 1px solid #222a33;\r\n                }\r\n                .tool-panel.is-open{\r\n                    display:flex;\r\n                }\r\n\r\n                .tool-panel-main{\r\n                    display:flex;\r\n                    align-items:center;\r\n                    justify-content:space-between;\r\n                    gap:12px;\r\n                }\r\n                .tool-chip-row{\r\n                    display:flex;\r\n                    /*flex-wrap:wrap;*/\r\n                    gap:6px;\r\n                }\r\n                .tool{\r\n                    border: none;\r\n                    color: #ffffff;\r\n                    padding: 6px 10px;\r\n                    font-size: 11px;\r\n                    cursor: pointer;\r\n                    user-select: none;\r\n                    background: transparent\r\n                }\r\n                .tool:hover {\r\n                    color: #fff;\r\n                    fill: none;\r\n                    background: transparent;\r\n                    box-shadow: 0 0 3px #fff;\r\n                }\r\n                .tool.is-active{\r\n                    color: #fff;\r\n                    fill: none;\r\n                    background: transparent;\r\n                    box-shadow: 0 0 3px #fff;\r\n                }\r\n\r\n                .tool-panel-footer{\r\n                    display:flex;\r\n                    align-items:center;\r\n                    justify-content:end;\r\n                    margin-top:4px;\r\n                    padding-top:6px;\r\n                    border-top:1px solid rgba(255,255,255,.06);\r\n                    font-size:12px;\r\n                    color:#9ca6b5;\r\n                }\r\n                \r\n\r\n                @media (max-width: 480px){\r\n                    .tool-panel{\r\n                        min-width:auto;\r\n                    }\r\n                }\r\n                `;\r\n                const style = document.createElement('style');\r\n                style.id = 'dynamic-toolbar-style';\r\n                style.textContent = css;\r\n                document.head.appendChild(style);\r\n            }\r\n\r\n            // 툴바 DOM 생성(중복 방지)\r\n            let toolRoot = root.querySelector('.tool-root');\r\n            if (!toolRoot) {\r\n                toolRoot = document.createElement('div');\r\n                toolRoot.className = 'tool-root';\r\n                toolRoot.innerHTML = `\r\n                    <!-- 측정 패널 -->\r\n                    <div class=\"tool-panel tool-panel--measure\" data-panel=\"measure\">\r\n                        <div class=\"tool-panel-main\">\r\n                            <div class=\"tool-chip-row\">\r\n                                <button class=\"tool cesium-button\" id=\"btn_point\">\r\n                                    <svg width=\"22\" height=\"22\" viewBox=\"0 0 22 22\" fill=\"none\" class=\"size-5 flex-shrink-0\"><path d=\"M2.46481 16.6006C2.82352 16.3935 3.28213 16.5163 3.48923 16.875C3.69629 17.2337 3.5734 17.6923 3.21481 17.8994L2.3486 18.3994C1.98989 18.6065 1.5313 18.4837 1.32419 18.125C1.11709 17.7663 1.23994 17.3077 1.5986 17.1006L2.46481 16.6006ZM18.5107 16.875C18.7178 16.5163 19.1764 16.3936 19.5351 16.6006L20.4013 17.1006C20.76 17.3077 20.8829 17.7663 20.6757 18.125C20.4686 18.4837 20.01 18.6065 19.6513 18.3994L18.7851 17.8994C18.4266 17.6923 18.3037 17.2336 18.5107 16.875ZM6.14548 14.4756C6.50418 14.2685 6.9628 14.3913 7.16989 14.75C7.37695 15.1087 7.25407 15.5673 6.89548 15.7744L6.02926 16.2744C5.67056 16.4815 5.21197 16.3587 5.00485 16C4.79776 15.6413 4.9206 15.1827 5.27926 14.9756L6.14548 14.4756ZM14.83 14.75C15.0371 14.3913 15.4958 14.2686 15.8545 14.4756L16.7207 14.9756C17.0794 15.1827 17.2022 15.6413 16.9951 16C16.788 16.3587 16.3294 16.4815 15.9707 16.2744L15.1045 15.7744C14.7459 15.5673 14.623 15.1086 14.83 14.75ZM11 9.5C12.6568 9.5 14 10.8431 14 12.5C14 14.1569 12.6568 15.5 11 15.5C9.34313 15.5 7.99997 14.1568 7.99997 12.5C7.99997 10.8432 9.34313 9.50002 11 9.5ZM11 11C10.1716 11 9.49997 11.6716 9.49997 12.5C9.49997 13.3284 10.1716 14 11 14C11.8284 14 12.5 13.3284 12.5 12.5C12.5 11.6716 11.8284 11 11 11ZM11 5.5C11.4142 5.5 11.75 5.83579 11.75 6.25V7.25C11.75 7.66421 11.4142 8 11 8C10.5858 7.99998 10.25 7.6642 10.25 7.25V6.25C10.25 5.8358 10.5858 5.50002 11 5.5ZM11 1.25C11.4142 1.25 11.75 1.58579 11.75 2V3C11.75 3.41421 11.4142 3.75 11 3.75C10.5858 3.74998 10.25 3.4142 10.25 3V2C10.25 1.5858 10.5858 1.25002 11 1.25Z\" fill=\"currentColor\"></path></svg>\r\n                                </button>\r\n                                <button class=\"tool cesium-button\" id=\"btn_line\">\r\n                                    <svg width=\"22\" height=\"22\" viewBox=\"0 0 22 22\" fill=\"none\" class=\"size-5 flex-shrink-0\"><path d=\"M3 16C4.65685 16 6 17.3431 6 19C6 20.6569 4.65685 22 3 22C1.34315 22 0 20.6569 0 19C0 17.3431 1.34315 16 3 16ZM3 17.5C2.17157 17.5 1.5 18.1716 1.5 19C1.5 19.8284 2.17157 20.5 3 20.5C3.82843 20.5 4.5 19.8284 4.5 19C4.5 18.1716 3.82843 17.5 3 17.5ZM7.07324 13.8662C7.36614 13.5733 7.8409 13.5733 8.13379 13.8662C8.42668 14.1591 8.42668 14.6339 8.13379 14.9268L7.42676 15.6338C7.13386 15.9267 6.6591 15.9267 6.36621 15.6338C6.07332 15.3409 6.07332 14.8661 6.36621 14.5732L7.07324 13.8662ZM10.8232 10.1162C11.1161 9.82332 11.5909 9.82332 11.8838 10.1162C12.1767 10.4091 12.1767 10.8839 11.8838 11.1768L11.1768 11.8838C10.8839 12.1767 10.4091 12.1767 10.1162 11.8838C9.82332 11.5909 9.82332 11.1161 10.1162 10.8232L10.8232 10.1162ZM14.5732 6.36621C14.8661 6.07332 15.3409 6.07332 15.6338 6.36621C15.9267 6.6591 15.9267 7.13386 15.6338 7.42676L14.9268 8.13379C14.6339 8.42668 14.1591 8.42668 13.8662 8.13379C13.5733 7.8409 13.5733 7.36614 13.8662 7.07324L14.5732 6.36621ZM19 0C20.6569 0 22 1.34315 22 3C22 4.65685 20.6569 6 19 6C17.3431 6 16 4.65685 16 3C16 1.34315 17.3431 0 19 0ZM19 1.5C18.1716 1.5 17.5 2.17157 17.5 3C17.5 3.82843 18.1716 4.5 19 4.5C19.8284 4.5 20.5 3.82843 20.5 3C20.5 2.17157 19.8284 1.5 19 1.5Z\" fill=\"currentColor\"></path></svg>\r\n                                </button>\r\n                                \r\n                                <button class=\"tool cesium-button\" id=\"btn_vertical\">\r\n                                    <svg width=\"22\" height=\"22\" viewBox=\"0 0 22 22\" fill=\"none\" class=\"size-5 flex-shrink-0\"><path d=\"M11 16C12.3976 16 13.569 16.9565 13.9023 18.25H19C19.4142 18.25 19.75 18.5858 19.75 19C19.75 19.4142 19.4142 19.75 19 19.75H13.9023C13.569 21.0435 12.3976 22 11 22C9.59958 22 8.42628 21.0397 8.0957 19.7422C8.06429 19.7462 8.0325 19.75 8 19.75H3C2.58579 19.75 2.25 19.4142 2.25 19C2.25 18.5858 2.58579 18.25 3 18.25H8C8.03246 18.25 8.06433 18.2528 8.0957 18.2568C8.4266 16.9598 9.59991 16 11 16ZM11 17.5C10.1716 17.5 9.5 18.1716 9.5 19C9.5 19.8284 10.1716 20.5 11 20.5C11.8284 20.5 12.5 19.8284 12.5 19C12.5 18.1716 11.8284 17.5 11 17.5ZM11 11.75C11.4142 11.75 11.75 12.0858 11.75 12.5V13.5C11.75 13.9142 11.4142 14.25 11 14.25C10.5858 14.25 10.25 13.9142 10.25 13.5V12.5C10.25 12.0858 10.5858 11.75 11 11.75ZM11 7.75C11.4142 7.75 11.75 8.08579 11.75 8.5V9.5C11.75 9.91421 11.4142 10.25 11 10.25C10.5858 10.25 10.25 9.91421 10.25 9.5V8.5C10.25 8.08579 10.5858 7.75 11 7.75ZM11 0C12.3976 0 13.569 0.956465 13.9023 2.25H19C19.4142 2.25 19.75 2.58579 19.75 3C19.75 3.41421 19.4142 3.75 19 3.75H13.9023C13.569 5.04354 12.3976 6 11 6C9.59958 6 8.42628 5.03968 8.0957 3.74219C8.06429 3.7462 8.0325 3.75 8 3.75H3C2.58579 3.75 2.25 3.41421 2.25 3C2.25 2.58579 2.58579 2.25 3 2.25H8C8.03246 2.25 8.06433 2.25284 8.0957 2.25684C8.4266 0.959806 9.59991 0 11 0ZM11 1.5C10.1716 1.5 9.5 2.17157 9.5 3C9.5 3.82843 10.1716 4.5 11 4.5C11.8284 4.5 12.5 3.82843 12.5 3C12.5 2.17157 11.8284 1.5 11 1.5Z\" fill=\"currentColor\"></path></svg>\r\n                                </button>\r\n                                <button class=\"tool cesium-button\" id=\"btn_ground\">\r\n                                    <svg width=\"22\" height=\"22\" viewBox=\"0 0 22 22\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                    <g transform=\"rotate(315 13 7.5) scale(0.8)\">\r\n                                        <path d=\"M3 16C4.65685 16 6 17.3431 6 19C6 20.6569 4.65685 22 3 22C1.34315 22 0 20.6569 0 19C0 17.3431 1.34315 16 3 16ZM19 16C20.6569 16 22 17.3431 22 19C22 20.6569 20.6569 22 19 22C17.3431 22 16 20.6569 16 19C16 17.3431 17.3431 16 19 16ZM3 17.5C2.17157 17.5 1.5 18.1716 1.5 19C1.5 19.8284 2.17157 20.5 3 20.5C3.82843 20.5 4.5 19.8284 4.5 19C4.5 18.1716 3.82843 17.5 3 17.5ZM19 17.5C18.1716 17.5 17.5 18.1716 17.5 19C17.5 19.8284 18.1716 20.5 19 20.5C19.8284 20.5 20.5 19.8284 20.5 19C20.5 18.1716 19.8284 17.5 19 17.5ZM9.5 18.25C9.91421 18.25 10.25 18.5858 10.25 19C10.25 19.4142 9.91421 19.75 9.5 19.75H8.5C8.08579 19.75 7.75 19.4142 7.75 19C7.75 18.5858 8.08579 18.25 8.5 18.25H9.5ZM13.5 18.25C13.9142 18.25 14.25 18.5858 14.25 19C14.25 19.4142 13.9142 19.75 13.5 19.75H12.5C12.0858 19.75 11.75 19.4142 11.75 19C11.75 18.5858 12.0858 18.25 12.5 18.25H13.5ZM3 11.75C3.41421 11.75 3.75 12.0858 3.75 12.5V13.5C3.75 13.9142 3.41421 14.25 3 14.25C2.58579 14.25 2.25 13.9142 2.25 13.5V12.5C2.25 12.0858 2.58579 11.75 3 11.75ZM19 11.75C19.4142 11.75 19.75 12.0858 19.75 12.5V13.5C19.75 13.9142 19.4142 14.25 19 14.25C18.5858 14.25 18.25 13.9142 18.25 13.5V12.5C18.25 12.0858 18.5858 11.75 19 11.75ZM3 7.75C3.41421 7.75 3.75 8.08579 3.75 8.5V9.5C3.75 9.91421 3.41421 10.25 3 10.25C2.58579 10.25 2.25 9.91421 2.25 9.5V8.5C2.25 8.08579 2.58579 7.75 3 7.75ZM19 7.75C19.4142 7.75 19.75 8.08579 19.75 8.5V9.5C19.75 9.91421 19.4142 10.25 19 10.25C18.5858 10.25 18.25 9.91421 18.25 9.5V8.5C18.25 8.08579 18.5858 7.75 19 7.75ZM3 0C4.65685 0 6 1.34315 6 3C6 4.65685 4.65685 6 3 6C1.34315 6 0 4.65685 0 3C0 1.34315 1.34315 0 3 0ZM19 0C20.6569 0 22 1.34315 22 3C22 4.65685 20.6569 6 19 6C17.3431 6 16 4.65685 16 3C16 1.34315 17.3431 0 19 0ZM3 1.5C2.17157 1.5 1.5 2.17157 1.5 3C1.5 3.82843 2.17157 4.5 3 4.5C3.82843 4.5 4.5 3.82843 4.5 3C4.5 2.17157 3.82843 1.5 3 1.5ZM19 1.5C18.1716 1.5 17.5 2.17157 17.5 3C17.5 3.82843 18.1716 4.5 19 4.5C19.8284 4.5 20.5 3.82843 20.5 3C20.5 2.17157 19.8284 1.5 19 1.5ZM9.5 2.25C9.91421 2.25 10.25 2.58579 10.25 3C10.25 3.41421 9.91421 3.75 9.5 3.75H8.5C8.08579 3.75 7.75 3.41421 7.75 3C7.75 2.58579 8.08579 2.25 8.5 2.25H9.5ZM13.5 2.25C13.9142 2.25 14.25 2.58579 14.25 3C14.25 3.41421 13.9142 3.75 13.5 3.75H12.5C12.0858 3.75 11.75 3.41421 11.75 3C11.75 2.58579 12.0858 2.25 12.5 2.25H13.5Z\" fill=\"currentColor\"></path>\r\n                                    </g>\r\n                                    <rect x=\"2\" y=\"20.2\" width=\"18\" height=\"1.1\" rx=\"0.55\" fill=\"currentColor\"></rect>\r\n                                    </svg>\r\n                                </button>\r\n                                <button class=\"tool cesium-button\" id=\"btn_surface\">\r\n                                    <svg width=\"22\" height=\"22\" viewBox=\"0 0 22 22\" fill=\"none\" class=\"size-5 flex-shrink-0\"><path d=\"M3 16C4.65685 16 6 17.3431 6 19C6 20.6569 4.65685 22 3 22C1.34315 22 0 20.6569 0 19C0 17.3431 1.34315 16 3 16ZM19 16C20.6569 16 22 17.3431 22 19C22 20.6569 20.6569 22 19 22C17.3431 22 16 20.6569 16 19C16 17.3431 17.3431 16 19 16ZM3 17.5C2.17157 17.5 1.5 18.1716 1.5 19C1.5 19.8284 2.17157 20.5 3 20.5C3.82843 20.5 4.5 19.8284 4.5 19C4.5 18.1716 3.82843 17.5 3 17.5ZM19 17.5C18.1716 17.5 17.5 18.1716 17.5 19C17.5 19.8284 18.1716 20.5 19 20.5C19.8284 20.5 20.5 19.8284 20.5 19C20.5 18.1716 19.8284 17.5 19 17.5ZM9.5 18.25C9.91421 18.25 10.25 18.5858 10.25 19C10.25 19.4142 9.91421 19.75 9.5 19.75H8.5C8.08579 19.75 7.75 19.4142 7.75 19C7.75 18.5858 8.08579 18.25 8.5 18.25H9.5ZM13.5 18.25C13.9142 18.25 14.25 18.5858 14.25 19C14.25 19.4142 13.9142 19.75 13.5 19.75H12.5C12.0858 19.75 11.75 19.4142 11.75 19C11.75 18.5858 12.0858 18.25 12.5 18.25H13.5ZM3 11.75C3.41421 11.75 3.75 12.0858 3.75 12.5V13.5C3.75 13.9142 3.41421 14.25 3 14.25C2.58579 14.25 2.25 13.9142 2.25 13.5V12.5C2.25 12.0858 2.58579 11.75 3 11.75ZM19 11.75C19.4142 11.75 19.75 12.0858 19.75 12.5V13.5C19.75 13.9142 19.4142 14.25 19 14.25C18.5858 14.25 18.25 13.9142 18.25 13.5V12.5C18.25 12.0858 18.5858 11.75 19 11.75ZM3 7.75C3.41421 7.75 3.75 8.08579 3.75 8.5V9.5C3.75 9.91421 3.41421 10.25 3 10.25C2.58579 10.25 2.25 9.91421 2.25 9.5V8.5C2.25 8.08579 2.58579 7.75 3 7.75ZM19 7.75C19.4142 7.75 19.75 8.08579 19.75 8.5V9.5C19.75 9.91421 19.4142 10.25 19 10.25C18.5858 10.25 18.25 9.91421 18.25 9.5V8.5C18.25 8.08579 18.5858 7.75 19 7.75ZM3 0C4.65685 0 6 1.34315 6 3C6 4.65685 4.65685 6 3 6C1.34315 6 0 4.65685 0 3C0 1.34315 1.34315 0 3 0ZM19 0C20.6569 0 22 1.34315 22 3C22 4.65685 20.6569 6 19 6C17.3431 6 16 4.65685 16 3C16 1.34315 17.3431 0 19 0ZM3 1.5C2.17157 1.5 1.5 2.17157 1.5 3C1.5 3.82843 2.17157 4.5 3 4.5C3.82843 4.5 4.5 3.82843 4.5 3C4.5 2.17157 3.82843 1.5 3 1.5ZM19 1.5C18.1716 1.5 17.5 2.17157 17.5 3C17.5 3.82843 18.1716 4.5 19 4.5C19.8284 4.5 20.5 3.82843 20.5 3C20.5 2.17157 19.8284 1.5 19 1.5ZM9.5 2.25C9.91421 2.25 10.25 2.58579 10.25 3C10.25 3.41421 9.91421 3.75 9.5 3.75H8.5C8.08579 3.75 7.75 3.41421 7.75 3C7.75 2.58579 8.08579 2.25 8.5 2.25H9.5ZM13.5 2.25C13.9142 2.25 14.25 2.58579 14.25 3C14.25 3.41421 13.9142 3.75 13.5 3.75H12.5C12.0858 3.75 11.75 3.41421 11.75 3C11.75 2.58579 12.0858 2.25 12.5 2.25H13.5Z\" fill=\"currentColor\"></path>\r\n                                    </svg>\r\n                                    </button>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"tool-panel-footer\">\r\n                            <button class=\"tool cesium-button\" id=\"btn_init\">초기화</button>\r\n                            <button class=\"tool cesium-button\" id=\"btn_close\">종료</button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!-- 마커 패널 -->\r\n                    <div class=\"tool-panel tool-panel--marker\" data-panel=\"marker\">\r\n                        <div class=\"tool-panel-main\">\r\n                            <div class=\"tool-chip-row\">\r\n                                <button class=\"tool cesium-button\" id=\"btn_marker_point\">포인트 마커</button>\r\n                                <button class=\"tool cesium-button\" id=\"btn_marker_line\">라인 마커</button>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"tool-panel-footer\">\r\n                            <button class=\"tool cesium-button\" id=\"btn_marker_init\">초기화</button>\r\n                            <button class=\"tool cesium-button\" id=\"btn_marker_close\">종료</button>\r\n                        </div>\r\n                    </div>\r\n                    <!-- 도구 그룹-->\r\n                    <div class=\"tool-group-bar\">\r\n                        <button class=\"tool-group\" id=\"group-measure\">\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide size-5 lucide-ruler-icon lucide-ruler size-5\"><path d=\"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z\"></path><path d=\"m14.5 12.5 2-2\"></path><path d=\"m11.5 9.5 2-2\"></path><path d=\"m8.5 6.5 2-2\"></path><path d=\"m17.5 15.5 2-2\"></path></svg>\r\n                        </button>\r\n                        <button class=\"tool-group\" id=\"group-marker\">\r\n                            <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" class=\"size-5\"><path d=\"M6.5 18.4999H16.5C17.6046 18.4999 18.5 17.6044 18.5 16.4999C18.5 15.3953 17.6046 14.4999 16.5 14.4999H3.5C2.39543 14.4999 1.5 13.6044 1.5 12.4999C1.5 11.3953 2.39543 10.4999 3.5 10.4999H7.5M17.815 4.52155C18.147 4.18958 18.3335 3.73935 18.3335 3.26988C18.3335 2.80041 18.147 2.35018 17.815 2.01821C17.483 1.68625 17.0328 1.49976 16.5633 1.49976C16.0939 1.49976 15.6436 1.68625 15.3117 2.01821L10.97 6.36155C10.7719 6.55956 10.6269 6.80432 10.5483 7.07321L9.85083 9.46488C9.82992 9.53659 9.82867 9.6126 9.8472 9.68496C9.86574 9.75731 9.90339 9.82336 9.95621 9.87617C10.009 9.92899 10.0751 9.96664 10.1474 9.98518C10.2198 10.0037 10.2958 10.0025 10.3675 9.98155L12.7592 9.28405C13.0281 9.20553 13.2728 9.06051 13.4708 8.86238L17.815 4.52155Z\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg>\r\n                        </button>\r\n                    </div>\r\n                `;\r\n                root.appendChild(toolRoot);\r\n            }\r\n\r\n            const $rootWrap      = $(toolRoot);\r\n            const $groupMeasure  = $rootWrap.find('#group-measure');\r\n            const $groupMarker   = $rootWrap.find('#group-marker');\r\n            const $measurePanel  = $rootWrap.find('.tool-panel--measure');\r\n            const $markerPanel   = $rootWrap.find('.tool-panel--marker');\r\n\r\n            const $tools       = $measurePanel.find('.tool');\r\n            const $btnPoint    = $measurePanel.find('#btn_point');\r\n            const $btnLine     = $measurePanel.find('#btn_line');\r\n            const $btnVert     = $measurePanel.find('#btn_vertical');\r\n            const $btnAreaG    = $measurePanel.find('#btn_ground');\r\n            const $btnAreaS    = $measurePanel.find('#btn_surface');\r\n            const $btnInit     = $measurePanel.find('#btn_init');\r\n            const $btnClose    = $measurePanel.find('#btn_close');\r\n\r\n            // 마커 패널 버튼\r\n            const $btnMarkerClose = $markerPanel.find('#btn_marker_close');\r\n            const $btnMarkerInit = $markerPanel.find('#btn_marker_init');\r\n\r\n            let measureOpen = false;\r\n            let markerOpen  = false;\r\n\r\n            function setActive($btn){ $tools.removeClass('is-active'); $btn.addClass('is-active'); }\r\n            function clearActive(){ $tools.removeClass('is-active'); }\r\n\r\n\r\n            function openMeasurePanel(){\r\n                measureOpen = true;\r\n                markerOpen  = false;\r\n                $measurePanel.addClass('is-open');\r\n                $markerPanel.removeClass('is-open');\r\n                $groupMeasure.addClass('is-active');\r\n                $groupMarker.removeClass('is-active');\r\n            }\r\n\r\n            function openMarkerPanel(){\r\n                markerOpen  = true;\r\n                measureOpen = false;\r\n                $markerPanel.addClass('is-open');\r\n                $measurePanel.removeClass('is-open');\r\n                $groupMarker.addClass('is-active');\r\n                $groupMeasure.removeClass('is-active');\r\n            }\r\n\r\n            function closeAllPanels(){\r\n                measureOpen = false;\r\n                markerOpen  = false;\r\n                $measurePanel.removeClass('is-open');\r\n                $markerPanel.removeClass('is-open');\r\n                $groupMeasure.removeClass('is-active');\r\n                $groupMarker.removeClass('is-active');\r\n                clearActive();\r\n            }\r\n\r\n            function hiddenMountToolBar(){\r\n                $rootWrap.css(\"display\", \"none\");\r\n                closeAllPanels();\r\n            }\r\n            function showMountToolBar(){\r\n                $rootWrap.css(\"display\", \"flex\");\r\n            }\r\n\r\n            $groupMeasure.on('click', () => {\r\n                if (measureOpen) {\r\n                    closeAllPanels();\r\n                    onClose?.();   // 측정 세션 종료\r\n                } else {\r\n                    openMeasurePanel();\r\n                }\r\n            });\r\n\r\n            $groupMarker.on('click', () => {\r\n                alert('해당 서비스 준비중입니다.');\r\n                if (markerOpen) {\r\n                    closeAllPanels();\r\n                } else { // 마커그룹 활성화 -> 측정도구 그룹 초기화\r\n                    openMarkerPanel();\r\n                    onClose?.();   // 측정 세션 종료\r\n                }\r\n            });\r\n\r\n             // --- 측정 패널 기본 동작 -----\r\n\r\n            $btnPoint.on('click', () => {\r\n                setActive($btnPoint);\r\n                onPoint?.();\r\n            });\r\n\r\n            $btnLine.on('click', () => {\r\n                setActive($btnLine);\r\n                onLine?.();\r\n            });\r\n\r\n            $btnVert.on('click', () => {\r\n                setActive($btnVert);\r\n                onVertical?.();\r\n            });\r\n\r\n            $btnAreaG.on('click', () => {\r\n                setActive($btnAreaG);\r\n                onAreaGround?.();\r\n            });\r\n\r\n            $btnAreaS.on('click', () => {\r\n                setActive($btnAreaS);\r\n                onAreaSurface?.();\r\n            });\r\n\r\n            $btnInit.on('click', () => {\r\n                clearActive();\r\n                onInit?.();\r\n            });\r\n\r\n            // 측정종료 + 패널 접기\r\n            $btnClose.on('click', () => {\r\n                clearActive();\r\n                onClose?.();\r\n                closeAllPanels();\r\n            });\r\n\r\n            // 마커 패널 기본 동작\r\n            $btnMarkerInit.on('click', () => {\r\n               // 마커  초기화 기능\r\n            });\r\n\r\n            $btnMarkerClose.on('click', () => {\r\n                closeAllPanels();\r\n                // 마커 기능 종료\r\n            });\r\n\r\n           return {\r\n                showMountToolBar,\r\n                hiddenMountToolBar,\r\n            };\r\n    }\r\n\r\n    return {start, stop, setAreaMode, removeAll, mountToolBar};\r\n}","import {\r\n  HUD_STYLE_ID, HUD_CSS, HUD_HTML,\r\n  INSPECTOR_STYLE_ID, INSPECTOR_CSS, INSPECTOR_HTML,\r\n  COMPASS_SVG\r\n} from \"./UiTemplates.js\";\r\nimport {flyDirectionStayFitModel, flyToTilesetsWithPreset} from \"./CameraMovement.js\";\r\nimport { CameraFreeMode }   from \"./CameraFreeMode.js\";\r\nimport { CameraOrbitMode } from \"./CameraOrbitMode.js\";\r\nimport { Measurement }  from \"./Measurement.js\";\r\n\r\nvar CesiumHandler = (function(){\r\n    //Cesium.Ion.defaultAccessToken = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzYjI4ZjRhOS1lNDdiLTQwYjQtOWUxNC04ZDgxMzA5ZDZkOWYiLCJpZCI6MjQwMDY3LCJpYXQiOjE3NjI5MzU5MTZ9.3Ld8v74q8vXrCIoM0TQGdgqlCUO3pX4UQKmUTSO1Fck\";\r\n        \r\n    let viewer, handler;\r\n    let infoBoxEls = {}, infoBoxEnabled = false;\r\n    let inspectorBoxEl, inspectorLists, properties = {}, \r\n        inspectorBoxEnabled = false, $btnInspectorModelShow, inspectorSelectedModel = null, $btnResetHiddenModels=null;\r\n    const inspectorHiddenModel = new Set();\r\n\r\n    let entityOverlayEl = null;              // HTML 오버레이 엘리먼트\r\n    const entityScratch = new Cesium.Cartesian2(); //preRender에서 재사용할 좌표 버퍼\r\n\r\n    let unionTilesetCenter; // 타일셋 중심 좌표\r\n    let hoverCheckLastTime = 0;\r\n\r\n    let currentModelConfig = { // 기본 모델 정보\r\n        tilesetUrl: null,\r\n        propertyUrls: [],\r\n        info: {\r\n            text: undefined,\r\n            iconSrc: undefined,\r\n            length: 100.0,\r\n        },\r\n    };\r\n    let loaded_3Dtilesets = []; // 현재 scene에 추가된 tilesets\r\n\r\n    // 마우스 hover 시 모델 하이라이트\r\n    const hoverState = {\r\n        model: undefined,\r\n        color: undefined,\r\n        blendMode: undefined,\r\n        blendAmount: undefined,\r\n    };\r\n    \r\n    // 마우스 click 시 모델 하이라이트\r\n    const selectedState = {\r\n        model: undefined,\r\n        color: undefined,\r\n        blendMode: undefined,\r\n        blendAmount: undefined,\r\n    };\r\n\r\n    // cesium 기본 환경\r\n    var DefaultOption = {\r\n        animation: false, //좌측 하단 둥근 위젯 노출여부\r\n        shouldAnimate: false, // 애니메이션과 같이 시간에 따른 변경되는 요소가 있어서 시뮬레이션 시간을 진행하려고 하면\r\n        baseLayerPicker: false, // 지형선택 위젯 노출여부\r\n        fullscreenButton: false, // 전체화면 여부\r\n        vrButton: false, // vr 버튼 노출여부\r\n        geocoder: false, //지오 코더 위젯 노출여부. 주소와 경계표를 찾고 카메라를 그 위치에 보내는 위젯. 지오 코딩은\r\n        homeButton: false, // 홈 버튼 노출여부\r\n        infoBox: false, // 정보 또는 설명을 표시하는 위젯 노출여부 (건물정보 보이고 싶을때)\r\n        sceneModePicker: false, // 2D(평명 지도), 3D(구형 지구) 선택 위젯 노출여부\r\n        timeline: false, //timeline 위젯 노출여부\r\n        navigationHelpButton: false, // 도움말 버튼 노출여부\r\n        trackedEntity: undefined, // 현재 카메라에서 추적중인 Entity 인스턴스를 가져 오거나 설정. 더블클릭시 대상이 화면 가운데로 이동되는것 막기위해 undefined로 설정\r\n        selectionIndicator: false, // 클릭시 클릭위치 표시기 노출여부\r\n        projectionPicker: false, // 직각투영/원근법 투영 선택 위젯 노출여부\r\n        navigationInstructionsInitiallyVisible: false,\r\n        shadows: false, // 기본값 false. 모델과 지형에 태양의 그림자가 드리울지 여부(빛 조정은 이 속성에서 조절 안되고 그림자만 드리워짐)\r\n        maximumRenderTimeChange: Infinity, // requestRenderMode가 true인 경우 시물레이션이 변경됨에 따른 새 프레임 요청 간격(초)을 설정\r\n        sceneMode: Cesium.SceneMode.SCENE3D,\r\n        //useDefaultRenderLoop: false // 자동 렌더링 여부\r\n        // requestRenderMode: true, // scene을 업데이트하지 않으면 새 프레임을 렌더링하지 않도록 설정\r\n        //terrain: Cesium.Terrain.fromWorldTerrain(), //세슘 ion 지원\r\n       // terrain: new Cesium.Terrain(Cesium.CesiumTerrainProvider.fromUrl('./terrain/tr')),\r\n        baseLayer: new Cesium.ImageryLayer(new Cesium.UrlTemplateImageryProvider({\r\n            url: 'https://xdworld.vworld.kr/2d/Satellite/service/{z}/{x}/{y}.jpeg',\r\n            //rl: 'https://xdworld.vworld.kr/2d/Base/service/{z}/{x}/{y}.png',\r\n            subdomains: 'base',\r\n            minimumLevel: 0,\r\n            maximumLevel: 19,\r\n            rectangle: new Cesium.Rectangle(\r\n                Cesium.Math.toRadians(-180.0),\r\n                Cesium.Math.toRadians(-90.0),\r\n                Cesium.Math.toRadians(180.0),\r\n                Cesium.Math.toRadians(90.0))\r\n        }))\r\n    }\r\n\r\n    // 지하시설물 특화 변수\r\n    const underFacilitySpecialEvn = {\r\n        translucencyEnabled: true,\r\n        fadeByDistance: true,\r\n        alpha: 0.5\r\n    };\r\n\r\n    let cameraFree; // 탐색모드\r\n    let cameraOrbitMode; // 회전모드\r\n    let measurement; // 측정도구 기능 제어\r\n    let toolBarApi; // 툴 단위 제어\r\n\r\n    // 현재 기능 정의\r\n    const Mode = {\r\n        NORMAL: 'normal',\r\n        CAMERA_FREE: 'cameraFree',\r\n        ORBIT: 'orbit',\r\n        MEASURE_POINT: 'measure_point',\r\n        MEASURE_DISTANCE: 'measure_distance',\r\n        MEASURE_VERTICAL: 'measure_vertical',\r\n        MEASURE_AREA_GROUND: 'measure_area_ground',\r\n        MEASURE_AREA_SURFACE: 'measure_area_surface',\r\n    };\r\n\r\n    // 초기 기본 모드 정의\r\n    let currentMode = Mode.NORMAL;\r\n\r\n    // 모드 전환\r\n    function setMode(nextMode) {\r\n        if (currentMode === nextMode) return;\r\n\r\n        // 공통 리셋\r\n        measurement.stop();\r\n        cameraFree.disable();\r\n        cameraOrbitMode.disable();\r\n        infoBoxDisable();\r\n        inspectBoxDisable();\r\n        restoreModelState(selectedState);\r\n        if (toolBarApi) toolBarApi.showMountToolBar();\r\n\r\n        switch (nextMode) {\r\n        case Mode.NORMAL:\r\n            infoBoxEnable();\r\n            inspectBoxEnable();\r\n            break;\r\n\r\n        case Mode.CAMERA_FREE:\r\n            if (toolBarApi) toolBarApi.hiddenMountToolBar();\r\n            cameraFree.enable();\r\n            break;\r\n\r\n        case Mode.ORBIT:\r\n            if (toolBarApi) toolBarApi.hiddenMountToolBar();\r\n            cameraOrbitMode.enable(unionTilesetCenter);\r\n            break;\r\n\r\n        case Mode.MEASURE_POINT:\r\n            measurement.start(\"P\");\r\n            break;\r\n\r\n        case Mode.MEASURE_DISTANCE:\r\n            measurement.start(\"D\");\r\n            break;\r\n        \r\n        case Mode.MEASURE_VERTICAL:\r\n            measurement.start(\"V\");\r\n            break;\r\n\r\n        case Mode.MEASURE_AREA_GROUND:\r\n            measurement.setAreaMode(\"ground\");\r\n            measurement.start(\"A\");\r\n            break;\r\n\r\n        case Mode.MEASURE_AREA_SURFACE:\r\n            measurement.setAreaMode(\"surface\");\r\n            measurement.start(\"A\");\r\n            break;\r\n        }\r\n\r\n        currentMode = nextMode;\r\n    }\r\n\r\n    async function init(elementId, { tilesetUrl, propertyUrls, info} = {}) {\r\n        viewer = initCesiumViewer(elementId);\r\n        translucencyUpdate(); // 지하 특화 환경\r\n        createCompas(); // 나침반 생성\r\n\r\n        cameraFree  = CameraFreeMode({ cesiumViewer: viewer });\r\n        cameraOrbitMode = CameraOrbitMode({cesiumViewer: viewer});\r\n        measurement = Measurement({ cesiumViewer: viewer });\r\n\r\n        createInfoBox({container: viewer.container});\r\n        infoBoxEnable();\r\n\r\n        toolBarApi = measurement.mountToolBar({\r\n            container: viewer.container,\r\n            onPoint: () => setMode(Mode.MEASURE_POINT),\r\n            onLine: () => setMode(Mode.MEASURE_DISTANCE),\r\n            onVertical: () => setMode(Mode.MEASURE_VERTICAL),\r\n            onAreaGround: () => setMode(Mode.MEASURE_AREA_GROUND),\r\n            onAreaSurface: () => setMode(Mode.MEASURE_AREA_SURFACE),\r\n            onClose: () => setMode(Mode.NORMAL),\r\n            onInit: () => measurement.removeAll(),\r\n            onMarkerAdd() { console.log('마커 추가 클릭'); },\r\n            onMarkerClear() { console.log('마커 초기화 클릭'); }\r\n        });\r\n\r\n        createInspectBox();\r\n        inspectBoxEnable();\r\n\r\n        currentModelConfig = {\r\n            tilesetUrl: tilesetUrl,\r\n            propertyUrls: propertyUrls,\r\n            info: info,\r\n        };\r\n\r\n        await applyModelConfig(currentModelConfig);\r\n\r\n        setMode(Mode.NORMAL);\r\n        \r\n        return viewer;\r\n    }\r\n\r\n    function initCesiumViewer(elementId){\r\n        if (!window.Cesium) { console.error('CesiumJS not loaded.'); return; }\r\n        var ph = document.querySelector('.viewer-placeholder');\r\n        if (ph) ph.remove();\r\n    \r\n        const cesiumViewer = new Cesium.Viewer(elementId, DefaultOption);\r\n        //cesiumViewer.scene.fxaa = false;\r\n        cesiumViewer.scene.sun.show  = false;   // 태양\r\n        cesiumViewer.scene.moon.show = false;   // 달\r\n        \r\n        cesiumViewer.scene.globe.depthTestAgainstTerrain = true; //지형(terrain)을 기준으로 깊이 테스트(지형 우선)\r\n        cesiumViewer.scene.screenSpaceCameraController.enableCollisionDetection = false; // 카메라 충돌 감지 비활성화(지하를 탐색하기 위함)\r\n        cesiumViewer.scene.globe.translucency.frontFaceAlphaByDistance = new Cesium.NearFarScalar( 400.0, 0.0, 2000.0, 1.0);\r\n       //cesiumViewer.resolutionScale = 0.75; // 해상도 낮추기\r\n        cesiumViewer.scene.globe.baseColor = new Cesium.Color(0, 0, 0, 1);\r\n        $( '.cesium-viewer-bottom' ).remove();\r\n    \r\n        if (!handler) handler = new Cesium.ScreenSpaceEventHandler(cesiumViewer.canvas);\r\n\r\n        handler.setInputAction(function () {\r\n            cesiumViewer.trackedEntity = undefined;\r\n        }, Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n\r\n    \r\n        const controller = cesiumViewer.scene.screenSpaceCameraController;\r\n        // 줌/회전 민감도 낮추기 (기본 zoomFactor≈5, rotateFactor≈1 근처)\r\n        controller.zoomFactor   = 1.5;  // 휠 줌 너무 세면 1.2~2.0 정도로\r\n        controller.rotateFactor = 0.4;  // 회전 속도 줄이기\r\n        // 너무 가까이/멀리 못 가게 범위 제한\r\n        controller.minimumZoomDistance = 2.0;    // 지하 모델 근접 최소 거리\r\n        controller.maximumZoomDistance = 300.0;  // 이 이상은 멀어지지 않게\r\n\r\n        // 카메라 관성(밀려나가는 느낌) 줄이기\r\n        const cam = cesiumViewer.camera;\r\n        cam.inertiaSpin      = 0.2;  // 회전 관성 (기본 0.9 근처)\r\n        cam.inertiaTranslate = 0.4;  // 이동 관성\r\n        cam.inertiaZoom      = 0.4;  // 줌 관성\r\n\r\n        // 모델 중앙 라벨 오버레이 위치 유지하기 위함\r\n        cesiumViewer.scene.preRender.addEventListener(function () {\r\n            if (!entityOverlayEl || entityOverlayEl.style.display === 'none') return;\r\n\r\n            const entity = viewer.entities.getById('entity_icon');\r\n            if (!entity) {\r\n                entityOverlayEl.style.display = 'none';\r\n                return;\r\n            }\r\n\r\n            const time = cesiumViewer.clock.currentTime;\r\n            const pos  = Cesium.Property.getValueOrUndefined(entity.position, time);\r\n            if (!pos) {\r\n                entityOverlayEl.style.display = 'none';\r\n                return;\r\n            }\r\n\r\n            const canvasPos = cesiumViewer.scene.cartesianToCanvasCoordinates(pos, entityScratch);\r\n            if (!Cesium.defined(canvasPos)) {\r\n                entityOverlayEl.style.display = 'none';\r\n                return;\r\n            }\r\n\r\n            entityOverlayEl.style.left = `${canvasPos.x}px`;\r\n            entityOverlayEl.style.top  = `${canvasPos.y}px`;\r\n        });\r\n\r\n        return cesiumViewer;\r\n    }\r\n\r\n    async function applyModelConfig(config={}) {\r\n        const tasks = [];\r\n\r\n        // 3D Tileset 로딩\r\n        if(config.tilesetUrl) {\r\n            const tilesets = await renderingAllTileset({ url: config.tilesetUrl });\r\n\r\n            // 해당 위치로 카메라 이동\r\n            unionTilesetCenter = unionAllTilesetsBoundingSphereCompute(tilesets);\r\n            flyToTilesetsWithPreset(viewer, unionTilesetCenter, \"top\", 0.8, 600);\r\n\r\n            tasks.push(tilesets);\r\n        }\r\n\r\n        // 모델 정보 라벨 업데이트\r\n        if(config.info){\r\n            removeModelInfoLabel();\r\n            setModelInfoLabel(config.info);\r\n        }\r\n\r\n        // propertyUrls 업데이트\r\n        if (config.propertyUrls && config.propertyUrls.length) tasks.push(loadTilesetInfo({ url: config.propertyUrls }));\r\n        \r\n        // tasks 작업이 모두 끝나길 대기\r\n        // 하나라도 실패해도 전체 실패로 간주\r\n        return Promise.all(tasks);\r\n    }\r\n\r\n    async function updateModelConfig(config = {}) {\r\n        // 현재 currentConfig 업데이트\r\n        // 사용자가 리스트에서 어떤 모델을 선택 후 다시 적용\r\n        currentModelConfig  = {\r\n            ...currentModelConfig ,\r\n            ...config,\r\n            info: {\r\n            ...currentModelConfig .info,\r\n            ...(config.info || {}),\r\n            },\r\n        };\r\n        return applyModelConfig(currentModelConfig );\r\n    }\r\n\r\n    async function renderingAllTileset({url}) {\r\n\r\n        if(loaded_3Dtilesets.length > 0){\r\n            loaded_3Dtilesets.forEach(ts=>{\r\n                viewer.scene.primitives.remove(ts);\r\n            })\r\n        }\r\n        loaded_3Dtilesets = [];\r\n\r\n        if (!url) {\r\n            console.warn(\"url이 존재하지 않습니다.\");\r\n            return [];\r\n        }\r\n\r\n        const tilesets = await loadAllTilesets(url);\r\n        loaded_3Dtilesets = tilesets;\r\n\r\n        return tilesets;\r\n    }\r\n\r\n    async function loadTilesetInfo({url}) {\r\n        let totalLoaded = 0;\r\n        for (const jsonUrl of url) {\r\n            try {\r\n                const response = await fetch(jsonUrl);\r\n\r\n                if (!response.ok) {\r\n                    console.warn(`JSON 파일 로드 실패 (${response.status}): ${jsonUrl}`);\r\n                    continue;\r\n                }\r\n                const propertiesData = await response.json();\r\n                properties = { ...properties, ...propertiesData };\r\n                totalLoaded += Object.keys(propertiesData).length;\r\n\r\n            } catch (error) {\r\n                console.error(`JSON 로드 실패: ${jsonUrl}`, error);\r\n            }\r\n        }\r\n        console.log(`${totalLoaded}개 객체 로드 완료`);\r\n        return properties;\r\n    }\r\n\r\n    function createRoundBadgeCanvas({\r\n        text,\r\n        iconSrc,            // 아이콘 경로 (png, svg 모두 가능)\r\n        size = 40,         // 원의 지름(px)\r\n        padding = 4,       // 바깥 여백\r\n        bgColor = 'rgba(11, 15, 20, 0.96)',\r\n        borderColor = 'rgba(255, 233, 33, 1)',\r\n        shadow = true,\r\n        pixelScale = 1.5\r\n    } = {}) {\r\n        const canvas = document.createElement('canvas');\r\n        const ctx = canvas.getContext('2d');\r\n        const dpr = (window.devicePixelRatio || 1) * pixelScale;\r\n\r\n        const total = size + padding * 2; // 전체 캔버스 한 변\r\n        canvas.width  = total * dpr;\r\n        canvas.height = total * dpr;\r\n        ctx.scale(dpr, dpr);\r\n\r\n        const cx = total / 2;\r\n        const cy = total / 2;\r\n        const r  = size / 2;\r\n\r\n        // 배경 원 + 테두리 + 그림자\r\n        ctx.save();\r\n        if (shadow) {\r\n            ctx.shadowColor   = 'rgba(0,0,0,0.6)';\r\n            ctx.shadowBlur    = 8;\r\n            ctx.shadowOffsetY = 2;\r\n        }\r\n        ctx.beginPath();\r\n        ctx.arc(cx, cy, r, 0, Math.PI * 2);\r\n        ctx.closePath();\r\n        ctx.fillStyle   = bgColor;\r\n        ctx.strokeStyle = borderColor;\r\n        ctx.lineWidth   = 2;\r\n        ctx.fill();\r\n        ctx.stroke();\r\n        ctx.restore();\r\n\r\n        if (!iconSrc) {\r\n            ctx.save();\r\n            ctx.font         = '600 8px sans-serif';\r\n            ctx.textAlign    = 'center';\r\n            ctx.textBaseline = 'middle';\r\n            ctx.fillStyle    = '#ffffff';\r\n\r\n            ctx.strokeText(text, cx, cy);\r\n            ctx.fillText(text, cx, cy);\r\n            ctx.restore();\r\n\r\n            return Promise.resolve(canvas);\r\n        }\r\n\r\n        // 아이콘 로드해서 원 안에 그리기 (PNG든 SVG든 동일)\r\n        return new Promise((resolve, reject) => {\r\n            const img = new Image();\r\n            img.onload = () => {\r\n                // 아이콘이 원 안에 살짝 여유 있게 들어가도록\r\n                const iconR = r * 0.9; // 원보다 조금 작게\r\n                const iconSize = iconR * 2;\r\n                const x = cx - iconSize / 2;\r\n                const y = cy - iconSize / 2;\r\n\r\n                // 아이콘도 원형으로 클리핑 (모서리 잘림 방지)\r\n                ctx.save();\r\n                ctx.beginPath();\r\n                ctx.arc(cx, cy, iconR, 0, Math.PI * 2);\r\n                ctx.closePath();\r\n                ctx.clip();\r\n                ctx.drawImage(img, x, y, iconSize, iconSize);\r\n                ctx.restore();\r\n\r\n                resolve(canvas);\r\n            };\r\n            img.onerror = reject;\r\n            img.src = iconSrc;\r\n        });\r\n    }\r\n\r\n    //  BoundingSphere 기준 수직라인 + 라벨 생성\r\n    function setModelInfoLabel(options = {}) {\r\n        if (!unionTilesetCenter || !viewer) return;\r\n\r\n        const text        = options.text   || 'Untitled';\r\n        const iconSrc     = options.iconSrc || undefined;\r\n        const lineLength  = options.length || 100.0;\r\n        const ellipsoid   = viewer.scene.globe.ellipsoid;\r\n\r\n        // BoundingSphere 중심 -> 경위도/고도\r\n        const centerCartesian  = unionTilesetCenter.center;\r\n        const centerCarto      = ellipsoid.cartesianToCartographic(centerCartesian);\r\n\r\n        const baseHeight       = centerCarto.height;            // 필요시 0으로 고정해도 됨\r\n        const cylinderMidH     = baseHeight + lineLength / 2.0; // 원통 중심 높이\r\n        const labelHeight      = baseHeight + lineLength;       // 라벨 높이\r\n\r\n        // 원통(수직 라인) 중심 위치\r\n        const cylinderPos = Cesium.Cartesian3.fromRadians(\r\n            centerCarto.longitude,\r\n            centerCarto.latitude,\r\n            cylinderMidH\r\n        );\r\n\r\n        // 이미지 위치 (라인 최상단)\r\n        const labelPos = Cesium.Cartesian3.fromRadians(\r\n            centerCarto.longitude,\r\n            centerCarto.latitude,\r\n            labelHeight\r\n        );\r\n\r\n        // 수직 원통 라인\r\n        viewer.entities.add({\r\n            id: 'entity_line',\r\n            position: cylinderPos,\r\n            orientation: Cesium.Transforms.headingPitchRollQuaternion(\r\n                cylinderPos,\r\n                new Cesium.HeadingPitchRoll(0, 0, 0) // ENU 기준 위쪽\r\n            ),\r\n            cylinder: {\r\n                length: lineLength,\r\n                topRadius: 0.2,      // 반경 0.5m\r\n                bottomRadius: 0.2,\r\n                material: Cesium.Color.WHITE.withAlpha(0.9),\r\n                outline: false,\r\n            \r\n                distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0.0, 8000.0)\r\n            }\r\n        });\r\n\r\n        // 지하시설 이미지 썸네일 \r\n        createRoundBadgeCanvas({\r\n            text : text,\r\n            iconSrc: iconSrc,\r\n            size: 50,\r\n            padding: 5,\r\n            pixelScale: 1.5 \r\n        }).then((badgeCanvas) => {\r\n            viewer.entities.add({\r\n                id : 'entity_icon',\r\n                position: labelPos,\r\n                properties: {\r\n                    title: `${text}`,\r\n                    desc:  '이 영역은 지하시설물 3D 모델의 중심 지점을 나타냅니다.'\r\n                },\r\n                billboard: {\r\n                    image: badgeCanvas,\r\n                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,\r\n                    pixelOffset: new Cesium.Cartesian2(0, 6),\r\n                    scale: 1.0,\r\n                    distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0.0, 8000.0)\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    // 모델 정보 라벨 제거\r\n    function removeModelInfoLabel() {\r\n        const lineEntity  = viewer.entities.getById(\"entity_line\");\r\n        const iconEntity = viewer.entities.getById(\"entity_icon\");\r\n        if (lineEntity)  viewer.entities.remove(lineEntity);\r\n        if (iconEntity) viewer.entities.remove(iconEntity);\r\n    }\r\n\r\n    function updateInspectorToggleButton(model) {\r\n        inspectorSelectedModel = model;\r\n\r\n        if (!$btnInspectorModelShow) return;\r\n        \r\n        if (model) {\r\n            $btnInspectorModelShow.removeAttr('disabled');\r\n            const isVisible = (model.show !== false);\r\n            $btnInspectorModelShow.text(`${isVisible ? '숨김' : '보기'}`);\r\n        } else {\r\n            $btnInspectorModelShow.attr('disabled');\r\n            $btnInspectorModelShow.textContent = '숨김';\r\n        }\r\n    }\r\n\r\n    function injectStyleOnce(id, cssText) {\r\n        if (!document.getElementById(id)) {\r\n            $('<style>', { id, text: cssText }).appendTo('head');\r\n        }\r\n    }\r\n\r\n    function createInspectBox(){\r\n        const $viewerContainer = $(viewer.container);\r\n        const $parent = $viewerContainer.parent();\r\n\r\n        if (!$viewerContainer.length) return;\r\n        if (!$parent.length || $parent.hasClass('shell')) return;\r\n\r\n        injectStyleOnce(INSPECTOR_STYLE_ID, INSPECTOR_CSS);\r\n\r\n        const $shell = $(`\r\n            <div class=\"shell\" id=\"shell\">\r\n            <main></main>\r\n            </div>\r\n        `);\r\n         $viewerContainer.before($shell);\r\n\r\n        const $main = $shell.find('main');\r\n        $main.append($viewerContainer);\r\n\r\n        const $inspectorBox = $(INSPECTOR_HTML);\r\n        $shell.append($inspectorBox);\r\n\r\n        inspectorBoxEl = $inspectorBox[0];\r\n        inspectorLists = document.getElementById('inspector_list_container');\r\n        const $btnInspectorClose = $inspectorBox.find('#btnInspectorClose');\r\n        $btnInspectorModelShow = $inspectorBox.find('#btnInspectorModelShow');\r\n\r\n        $btnInspectorModelShow.on('click', function(){\r\n            const model = inspectorSelectedModel;\r\n            if (!model) return;\r\n\r\n            const isVisible  = (model.show !== false); // 현재 모델이 보이는 상태인지\r\n            model.show = !isVisible ;\r\n            isVisible ? inspectorHiddenModel.add(model) : inspectorHiddenModel.delete(model);\r\n            $btnInspectorModelShow.text(`${isVisible  ? '보기' : '숨김'}`);\r\n            updateHiddenModelsResetButton();\r\n        });\r\n\r\n        $btnInspectorClose.on('click', function () {\r\n            const isHidden = $inspectorBox.attr('hidden') !== undefined;\r\n\r\n            if (isHidden) {\r\n                $inspectorBox.removeAttr('hidden');\r\n                $shell.removeClass('no-inspector');\r\n                $(this).text('닫기');\r\n            } else {\r\n                $inspectorBox.attr('hidden', '');\r\n                $shell.addClass('no-inspector');\r\n                $(this).text('열기');\r\n            }\r\n        });\r\n\r\n        function updateHiddenModelsResetButton() {\r\n            const hasHidden = inspectorHiddenModel.size > 0;\r\n\r\n            if (!hasHidden) {\r\n                // 숨긴 모델이 하나도 없으면 버튼 숨김\r\n                if ($btnResetHiddenModels) {\r\n                    $btnResetHiddenModels.hide();\r\n                }\r\n                return;\r\n            }\r\n\r\n            // 숨긴 모델이 하나 이상\r\n            if (!$btnResetHiddenModels) {\r\n                // 처음 한 번만 생성\r\n                const $root = $(viewer.container); \r\n\r\n                $btnResetHiddenModels = $(`\r\n                    <button\r\n                        id=\"btn-reset-hidden-models\"\r\n                        type=\"button\"\r\n                        class=\"cesium-button\"\r\n                        style=\"\r\n                            position:absolute;\r\n                            top:8px;\r\n                            left:50%;\r\n                            transform:translateX(-50%);\r\n                            z-index:2000;\r\n                            padding:4px 12px;\r\n                            font-size:11px;\r\n                            background: #2f80ff;\r\n                            text-shadow: 1px 1px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;\">\r\n                        숨김 모델 초기화\r\n                    </button>\r\n                `);\r\n\r\n                // 리셋 버튼 클릭 시 숨긴 모델 전부 다시 보이기\r\n                $btnResetHiddenModels.on('click', () => {\r\n                    inspectorHiddenModel.forEach(model => {\r\n                        if (model && !model.isDestroyed?.()) {\r\n                            model.show = true;\r\n                        }\r\n                    });\r\n                    inspectorHiddenModel.clear();\r\n\r\n                    // 선택 모델 버튼 텍스트도 복구\r\n                    if (inspectorSelectedModel && !inspectorSelectedModel.isDestroyed?.()) {\r\n                        inspectorSelectedModel.show = true;\r\n                        if ($btnInspectorModelShow) {\r\n                            $btnInspectorModelShow.text('숨김');\r\n                        }\r\n                    }\r\n\r\n                    // 자기 자신 숨기기\r\n                    $btnResetHiddenModels.hide();\r\n                });\r\n\r\n                $root.append($btnResetHiddenModels);\r\n            }\r\n\r\n            // Set에 뭔가 들어와 있으면 항상 보이도록\r\n            $btnResetHiddenModels.show();\r\n        }\r\n    }\r\n\r\n    function inspectBoxEnable(){\r\n            if (inspectorBoxEnabled) return;\r\n            inspectorBoxEnabled = true;\r\n            if (handler) handler.setInputAction(onMouseLeftClick, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n            \r\n    }\r\n\r\n    function inspectBoxDisable(){\r\n            inspectorBoxEnabled = false;\r\n            if (handler) handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n            setInspectorBox(false);\r\n    }\r\n    \r\n    function setInspectorBox(isOpen) {\r\n        if (!inspectorBoxEl) return;\r\n\r\n        const $inspector    = $(inspectorBoxEl);\r\n        const $shell        = $inspector.closest('.shell');\r\n        const $btnInspectorClose = $inspector.find('#btnInspectorClose');\r\n\r\n        if (isOpen) {\r\n            $inspector.removeAttr('hidden');\r\n            $shell.removeClass('no-inspector');\r\n            $btnInspectorClose.text('닫기');\r\n            inspectorBoxEnabled = true;\r\n        } else {\r\n            $inspector.attr('hidden', '');\r\n            $shell.addClass('no-inspector');\r\n            $btnInspectorClose.text('열기');\r\n            inspectorBoxEnabled = false;\r\n        }\r\n    }\r\n\r\n    function createCompas(){\r\n        const $wrap = createElement();\r\n    const $svg = $wrap.find('svg');\r\n\r\n    // 회전 중심을 정중앙으로\r\n    $svg.css({\r\n        width: '100%',\r\n        height: '100%',\r\n        'transform-origin': '50% 50%',\r\n        'will-change': 'transform'\r\n    });\r\n\r\n    // 카메라 heading에 맞춰 회전\r\n    viewer.scene.postRender.addEventListener(() => {\r\n        const heading = viewer.camera.heading; // 라디안\r\n        // 일반적으로 나침반은 카메라 반대방향으로 돌려서 \"북\"이 항상 위로 보이게 함\r\n        $svg.css('transform', `rotateZ(${-heading}rad)`);\r\n    });\r\n\r\n    // 클릭 이벤트 (지금은 비활성)\r\n    $wrap.on('click', () => {\r\n        return;\r\n        // if (!Cesium.defined(iconEntity)) return;\r\n        // viewer.zoomTo(opt.iconEntity, -90, 1000);\r\n    });\r\n\r\n    const $renderContents = $(viewer.container);\r\n    $renderContents.append($wrap);\r\n\r\n    function createElement() {\r\n        const $div = $(`\r\n            <div class=\"hud-compass\" \r\n                 style=\"position:absolute; top:10px; right:10px; z-index:10000; width:64px; height:64px; pointer-events:auto;\">\r\n                ${COMPASS_SVG}\r\n            </div>\r\n        `);\r\n        return $div;\r\n    }\r\n    }\r\n\r\n    function translucencyUpdate() {\r\n        viewer.scene.globe.translucency.enabled = underFacilitySpecialEvn.translucencyEnabled;\r\n\r\n        let alpha = Number(underFacilitySpecialEvn.alpha);\r\n        alpha = !isNaN(alpha) ? alpha : 1.0;\r\n        alpha = Cesium.Math.clamp(alpha, 0.0, 1.0);\r\n\r\n        viewer.scene.globe.translucency.frontFaceAlphaByDistance.nearValue = alpha;\r\n        viewer.scene.globe.translucency.frontFaceAlphaByDistance.farValue = underFacilitySpecialEvn.fadeByDistance ? 1.0 : alpha;\r\n    }\r\n\r\n    async function createTileset(url) {\r\n        if (!url) {\r\n            console.warn(\"url이 유효하지 않습니다.\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const tileset = await Cesium.Cesium3DTileset.fromUrl(url, {\r\n                shadows: Cesium.ShadowMode.ENABLED,\r\n                // skipLevelOfDetail: true,\r\n                // baseScreenSpaceError: 2048,\r\n                // skipScreenSpaceErrorFactor: 32,\r\n                // skipLevels: 1,\r\n                // immediatelyLoadDesiredLevelOfDetail: false,\r\n                // loadSiblings: false,\r\n                // dynamicScreenSpaceError: true,\r\n                // dynamicScreenSpaceErrorDensity: 2.0e-4,\r\n                // dynamicScreenSpaceErrorFactor: 24.0,\r\n                // dynamicScreenSpaceErrorHeightFalloff: 0.25\r\n\r\n                maximumScreenSpaceError: 20,      // default 16보다 올려서 성능상향\r\n                skipLevelOfDetail: true,\r\n                baseScreenSpaceError: 1024,\r\n                skipScreenSpaceErrorFactor: 16,\r\n                skipLevels: 1,\r\n                immediatelyLoadDesiredLevelOfDetail: false,\r\n                loadSiblings: false,\r\n\r\n                dynamicScreenSpaceError: true,\r\n                dynamicScreenSpaceErrorDensity: 2.0e-4,\r\n                dynamicScreenSpaceErrorFactor: 24.0,\r\n                dynamicScreenSpaceErrorHeightFalloff: 0.25,\r\n                cullWithChildrenBounds: true,\r\n                cullRequestsWhileMoving: true\r\n            \r\n            });\r\n            viewer.scene.primitives.add(tileset);\r\n\r\n            /*\r\n            // 타일 로드되는 프로그래스바\r\n            tileset.loadProgress.addEventListener(function(numberOfPendingRequests, numberOfTilesProcessing) {\r\n                if ((numberOfPendingRequests === 0) && (numberOfTilesProcessing === 0)) {\r\n                    console.log('Stopped loading');\r\n                    return;\r\n                }\r\n\r\n                console.log(`Loading: requests: ${numberOfPendingRequests}, processing: ${numberOfTilesProcessing}`);\r\n            });\r\n            */\r\n            return tileset;\r\n        } catch (error) {\r\n            console.error(`Tileset 생성 중 오류 발생: ${error}`);\r\n            return undefined;\r\n        }\r\n    }\r\n\r\n    async function loadAllTilesets(rootTilesetUrl) {\r\n        try {\r\n            const url = await Promise.resolve(rootTilesetUrl);\r\n            const response = await fetch(url);\r\n            if (!response.ok) {\r\n                console.error(`Root tileset 로드 실패: ${response.status}`);\r\n                return [];\r\n            }\r\n            const rootData = await response.json();\r\n            const children = rootData.root?.children || [];\r\n            console.log(`타입별 Tileset: ${children.length}개`);\r\n\r\n            const loadedTilesets = [];\r\n            const baseUrl = url.substring(0, url.lastIndexOf('/') + 1);\r\n\r\n            for (const child of children) {\r\n                if (child.content && child.content.uri) {\r\n                    const childUrl = baseUrl + child.content.uri;\r\n                    const tilesetName = child.content.uri.replace('_tileset.json', '').replace('/tileset.json', '');\r\n                    const tileset = await createTileset(childUrl, tilesetName);\r\n                    if (tileset) {\r\n                        loadedTilesets.push(tileset);\r\n                    }\r\n                }\r\n            }\r\n            console.log(`총 ${loadedTilesets.length}개 Tileset 로드 완료`);\r\n            return loadedTilesets;\r\n\r\n        } catch (error) {\r\n            console.error(`루트 tileset 처리 실패:`, error);\r\n            return [];\r\n        }\r\n    }\r\n\r\n    function unionAllTilesetsBoundingSphereCompute(loadedTilesets){\r\n        const paddingScale = 1.2;\r\n            const ready = loadedTilesets.filter(t => t && t.boundingSphere);\r\n            if (ready.length === 0) return;\r\n            // union 구체 계산\r\n            let union = ready[0].boundingSphere;\r\n            for (let i = 1; i < ready.length; i++) {\r\n                union = Cesium.BoundingSphere.union(union, ready[i].boundingSphere);\r\n            }\r\n            union = new Cesium.BoundingSphere(union.center, union.radius * paddingScale);\r\n        return union;\r\n    }\r\n\r\n    function createInfoBox({container}) {\r\n\r\n        injectStyleOnce(HUD_STYLE_ID, HUD_CSS);\r\n\r\n        const $root = $(HUD_HTML);\r\n        const infoBoxRootEl = $root[0];\r\n        container.appendChild($root[0]);\r\n\r\n        infoBoxEls.lon   = infoBoxRootEl.querySelector('#hud-lon');\r\n        infoBoxEls.lat   = infoBoxRootEl.querySelector('#hud-lat');\r\n        infoBoxEls.hgt   = infoBoxRootEl.querySelector('#hud-height');\r\n        infoBoxEls.zoom  = infoBoxRootEl.querySelector('#hud-zoom');\r\n        \r\n        const $cameraFree  = $('#btn_cameraFreeMode');\r\n        const $modeWrap    = $(infoBoxRootEl).find('.hud-mode-wrap');\r\n        const $hcg         = $modeWrap.find('#hud-camera-group');\r\n        const $hcm         = $modeWrap.find('.hud-cg-menu');\r\n\r\n        const $transHeader = $root.find('.hud-trans-header');\r\n        const $transBody   = $root.find('.hud-trans-body');\r\n        const $toggleIcon  = $root.find('.hud-trans-toggle');\r\n        const $onlyModel = $(infoBoxRootEl).find('#hud-only-model');\r\n        const $performance = $(infoBoxRootEl).find('#hud-performance');\r\n\r\n        const $hudToggle = $root.find('#hud-info-toggle');\r\n        const $orbitBtn   = $root.find('#btn_orbitMode');\r\n\r\n        // 초기 상태: 펼쳐져 있고 아이콘은 \"−\"\r\n        $transBody.show();\r\n        $toggleIcon.text('−');\r\n        \r\n\r\n        $hudToggle.on('click', (e) => {\r\n            e.stopPropagation();\r\n            $root.toggleClass('is-open');\r\n        });\r\n\r\n        $transHeader.on('click', function (e) {\r\n            // 체크박스 자체를 클릭한 경우에는 접기/펼치기 동작을 막음\r\n            if ($(e.target).is('#hud-translucency'))  return;\r\n            const isOpen = $transBody.is(':visible');\r\n            if (isOpen) {\r\n                $transBody.slideUp(120);\r\n                $toggleIcon.text('+');\r\n            } else {\r\n                $transBody.slideDown(120);\r\n                $toggleIcon.text('−');\r\n            }\r\n        });\r\n\r\n        //모델만 보기\r\n        $onlyModel.on('change', function () {\r\n            const on = $(this).is(':checked');\r\n            const scene = viewer.scene;\r\n\r\n            // 지구(타원체 + 지형) 숨기기\r\n            scene.globe.show = !on;\r\n\r\n            // 대기/하늘 제거\r\n            if (scene.skyAtmosphere) scene.skyAtmosphere.show = !on;\r\n            scene.skyBox = on ? null : scene.skyBox;\r\n\r\n            // 배경색(모델만 보이게)\r\n            scene.backgroundColor = on ? Cesium.Color.BLACK : Cesium.Color.fromCssColorString('#0b0f14');\r\n        });\r\n        \r\n        // fps 변경사항 감지\r\n        $performance.on('change', function(){\r\n            const on = $(this).is(':checked');\r\n            // 60이상 화면 양호 / 30~60 보통 / 30이하 끊김\r\n            on ? viewer.scene.debugShowFramesPerSecond = true : viewer.scene.debugShowFramesPerSecond = false;\r\n        });\r\n\r\n        // 모델 환경 투명도 조절\r\n        bindTranslucencyControls();\r\n\r\n        // 카메라 그룹 버튼 클릭 시 열고/닫기\r\n        $hcg.on('click', function (e) {\r\n            e.stopPropagation();\r\n            $modeWrap.toggleClass('is-open');\r\n        });\r\n\r\n        // 카메라 그룹 안에서 항목 클릭 처리 (수직, 좌측45도, 우측45도)\r\n        $hcm.on('click', 'button', function (e) {\r\n            flyToTilesetsWithPreset(viewer, unionTilesetCenter, this.dataset.view, 0.8, 600);\r\n        });\r\n\r\n        // 탐색모드 버튼\r\n        $cameraFree.on('click', () => {\r\n            //alert('해당 서비스 준비중입니다.');\r\n           // return;\r\n\r\n           // 이미 탐색모드면 NORMAL로, 아니면 CAMERA_FREE로\r\n            const next = (currentMode === Mode.CAMERA_FREE)\r\n                ? Mode.NORMAL\r\n                : Mode.CAMERA_FREE;\r\n            setMode(next);\r\n             syncModeButtons();\r\n        });\r\n\r\n        // 회전모드 버튼\r\n        $orbitBtn.on('click', () => {\r\n            // ORBIT 켜려는데 center 없으면 경고\r\n            if (currentMode !== Mode.ORBIT && !unionTilesetCenter) {\r\n                alert('타일셋이 아직 로드되지 않았습니다.');\r\n                return;\r\n            }\r\n            const next = (currentMode === Mode.ORBIT)\r\n                ? Mode.NORMAL\r\n                : Mode.ORBIT;\r\n            setMode(next);\r\n            syncModeButtons();\r\n        });\r\n\r\n        // 모드 변경 시 버튼 상태 동기화\r\n        const syncModeButtons = () => {\r\n            const isFree  = currentMode === Mode.CAMERA_FREE;\r\n            const isOrbit = currentMode === Mode.ORBIT;\r\n\r\n            $cameraFree.toggleClass('is-active', isFree);\r\n            $orbitBtn.toggleClass('is-active', isOrbit);\r\n        };\r\n\r\n        function bindTranslucencyControls() {\r\n            const $chkTrans    = $root.find('#hud-translucency');\r\n            const $chkFade     = $root.find('#hud-fadeByDistance');\r\n            const $alphaRange  = $root.find('#hud-alpha-range');\r\n            const $alphaValue  = $root.find('#hud-alpha-value');\r\n\r\n            const setFadeAlphaEnabled = (enabled) => {\r\n                $chkFade.prop('disabled', !enabled);\r\n                $alphaRange.prop('disabled', !enabled);\r\n\r\n                const opacity = enabled ? 1 : 0.4;\r\n                $chkFade.closest('label').css('opacity', opacity);\r\n                $alphaRange.closest('div').css('opacity', opacity); // Alpha 행 전체 흐리게\r\n            };\r\n\r\n            // 초기값 동기화\r\n            $chkTrans.prop('checked', !!underFacilitySpecialEvn.translucencyEnabled);\r\n            $chkFade.prop('checked', !!underFacilitySpecialEvn.fadeByDistance);\r\n            $alphaRange.val(underFacilitySpecialEvn.alpha);\r\n            $alphaValue.text(underFacilitySpecialEvn.alpha.toFixed(1));\r\n\r\n            setFadeAlphaEnabled(!!underFacilitySpecialEvn.translucencyEnabled);\r\n\r\n            // alpha 값 적용 공통 함수\r\n            const applyAlpha = (val) => {\r\n                let alpha = parseFloat(val);\r\n                if (isNaN(alpha)) alpha = 1.0;\r\n                alpha = Cesium.Math.clamp(alpha, 0.0, 1.0);\r\n\r\n                underFacilitySpecialEvn.alpha = alpha;\r\n                $alphaRange.val(alpha);\r\n                $alphaValue.text(alpha.toFixed(1)); \r\n\r\n                translucencyUpdate();\r\n            };\r\n\r\n            // Translucency on/off\r\n            $chkTrans.on('change', () => {\r\n                const enabled = $chkTrans.is(':checked');\r\n                underFacilitySpecialEvn.translucencyEnabled = enabled;\r\n                setFadeAlphaEnabled(enabled);\r\n                translucencyUpdate();\r\n            });\r\n\r\n            // Fade by distance on/off\r\n            $chkFade.on('change', () => {\r\n                underFacilitySpecialEvn.fadeByDistance = $chkFade.is(':checked');\r\n                translucencyUpdate();\r\n            });\r\n\r\n            // Alpha 슬라이더\r\n            $alphaRange.on('input change', function () {\r\n                applyAlpha(this.value);\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    function infoBoxEnable() {\r\n        if (infoBoxEnabled) return;\r\n        infoBoxEnabled = true;\r\n        if (handler) handler.setInputAction(onMouseMove, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n    }\r\n\r\n    function infoBoxDisable() {\r\n        infoBoxEnabled = false;\r\n        if (handler) handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n    }\r\n\r\n    function applyModelHighlight(state, model, color, blendAmount) {\r\n        if (!model) return;\r\n\r\n        state.model       = model;\r\n        state.color       = model.color ? model.color.clone() : Cesium.Color.WHITE.clone();\r\n        state.blendMode   = model.colorBlendMode;\r\n        state.blendAmount = model.colorBlendAmount;\r\n\r\n        model.color = color;\r\n        model.colorBlendMode   = Cesium.ColorBlendMode.MIX;\r\n        model.colorBlendAmount = blendAmount;\r\n    }\r\n\r\n    function restoreModelState(state) {\r\n        if (!state.model) return;\r\n\r\n        if (state.color) {\r\n            state.model.color = state.color;\r\n        }\r\n        if (Cesium.defined(state.blendMode)) {\r\n            state.model.colorBlendMode = state.blendMode;\r\n        }\r\n        if (typeof state.blendAmount === 'number') {\r\n            state.model.colorBlendAmount = state.blendAmount;\r\n        }\r\n\r\n        state.model       = undefined;\r\n        state.color       = undefined;\r\n        state.blendMode   = undefined;\r\n        state.blendAmount = undefined;\r\n    }\r\n\r\n    function updateHoverHighlight(pickedModel){\r\n        if(!pickedModel) restoreModelState(hoverState);\r\n        //이전과 동일한 모델이거나, 선택된 모델이면 → 아무 것도 하지 않음\r\n        if (pickedModel === hoverState.model || pickedModel === selectedState.model) {\r\n            return;\r\n        }\r\n\r\n        // 이전 hover 복구 (선택된 모델은 복구 대상에서 제외)\r\n        if (hoverState.model && hoverState.model !== selectedState.model) {\r\n            restoreModelState(hoverState);\r\n        }\r\n\r\n        // 새 모델에 hover 적용\r\n        if (pickedModel && pickedModel !== selectedState.model) {\r\n            applyModelHighlight(\r\n                hoverState,\r\n                pickedModel,\r\n                Cesium.Color.YELLOW.withAlpha(0.2), // hover 시 연한 노란색 반투명\r\n                0.25\r\n            );\r\n        }\r\n    }\r\n\r\n    function showEntityOverlay(entity) {\r\n        function createEntityOverlay() {\r\n            if (entityOverlayEl) return entityOverlayEl;\r\n\r\n            const root = viewer.container;\r\n            const entityOverlay = document.createElement('div');\r\n            entityOverlay.id = 'entity-overlay';\r\n            entityOverlay.style.cssText = `\r\n                position:absolute;\r\n                z-index:3000;\r\n                transform:translate(12px, -50%); /* 아이콘 기준 오른쪽 옆에 표시 */\r\n                pointer-events:auto;\r\n                display:none;\r\n            `;\r\n            entityOverlay.innerHTML = `\r\n                <div style=\"\r\n                    min-width:180px;\r\n                    max-width:260px;\r\n                    padding:8px 10px;\r\n                    border-radius:10px;\r\n                    background:rgba(11,15,20,0.95);\r\n                    border:1px solid rgba(255,255,255,0.12);\r\n                    box-shadow:0 10px 24px rgba(0,0,0,0.6);\r\n                    color:#e6edf3;\r\n                    font-size:11px;\">\r\n                    <div style=\"display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;\">\r\n                        <div style=\"font-weight:600; font-size:12px;\" id=\"entity-title\"></div>\r\n                    </div>\r\n                    <div id=\"entity-body\" style=\"font-size:11px; line-height:1.5;\"></div>\r\n                </div>\r\n            `;\r\n            root.appendChild(entityOverlay);\r\n\r\n            entityOverlayEl = entityOverlay;\r\n            return entityOverlay;\r\n        }\r\n\r\n        const el = createEntityOverlay();\r\n        const titleEl = el.querySelector('#entity-title');\r\n        const bodyEl  = el.querySelector('#entity-body');\r\n\r\n        const props = entity.properties || {};\r\n        const now   = viewer.clock.currentTime;\r\n\r\n        const title = props.title?.getValue?.(now) || '지하시설물';\r\n        const desc  = props.desc?.getValue?.(now)  || '요약 정보가 준비 중입니다.';\r\n\r\n        titleEl.textContent = title;\r\n        bodyEl.textContent  = desc;\r\n\r\n        el.style.display = 'block';\r\n    }\r\n\r\n    function hideEntityOverlay() {\r\n        if (entityOverlayEl) {\r\n            entityOverlayEl.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    function onMouseMove(movement) {\r\n        const scene = viewer.scene;\r\n\r\n        const now = performance.now();\r\n        if (now - hoverCheckLastTime < 50) {\r\n            // 너무 자주 호출되면 무시 (경위도 약간 느려져도 크게 상관 없음)\r\n            return;\r\n        }\r\n        hoverCheckLastTime = now;\r\n        \r\n       const picked = scene.pick(movement.endPosition);\r\n\r\n\r\n        /*\r\n        * 현재 마우스 아래 entity 찾기\r\n        */ \r\n        if (Cesium.defined(picked) && picked.id && picked.id.id === 'entity_icon') {\r\n            showEntityOverlay(picked.id);\r\n        } else {\r\n            // entity 위에 있지 않을 때는 숨김\r\n            hideEntityOverlay();\r\n        }\r\n\r\n\r\n\r\n        /*\r\n        * 현재 마우스 아래 모델 찾기\r\n        */ \r\n       let pickedModel;\r\n        if (Cesium.defined(picked) && picked.content && picked.content._model) {\r\n            pickedModel = picked.content._model;\r\n        }\r\n\r\n        /*\r\n        *  hover 하이라이트 업데이트\r\n        *    - 이전 hover 복구 + 새 hover 적용까지 처리\r\n        */\r\n        updateHoverHighlight(pickedModel);\r\n        \r\n        /*\r\n        * 경위도 업데이트\r\n        */ \r\n        if (!infoBoxEnabled) return;\r\n        // 마우스 위치의 지표/타일 표면 위치 추정\r\n        // cartesian = 데카르트좌표계\r\n        let cartesian = Cesium.defined(scene.pickPosition) ? scene.pickPosition(movement.endPosition) : undefined;\r\n        if (!Cesium.defined(cartesian)) {\r\n            cartesian = scene.camera.pickEllipsoid(movement.endPosition, scene.globe.ellipsoid);\r\n        }\r\n        if (!Cesium.defined(cartesian)) return;\r\n\r\n        const c = Cesium.Cartographic.fromCartesian(cartesian);\r\n        const lon = Cesium.Math.toDegrees(c.longitude).toFixed(6);\r\n        const lat = Cesium.Math.toDegrees(c.latitude).toFixed(6);\r\n        const hgt = (c.height || 0).toFixed(2) + ' m';\r\n\r\n        infoBoxEls.lon.textContent = lon;\r\n        infoBoxEls.lat.textContent = lat;\r\n        infoBoxEls.hgt.textContent = hgt;\r\n\r\n        // ZoomLevel은 카메라 높이 기반으로 표시만\r\n        const camH = viewer.scene.globe.ellipsoid.cartesianToCartographic(viewer.camera.position).height;\r\n        infoBoxEls.zoom.textContent = `${Math.max(0, camH|0)} m`;\r\n    }\r\n\r\n    function onMouseLeftClick(movement){\r\n        const scene = viewer.scene;\r\n\r\n        /*\r\n        * primitive => 실제 scene에 렌더링된 오브젝트\r\n        * content => 클릭된 오브젝트 타일\r\n        * detail => 내부 세부정보\r\n        */\r\n        let pickedFeature = scene.pick(movement.position);\r\n\r\n        //이전 모델 선택 하이라이트 해제\r\n        restoreModelState(selectedState);\r\n\r\n        if(!Cesium.defined(pickedFeature) || pickedFeature.id instanceof Cesium.Entity) {\r\n            setInspectorBox(false);\r\n            return;\r\n        }\r\n\r\n        //glTF 모델 색상 하이라이트\r\n        const model = pickedFeature.content && pickedFeature.content._model;\r\n        if (model) {\r\n            // hover 상태와 겹치면 hover는 해제\r\n            if (hoverState.model === model) {\r\n                restoreModelState(hoverState);\r\n            }\r\n            // 선택된 모델 하이라이트\r\n            applyModelHighlight(\r\n                selectedState,\r\n                model,\r\n                Cesium.Color.CYAN.withAlpha(0.3),\r\n                0.5\r\n            );\r\n            flyDirectionStayFitModel(viewer,model);\r\n            updateInspectorToggleButton(model);\r\n        }else{\r\n            updateInspectorToggleButton(null);\r\n        }\r\n\r\n        let guid = pickedFeature.detail.node._name;\r\n        renderInspector(guid);\r\n        setInspectorBox(true);\r\n\r\n        function renderInspector(guid) {\r\n            if (!inspectorLists) return;\r\n            inspectorLists.innerHTML = '';\r\n\r\n            const props = properties[guid];\r\n            if (!props) {\r\n                inspectorLists.innerHTML = `\r\n                    <div class=\"inspect_list\">\r\n                        <div class=\"k\">info</div>\r\n                        <div style=\"color:#cccccc;\">속성이 없습니다.</div>\r\n                    </div>\r\n                `;\r\n                return;\r\n            }\r\n            let html = '';\r\n            // props 객체의 key / value를 돌면서 행 생성\r\n            Object.entries(props).forEach(([key, value]) => {\r\n                if (key === 'GUID') return;  \r\n                html += `\r\n                    <div class=\"inspect_list\">\r\n                        <div class=\"k\">${key}</div>\r\n                        <div style=\"color:#cccccc;\">${value}</div>\r\n                    </div>\r\n                `;\r\n            });\r\n            inspectorLists.innerHTML = html;\r\n        }\r\n    }\r\n\r\n    return {\r\n        init,\r\n        updateModelConfig\r\n    };\r\n})();\r\n\r\nexport default CesiumHandler;\r\n","export function CameraOrbitMode({cesiumViewer}){\r\n    const viewer = cesiumViewer;\r\n    const scene  = viewer.scene;\r\n    const camera = viewer.camera;\r\n\r\n    // 회전 모드 상태\r\n    const orbitState = {\r\n        enabled: false,\r\n        callback: null\r\n    };\r\n\r\n    function enable(unionTilesetCenter){\r\n\r\n        if (orbitState.enabled) return;\r\n        if (!unionTilesetCenter) return;\r\n\r\n        orbitState.enabled = true;\r\n\r\n        // trackedEntity가 잡혀 있으면 해제\r\n        viewer.trackedEntity = undefined;\r\n\r\n        const center = unionTilesetCenter.center;\r\n        const radius = unionTilesetCenter.radius;\r\n\r\n        // 거리/각도 설정\r\n        const pitch = Cesium.Math.toRadians(-45.0);   // -45도 내려다보기\r\n        const range = radius * 2.0;                   // 모델보다 조금 떨어져서\r\n\r\n        // 시작 시점엔 현재 heading 그대로 사용\r\n        let heading = camera.heading;\r\n\r\n        // 한 바퀴 도는 속도 (초당 10도 정도)\r\n        const angularSpeed = Cesium.Math.toRadians(10.0); // rad/sec\r\n\r\n        // 처음 lookAt으로 pivot을 center로 박아둠\r\n        camera.lookAt(\r\n            center,\r\n            new Cesium.HeadingPitchRange(heading, pitch, range)\r\n        );\r\n\r\n        let lastTime = performance.now() / 1000;  // 초 단위\r\n\r\n        // preRender 콜백\r\n        const cb = function (scene, time) {\r\n            if (!orbitState.enabled) return;\r\n\r\n            const now = performance.now() / 1000;\r\n            const dt  = now - lastTime;\r\n            lastTime  = now;\r\n            \r\n            heading += angularSpeed * dt;\r\n\r\n            camera.lookAt(\r\n                center,\r\n                new Cesium.HeadingPitchRange(heading, pitch, range)\r\n            );\r\n        };\r\n\r\n        orbitState.callback = cb;\r\n        scene.preRender.addEventListener(cb);\r\n    }\r\n    function disable(){\r\n\r\n        if (!orbitState.enabled) return;\r\n        orbitState.enabled = false;\r\n        if (orbitState.callback) {\r\n            viewer.scene.preRender.removeEventListener(orbitState.callback);\r\n            orbitState.callback = null;\r\n        }\r\n\r\n        // pivot 해제 (그냥 현재 위치/방향 유지)\r\n        camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\r\n    }\r\n\r\n    return {enable,disable};\r\n}","import CesiumHandler from \"./CesiumHandler.js\";\r\n\r\n/**\r\n *  target: \"#element\" 또는 DOM Element\r\n *  options: { 3dtileset url, 관련 속성정보 url , info={ 타이틀, 이미지 src(svg,png), 높이(default 100)} }\r\n */\r\nexport async function CesiumViewer(target, options = {}) {\r\n  // target이 문자열이면 '#viewerRoot' 형태일 수도 있으니 '#' 제거해서 id로 사용\r\n  const elementId = typeof target === \"string\" ? target.replace(/^#/, \"\") : (target && target.id);\r\n  const viewer = await CesiumHandler.init(elementId, options);\r\n\r\n  function update3Dtileset(tilesetUrl, propertyUrls = []) {\r\n    return CesiumHandler.updateModelConfig(tilesetUrl, propertyUrls);\r\n  }\r\n\r\n  return {\r\n    update3Dtileset\r\n  };\r\n}\r\n"],"names":["HUD_CSS","HUD_HTML","INSPECTOR_CSS","INSPECTOR_HTML","COMPASS_SVG","VIEW_PRESETS","top","heading","Cesium","Math","toRadians","pitch","right","left","flyToTilesetsWithPreset","viewer","union","presetKey","duration","range","alert","preset","scene","camera","flyToBoundingSphere","offset","HeadingPitchRange","easingFunction","EasingFunction","SINUSOIDAL_IN_OUT","CameraFreeMode","cesiumViewer","handler","startMousePosition","mousePosition","enabled","looking","PITCH_MIN","PITCH_MAX","headingTemp","pitchTemp","flags","moveForward","moveBackward","moveUp","moveDown","moveLeft","moveRight","keyDown","e","m","KeyW","KeyS","KeyQ","KeyE","KeyA","KeyD","code","keyUp","setDefaultControls","c","screenSpaceCameraController","enableRotate","enableTranslate","enableZoom","enableTilt","enableLook","onTick","canvas","ellipsoid","globe","w","clientWidth","h","clientHeight","dx","x","dy","y","dHeading","dPitch","newHeading","newPitch","clamp","negativePiToPi","setView","orientation","HeadingPitchRoll","moveRate","cartesianToCartographic","position","height","placeFreeHelp","$tb","$","container","$fh","length","r","getBoundingClientRect","css","width","bottom","transform","enable","lookAtTransform","Matrix4","IDENTITY","ScreenSpaceEventHandler","setInputAction","movement","Cartesian3","clone","ScreenSpaceEventType","LEFT_DOWN","endPosition","MOUSE_MOVE","LEFT_UP","document","addEventListener","clock","append","window","on","disable","removeEventListener","destroy","undefined","Object","keys","forEach","k","off","remove","Measurement","mode","floatingPoint","activeShape","mouseLabel","prevCursor","areaOptions","activeShapePoints","keydownHandler","measureEndEntity","graphics","points","labels","session","offHandler","removeInputAction","LEFT_CLICK","RIGHT_CLICK","LEFT_DOUBLE_CLICK","resetSession","g","entities","p","l","createLabel","pos","text","options","LABEL_STYLE","parts","String","split","map","s","trim","filter","Boolean","axes","colors","lines","v","i","createElement","ctx","getContext","font","maxTextW","max","ceil","measureText","dpr","min","devicePixelRatio","roundRect","beginPath","moveTo","arcTo","closePath","round","scale","textBaseline","textAlign","bg","fillStyle","fill","fillText","placeRight","point","horizontalOrigin","HorizontalOrigin","LEFT","CENTER","verticalOrigin","VerticalOrigin","pixelOffset","Cartesian2","add","billboard","image","eyeOffset","heightReference","HeightReference","NONE","disableDepthTestDistance","Number","POSITIVE_INFINITY","createPoint","pixelSize","outlineWidth","color","Color","fromCssColorString","outlineColor","drawShape","positionData","clickEvtType","getLineMaterial","isFinal","PolylineDashMaterialProperty","addPolyline","positions","material","polyline","clampToGround","arcType","ArcType","depthFailMaterial","hierarchy","polygon","outline","bindDrawing","trackedEntity","async","cart","pickPosition","defined","feature","pick","cartographic","Cartographic","fromCartesian","lon","toDegrees","longitude","toFixed","lat","latitude","push","screenPos","pickPositionSupported","cartModel","cg","modelHeight","cp","terrainHeight","tp","terrainProvider","availability","hasMetadata","res","sampleTerrainMostDetailed","getHeight","getTerrainHeightAt","dz","absDz","abs","cartTerrain","fromRadians","verticalLine","withAlpha","label","midpoint","pModel","WHITE","pTerr","BLACK","measureVerticalGapAt","dynamicPositions","CallbackProperty","PolygonHierarchy","pts","concat","prev","dist","distance","segLabel","screenPosition","ensureMouseLabel","pickEllipsoid","show","showMouseLabelAt","setMouseLabelText","np","setValue","pop","getValue","indices","PolygonPipeline","triangulate","area","v1","v2","v3","vc","subtract","vd","cross","magnitude","txt","areaLabel","BoundingSphere","fromPoints","center","ring","slice","p0","areaValue","arr","finalShape","Array","prototype","apply","hideMouseLabel","finalizeActive","fromDegrees","style","LabelStyle","FILL_AND_OUTLINE","fillColor","showBackground","backgroundColor","backgroundPadding","TOP","setDrawingCursor","getComputedStyle","cursor","start","tabIndex","focus","key","keyCode","stop","setAreaMode","removeAll","mountToolBar","onPoint","onLine","onVertical","onAreaGround","onAreaSurface","onClose","onInit","onMarkerAdd","onMarkerClose","root","querySelector","Error","getElementById","id","textContent","head","appendChild","toolRoot","className","innerHTML","$rootWrap","$groupMeasure","find","$groupMarker","$measurePanel","$markerPanel","$tools","$btnPoint","$btnLine","$btnVert","$btnAreaG","$btnAreaS","$btnInit","$btnClose","$btnMarkerClose","$btnMarkerInit","measureOpen","markerOpen","setActive","$btn","removeClass","addClass","clearActive","closeAllPanels","showMountToolBar","hiddenMountToolBar","CesiumHandler","inspectorBoxEl","inspectorLists","$btnInspectorModelShow","infoBoxEls","infoBoxEnabled","properties","inspectorBoxEnabled","inspectorSelectedModel","$btnResetHiddenModels","inspectorHiddenModel","Set","entityOverlayEl","entityScratch","unionTilesetCenter","hoverCheckLastTime","currentModelConfig","tilesetUrl","propertyUrls","info","iconSrc","loaded_3Dtilesets","hoverState","model","blendMode","blendAmount","selectedState","DefaultOption","animation","shouldAnimate","baseLayerPicker","fullscreenButton","vrButton","geocoder","homeButton","infoBox","sceneModePicker","timeline","navigationHelpButton","selectionIndicator","projectionPicker","navigationInstructionsInitiallyVisible","shadows","maximumRenderTimeChange","Infinity","sceneMode","SceneMode","SCENE3D","baseLayer","ImageryLayer","UrlTemplateImageryProvider","url","subdomains","minimumLevel","maximumLevel","rectangle","Rectangle","underFacilitySpecialEvn","translucencyEnabled","fadeByDistance","alpha","cameraFree","cameraOrbitMode","measurement","toolBarApi","Mode","currentMode","setMode","nextMode","setInspectorBox","inspectBoxDisable","restoreModelState","infoBoxEnable","inspectBoxEnable","applyModelConfig","config","tasks","tilesets","ts","primitives","console","warn","rootTilesetUrl","Promise","resolve","response","fetch","ok","error","status","rootData","json","children","log","loadedTilesets","baseUrl","substring","lastIndexOf","child","content","uri","childUrl","replace","tileset","createTileset","loadAllTilesets","renderingAllTileset","paddingScale","ready","t","boundingSphere","radius","unionAllTilesetsBoundingSphereCompute","lineEntity","getById","iconEntity","removeModelInfoLabel","lineLength","centerCartesian","centerCarto","baseHeight","cylinderMidH","labelHeight","cylinderPos","labelPos","Transforms","headingPitchRollQuaternion","cylinder","topRadius","bottomRadius","distanceDisplayCondition","DistanceDisplayCondition","size","padding","bgColor","borderColor","shadow","pixelScale","total","cx","cy","save","shadowColor","shadowBlur","shadowOffsetY","arc","PI","strokeStyle","lineWidth","stroke","restore","strokeText","reject","img","Image","onload","iconR","iconSize","clip","drawImage","onerror","src","createRoundBadgeCanvas","then","badgeCanvas","title","desc","BOTTOM","setModelInfoLabel","totalLoaded","jsonUrl","propertiesData","loadTilesetInfo","all","updateInspectorToggleButton","removeAttr","isVisible","attr","injectStyleOnce","cssText","appendTo","onMouseLeftClick","isOpen","$inspector","$shell","closest","$btnInspectorClose","translucencyUpdate","translucency","isNaN","frontFaceAlphaByDistance","nearValue","farValue","Cesium3DTileset","fromUrl","ShadowMode","ENABLED","maximumScreenSpaceError","skipLevelOfDetail","baseScreenSpaceError","skipScreenSpaceErrorFactor","skipLevels","immediatelyLoadDesiredLevelOfDetail","loadSiblings","dynamicScreenSpaceError","dynamicScreenSpaceErrorDensity","dynamicScreenSpaceErrorFactor","dynamicScreenSpaceErrorHeightFalloff","cullWithChildrenBounds","cullRequestsWhileMoving","onMouseMove","applyModelHighlight","state","colorBlendMode","colorBlendAmount","ColorBlendMode","MIX","now","performance","picked","pickedModel","entity","el","entityOverlay","createEntityOverlay","titleEl","bodyEl","props","currentTime","display","showEntityOverlay","_model","YELLOW","updateHoverHighlight","cartesian","hgt","camH","zoom","pickedFeature","Entity","CYAN","bs","_boundingSphere","frustum","fovy","aspect","aspectRatio","fovx","atan","tan","distV","sin","distH","fitDistance","forward","normalize","newPosition","multiplyByScalar","direction","worldUp","geodeticSurfaceNormal","up","flyTo","destination","QUADRATIC_OUT","flyDirectionStayFitModel","guid","html","entries","value","renderInspector","detail","node","_name","init","elementId","ph","Viewer","sun","moon","depthTestAgainstTerrain","enableCollisionDetection","NearFarScalar","baseColor","controller","zoomFactor","rotateFactor","minimumZoomDistance","maximumZoomDistance","cam","inertiaSpin","inertiaTranslate","inertiaZoom","preRender","time","Property","getValueOrUndefined","canvasPos","cartesianToCanvasCoordinates","initCesiumViewer","$wrap","$svg","postRender","createCompas","orbitState","callback","angularSpeed","lookAt","lastTime","cb","dt","CameraOrbitMode","$root","infoBoxRootEl","$cameraFree","$modeWrap","$hcg","$hcm","$transHeader","$transBody","$toggleIcon","$onlyModel","$performance","$hudToggle","$orbitBtn","stopPropagation","toggleClass","target","is","slideUp","slideDown","this","skyAtmosphere","skyBox","debugShowFramesPerSecond","bindTranslucencyControls","dataset","view","syncModeButtons","isFree","isOrbit","$chkTrans","$chkFade","$alphaRange","$alphaValue","setFadeAlphaEnabled","prop","opacity","val","applyAlpha","parseFloat","createInfoBox","onMarkerClear","$viewerContainer","$parent","parent","hasClass","before","$inspectorBox","updateHiddenModelsResetButton","isDestroyed","clear","hide","delete","createInspectBox","updateModelConfig","CesiumViewer","update3Dtileset"],"mappings":"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"}